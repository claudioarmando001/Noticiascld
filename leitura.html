<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Notícias CLD - Leitura</title>
<meta name="description" content="Leia notícias completas de Moçambique">
<meta name="robots" content="index, follow">
<style>
body{
    font-family:Arial,sans-serif;
    background:#f2f3f5;
    margin:0;
    color:#111;
}

/* HEADER */
header{
    background:#1a73e8;
    color:white;
    padding:18px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
    position:relative;
}

.header-btn{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:white;
    color:#1a73e8;
    border:none;
    padding:7px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:18px;
    font-weight:bold;
    transition: all 0.3s;
}

.header-btn:hover {
    opacity: 0.9;
    transform: translateY(-50%) scale(1.05);
}

#back-btn{ left:15px; }

/* CONTEÚDO PRINCIPAL */
#news-content {
    max-width:950px;
    margin:30px auto;
    padding:20px;
    background:white;
    border-radius:12px;
    box-shadow:0 2px 10px rgba(0,0,0,.08);
}

.news-header {
    margin-bottom:25px;
    padding-bottom:20px;
    border-bottom:2px solid #e8f0fe;
}

.news-title {
    font-size:24px;
    font-weight:bold;
    color:#111;
    margin-bottom:15px;
    line-height:1.4;
}

.news-meta {
    display:flex;
    align-items:center;
    gap:15px;
    flex-wrap:wrap;
    color:#666;
    font-size:14px;
}

.source-tag{
    background:#e8f0fe;
    color:#1a73e8;
    padding:4px 12px;
    border-radius:12px;
    font-size:12px;
    font-weight:bold;
}

.category-tag {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

.sociedade-tag {
    background: rgba(76, 175, 80, 0.1);
    color: #2e7d32;
}

.politica-tag {
    background: rgba(244, 67, 54, 0.1);
    color: #c62828;
}

.economia-tag {
    background: rgba(255, 152, 0, 0.1);
    color: #ef6c00;
}

.esportes-tag {
    background: rgba(33, 150, 243, 0.1);
    color: #1565c0;
}

.cultura-tag {
    background: rgba(156, 39, 176, 0.1);
    color: #7b1fa2;
}

.saude-tag {
    background: rgba(0, 150, 136, 0.1);
    color: #00796b;
}

.tech-tag {
    background: rgba(96, 125, 139, 0.1);
    color: #37474f;
}

.news-image {
    width:100%;
    max-height:400px;
    object-fit:cover;
    border-radius:10px;
    margin:20px 0;
}

.news-body {
    line-height:1.8;
    font-size:16px;
    color:#333;
    margin:30px 0;
}

.news-body img {
    max-width:100%;
    height:auto;
    border-radius:8px;
    margin:15px 0;
}

.news-body iframe,
.news-body video {
    max-width:100%;
    border-radius:8px;
    margin:15px 0;
}

/* SHARE SECTION */
.share-section {
    margin:40px 0;
    padding:25px;
    background:#f8f9fa;
    border-radius:12px;
    border-left:4px solid #1a73e8;
}

.share-title {
    font-size:18px;
    color:#1a73e8;
    margin-bottom:20px;
    font-weight:bold;
}

.share-buttons {
    display:flex;
    gap:12px;
    flex-wrap:wrap;
}

.share-btn {
    flex:1;
    min-width:120px;
    padding:12px 20px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-size:14px;
    font-weight:500;
    transition:all 0.3s;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}

.share-btn:hover {
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.share-btn.facebook {
    background:#1877f2;
    color:white;
}

.share-btn.twitter {
    background:#1da1f2;
    color:white;
}

.share-btn.whatsapp {
    background:#25d366;
    color:white;
}

.share-btn.link {
    background:#6c757d;
    color:white;
}

.share-btn.link.copied {
    background:#28a745;
}

/* RELATED NEWS */
.related-news-section {
    margin-top:50px;
    padding-top:30px;
    border-top:2px solid #e8f0fe;
}

.related-news-title {
    font-size:20px;
    color:#1a73e8;
    margin-bottom:25px;
    font-weight:bold;
}

.related-news-container {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
    gap:20px;
    margin-top:15px;
}

.related-news-card {
    background:#f8f9fa;
    border-radius:10px;
    padding:15px;
    border-left:4px solid #1a73e8;
    cursor:pointer;
    transition:all 0.3s;
    text-decoration:none;
    color:inherit;
}

.related-news-card:hover {
    background:#e8f0fe;
    transform:translateY(-3px);
    text-decoration:none;
    color:inherit;
}

.related-news-card img {
    width:100%;
    height:150px;
    object-fit:cover;
    border-radius:6px;
    margin-bottom:12px;
}

.related-news-card h3 {
    font-size:16px;
    font-weight:600;
    color:#111;
    margin-bottom:8px;
    line-height:1.3;
}

.related-news-meta {
    font-size:12px;
    color:#666;
    display:flex;
    align-items:center;
    gap:8px;
}

/* FOOTER */
.footer {
    max-width:950px;
    margin:40px auto 20px;
    padding:20px;
    text-align:center;
    color:#666;
    font-size:14px;
    border-top:1px solid #ddd;
}

.footer-links {
    margin-top:15px;
    display:flex;
    justify-content:center;
    gap:20px;
    flex-wrap:wrap;
}

.footer-links a {
    color:#1a73e8;
    text-decoration:none;
    font-weight:500;
}

.footer-links a:hover {
    text-decoration:underline;
}

/* LOADER - OTIMIZADO */
.loader {
    text-align:center;
    padding:60px 20px;
}

.spinner {
    display:inline-block;
    width:40px;
    height:40px;
    border:4px solid #e8e8e8;
    border-top:4px solid #1a73e8;
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin-bottom:20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.error-message {
    text-align:center;
    padding:60px 20px;
    color:#666;
}

.error-message h2 {
    color:#dc3545;
    margin-bottom:15px;
}

.error-message a {
    display:inline-block;
    margin-top:20px;
    padding:10px 20px;
    background:#1a73e8;
    color:white;
    text-decoration:none;
    border-radius:8px;
    font-weight:bold;
}

.error-message a:hover {
    background:#0d62d9;
}

/* SKELETON LOADING */
.skeleton {
    animation: skeleton-loading 1s linear infinite alternate;
}

@keyframes skeleton-loading {
    0% { background-color: #e8e8e8; }
    100% { background-color: #f8f9fa; }
}

.skeleton-title {
    height:30px;
    width:80%;
    margin-bottom:20px;
    border-radius:4px;
}

.skeleton-meta {
    height:20px;
    width:60%;
    margin-bottom:30px;
    border-radius:4px;
}

.skeleton-image {
    height:300px;
    width:100%;
    margin:20px 0;
    border-radius:10px;
}

.skeleton-text {
    height:15px;
    width:100%;
    margin:10px 0;
    border-radius:4px;
}

.skeleton-text.short {
    width:80%;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header>
<button class="header-btn" id="back-btn" onclick="goBack()">← Voltar</button>
Notícias CLD
<div style="width:70px;"></div> <!-- Espaço para alinhamento -->
</header>

<div id="news-content">
<!-- SKELETON LOADER PARA CARREGAMENTO RÁPIDO -->
<div id="skeleton-loader" style="display:none;">
    <div class="skeleton skeleton-title"></div>
    <div class="skeleton skeleton-meta"></div>
    <div class="skeleton skeleton-image"></div>
    <div class="skeleton skeleton-text"></div>
    <div class="skeleton skeleton-text"></div>
    <div class="skeleton skeleton-text short"></div>
    <div class="skeleton skeleton-text"></div>
    <div class="skeleton skeleton-text short"></div>
</div>

<div class="loader" id="loader">
    <div class="spinner"></div>
    <p>Carregando notícia...</p>
</div>

<div id="error-message" class="error-message" style="display:none;">
    <h2><i class="fas fa-exclamation-triangle"></i> Notícia não encontrada</h2>
    <p>A notícia que você está procurando não foi encontrada.</p>
    <a href="/">← Voltar para a lista de notícias</a>
</div>

<div id="news-container" style="display:none;">
    <!-- Conteúdo da notícia será carregado aqui -->
</div>
</div>

<script>
// CATEGORIAS DISPONÍVEIS (versão simplificada)
const CATEGORIES = {
    'sociedade': { name: 'Sociedade', class: 'sociedade-tag' },
    'política': { name: 'Política', class: 'politica-tag' },
    'economia': { name: 'Economia', class: 'economia-tag' },
    'esportes': { name: 'Esportes', class: 'esportes-tag' },
    'cultura': { name: 'Cultura', class: 'cultura-tag' },
    'saúde': { name: 'Saúde', class: 'saude-tag' },
    'tecnologia': { name: 'Tecnologia', class: 'tech-tag' }
};

// Cache em memória para notícias já carregadas
let newsCache = new Map();

// Função para obter parâmetros da URL (otimizada)
function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    
    // Retorna apenas o ID - é o único parâmetro necessário
    return id;
}

// Função para formatar data (otimizada)
function formatDate(d) {
    if (!d) return '';
    try {
        const date = new Date(d);
        return date.toLocaleDateString("pt-PT", {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch {
        return '';
    }
}

// Função para voltar (otimizada)
function goBack() {
    if (window.history.length > 1 && document.referrer.includes(window.location.hostname)) {
        history.back();
    } else {
        window.location.href = '/';
    }
}

// Funções de compartilhamento (otimizadas)
function shareOnFacebook() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${title}`, '_blank', 'noopener,noreferrer');
}

function shareOnTwitter() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    window.open(`https://twitter.com/intent/tweet?text=${title}&url=${url}`, '_blank', 'noopener,noreferrer');
}

function shareOnWhatsApp() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent(document.title);
    window.open(`https://wa.me/?text=${title}%20-%20${url}`, '_blank', 'noopener,noreferrer');
}

// Função para copiar link (otimizada)
function copyLink() {
    const url = window.location.href;
    const btn = document.getElementById('copy-link-btn');
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url).then(() => {
            showCopySuccess(btn);
        }).catch(() => {
            fallbackCopyTextToClipboard(url, btn);
        });
    } else {
        fallbackCopyTextToClipboard(url, btn);
    }
}

function fallbackCopyTextToClipboard(text, btn) {
    const textArea = document.createElement("textarea");
    textArea.value = text;
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        document.execCommand('copy');
        showCopySuccess(btn);
    } catch (err) {
        console.error('Erro ao copiar link:', err);
    }
    
    document.body.removeChild(textArea);
}

function showCopySuccess(btn) {
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check"></i> Copiado!';
    btn.classList.add('copied');
    
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.classList.remove('copied');
    }, 2000);
}

// Função para determinar categoria (versão otimizada e simplificada)
function determineCategory(title) {
    const text = title.toLowerCase();
    
    // Palavras-chave otimizadas
    const keywords = {
        'esportes': ['futebol', 'desporto', 'jogo', 'atleta', 'campeonato', 'estádio', 'golo'],
        'economia': ['economia', 'negócio', 'empresa', 'investimento', 'banco', 'mercado', 'imposto'],
        'política': ['política', 'governo', 'presidente', 'ministro', 'eleições', 'parlamento'],
        'saúde': ['saúde', 'hospital', 'médico', 'enfermeiro', 'doença', 'vacina'],
        'tecnologia': ['tecnologia', 'digital', 'aplicativo', 'internet', 'software', 'celular'],
        'cultura': ['cultura', 'arte', 'música', 'teatro', 'cinema', 'literatura'],
        'sociedade': ['sociedade', 'educação', 'escola', 'universidade', 'família']
    };
    
    for (const [category, words] of Object.entries(keywords)) {
        for (const word of words) {
            if (text.includes(word)) {
                return category;
            }
        }
    }
    
    return 'sociedade'; // categoria padrão
}

// Função para encontrar notícias relacionadas (otimizada)
function findRelatedNews(currentNews) {
    try {
        const allNews = JSON.parse(localStorage.getItem('cld_news') || '[]');
        if (!allNews || allNews.length === 0) return [];
        
        const currentCategory = currentNews.category || determineCategory(currentNews.title);
        const related = [];
        
        // Limita a busca a 50 notícias para performance
        const searchLimit = Math.min(allNews.length, 50);
        
        for (let i = 0; i < searchLimit && related.length < 3; i++) {
            const news = allNews[i];
            if (news.hash !== currentNews.hash) {
                const newsCategory = news.category || determineCategory(news.title);
                if (newsCategory === currentCategory) {
                    related.push(news);
                }
            }
        }
        
        return related;
    } catch {
        return [];
    }
}

// Função para gerar link da notícia relacionada (otimizada)
function generateRelatedNewsLink(article) {
    // Gera um slug simples baseado no título
    const slug = article.title
        .toLowerCase()
        .replace(/[^\w\s]/g, '')
        .replace(/\s+/g, '-')
        .substring(0, 80);
    
    const sourceSlug = article.source
        .toLowerCase()
        .replace(/\s+/g, '-')
        .replace(/[^\w-]/g, '');
    
    return `leitura.html?source=${encodeURIComponent(sourceSlug)}&slug=${encodeURIComponent(slug)}&id=${article.hash}`;
}

// Função para renderizar a notícia (OTIMIZADA)
function renderNews(article) {
    const category = article.category || determineCategory(article.title);
    
    // Atualizar título da página IMEDIATAMENTE
    document.title = `${article.title.substring(0, 60)} | Notícias CLD`;
    
    // Atualizar meta description
    const metaDescription = document.querySelector('meta[name="description"]');
    if (metaDescription) {
        const cleanContent = article.content.replace(/<[^>]*>/g, '').substring(0, 160);
        metaDescription.content = cleanContent;
    }
    
    // MOSTRAR CONTENT IMEDIATAMENTE com conteúdo básico
    document.getElementById('skeleton-loader').style.display = 'none';
    document.getElementById('loader').style.display = 'none';
    document.getElementById('news-container').style.display = 'block';
    
    // Conteúdo inicial rápido
    const initialContent = `
        <div class="news-header">
            <h1 class="news-title">${article.title}</h1>
            <div class="news-meta">
                <span class="source-tag">${article.source}</span>
                <span class="category-tag ${CATEGORIES[category]?.class || 'sociedade-tag'}">
                    ${CATEGORIES[category]?.name || 'Sociedade'}
                </span>
                <span><i class="far fa-calendar"></i> ${formatDate(article.date)}</span>
            </div>
        </div>
        
        <div id="news-image-placeholder">
            ${article.image && article.image !== 'https://via.placeholder.com/300x200' ? 
                `<img src="${article.image}" class="news-image" alt="${article.title}" 
                     loading="lazy" onerror="this.src='https://via.placeholder.com/800x400/1a73e8/ffffff?text=${encodeURIComponent(article.source.substring(0,2))}'">` : 
                ''
            }
        </div>
        
        <div class="news-body" id="news-body-content">
            ${article.content}
        </div>
        
        <div class="share-section">
            <h3 class="share-title"><i class="fas fa-share-alt"></i> Partilhar esta notícia</h3>
            <div class="share-buttons">
                <button class="share-btn facebook" onclick="shareOnFacebook()">
                    <i class="fab fa-facebook-f"></i> Facebook
                </button>
                <button class="share-btn twitter" onclick="shareOnTwitter()">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="share-btn whatsapp" onclick="shareOnWhatsApp()">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
                <button class="share-btn link" id="copy-link-btn" onclick="copyLink()">
                    <i class="fas fa-link"></i> Copiar Link
                </button>
            </div>
        </div>
        
        <div id="related-news-placeholder">
            <!-- Notícias relacionadas serão carregadas depois -->
        </div>
        
        <div class="footer">
            <p>© ${new Date().getFullYear()} Notícias CLD - Agregador de Notícias de Moçambique</p>
            <div class="footer-links">
                <a href="/"><i class="fas fa-home"></i> Página Inicial</a>
            </div>
        </div>
    `;
    
    document.getElementById('news-container').innerHTML = initialContent;
    
    // CARREGAR NOTÍCIAS RELACIONADAS ASSÍNCRONAMENTE (não bloqueia a renderização)
    setTimeout(() => loadRelatedNewsAsync(article), 100);
}

// Carregar notícias relacionadas de forma assíncrona
function loadRelatedNewsAsync(article) {
    try {
        const relatedNews = findRelatedNews(article);
        if (relatedNews.length > 0) {
            const relatedHTML = `
                <div class="related-news-section">
                    <h3 class="related-news-title"><i class="fas fa-newspaper"></i> Notícias Relacionadas</h3>
                    <div class="related-news-container">
                        ${relatedNews.map(news => {
                            const newsUrl = generateRelatedNewsLink(news);
                            return `
                                <a href="${newsUrl}" class="related-news-card">
                                    <img src="${news.image}" alt="${news.title}" 
                                         loading="lazy" 
                                         onerror="this.src='https://via.placeholder.com/300x150/1a73e8/ffffff?text=${encodeURIComponent(news.source.substring(0,2))}'">
                                    <h3>${news.title.substring(0, 80)}${news.title.length > 80 ? '...' : ''}</h3>
                                    <div class="related-news-meta">
                                        <span class="source-tag" style="font-size:10px;">${news.source}</span>
                                        <span>${formatDate(news.date)}</span>
                                    </div>
                                </a>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            const placeholder = document.getElementById('related-news-placeholder');
            if (placeholder) {
                placeholder.innerHTML = relatedHTML;
            }
        }
    } catch (error) {
        console.error('Erro ao carregar notícias relacionadas:', error);
    }
}

// Buscar notícia LOCALMENTE (extremamente rápido)
function findNewsLocally(id) {
    // 1. Tentar cache em memória
    if (newsCache.has(id)) {
        return newsCache.get(id);
    }
    
    // 2. Tentar sessionStorage (mais rápido que localStorage)
    try {
        const sessionNews = sessionStorage.getItem(`news_${id}`);
        if (sessionNews) {
            const article = JSON.parse(sessionNews);
            newsCache.set(id, article);
            return article;
        }
    } catch (e) {
        console.warn('Erro no sessionStorage:', e);
    }
    
    // 3. Tentar localStorage
    try {
        const allNews = JSON.parse(localStorage.getItem('cld_news') || '[]');
        const article = allNews.find(news => news.hash === id);
        
        if (article) {
            // Salvar no cache e sessionStorage para acesso futuro
            newsCache.set(id, article);
            try {
                sessionStorage.setItem(`news_${id}`, JSON.stringify(article));
            } catch (e) {
                // sessionStorage pode estar cheio, não é crítico
            }
            return article;
        }
    } catch (e) {
        console.error('Erro ao buscar notícia localmente:', e);
    }
    
    return null;
}

// Função para buscar da API (APENAS SE NECESSÁRIO)
async function fetchNewsFromAPI(id) {
    // Lista de fontes otimizada (apenas as principais)
    const sources = [
        { name: "O País", baseUrl: "https://www.opais.co.mz/wp-json/wp/v2/posts" },
        { name: "Jornal Notícias", baseUrl: "https://www.jornalnoticias.co.mz/wp-json/wp/v2/posts" },
        { name: "Canal de Moçambique", baseUrl: "https://canal.co.mz/wp-json/wp/v2/posts" },
        { name: "Time de Todos", baseUrl: "https://timesdetodos.com/wp-json/wp/v2/posts" },
        { name: "Carta de Moçambique", baseUrl: "https://cartamz.com/wp-json/wp/v2/posts" }
    ];
    
    // Tentar cada fonte por 3 segundos no máximo
    const timeoutPromise = new Promise((_, reject) => 
        setTimeout(() => reject(new Error('Timeout')), 3000)
    );
    
    for (const source of sources) {
        try {
            const fetchPromise = fetch(`${source.baseUrl}?_embed&per_page=5&t=${Date.now()}`);
            const response = await Promise.race([fetchPromise, timeoutPromise]);
            
            if (!response.ok) continue;
            
            const data = await response.json();
            
            for (const article of data) {
                const hash = (article.title.rendered + article.link).replace(/\W/g, "");
                if (hash === id) {
                    const newsItem = {
                        title: article.title.rendered,
                        content: article.content.rendered,
                        image: article._embedded?.["wp:featuredmedia"]?.[0]?.source_url || 
                               article.jetpack_featured_media_url ||
                               "https://via.placeholder.com/300x200",
                        source: source.name,
                        date: article.date || article.modified,
                        link: article.link,
                        hash: hash
                    };
                    
                    // Salvar localmente para acesso rápido futuro
                    saveNewsLocally(newsItem);
                    return newsItem;
                }
            }
        } catch (error) {
            console.warn(`Erro ao buscar de ${source.name}:`, error);
            continue;
        }
    }
    
    return null;
}

// Salvar notícia localmente (otimizado)
function saveNewsLocally(article) {
    try {
        // 1. Cache em memória
        newsCache.set(article.hash, article);
        
        // 2. sessionStorage (para esta sessão)
        sessionStorage.setItem(`news_${article.hash}`, JSON.stringify(article));
        
        // 3. localStorage (persistente, limitado a 50 notícias)
        let allNews = JSON.parse(localStorage.getItem('cld_news') || '[]');
        
        // Remover se já existir
        allNews = allNews.filter(n => n.hash !== article.hash);
        
        // Adicionar no início
        allNews.unshift(article);
        
        // Manter apenas as 50 mais recentes
        if (allNews.length > 50) {
            allNews = allNews.slice(0, 50);
        }
        
        localStorage.setItem('cld_news', JSON.stringify(allNews));
    } catch (e) {
        console.warn('Erro ao salvar notícia localmente:', e);
    }
}

// Função principal OTIMIZADA para carregar a notícia
async function loadNews() {
    const newsId = getUrlParams();
    
    if (!newsId) {
        showError();
        return;
    }
    
    // MOSTRAR SKELETON LOADER IMEDIATAMENTE para melhor UX
    document.getElementById('loader').style.display = 'none';
    document.getElementById('skeleton-loader').style.display = 'block';
    
    // 1. Buscar LOCALMENTE (instantâneo)
    let article = findNewsLocally(newsId);
    
    if (article) {
        // RENDERIZAR IMEDIATAMENTE (menos de 100ms)
        setTimeout(() => renderNews(article), 50);
        return;
    }
    
    // 2. Se não encontrou localmente, buscar da API
    try {
        article = await fetchNewsFromAPI(newsId);
        
        if (article) {
            renderNews(article);
        } else {
            showError();
        }
    } catch (error) {
        console.error('Erro ao buscar notícia:', error);
        showError();
    }
}

// Função para mostrar erro (otimizada)
function showError() {
    document.getElementById('skeleton-loader').style.display = 'none';
    document.getElementById('loader').style.display = 'none';
    document.getElementById('error-message').style.display = 'block';
}

// Iniciar carregamento IMEDIATAMENTE
document.addEventListener('DOMContentLoaded', function() {
    // Iniciar o carregamento antes de tudo
    loadNews();
    
    // Configurar botão voltar
    document.getElementById('back-btn').addEventListener('click', goBack);
    
    // Otimizar imagens lazy loading
    if ('loading' in HTMLImageElement.prototype) {
        const images = document.querySelectorAll('img[loading="lazy"]');
        images.forEach(img => {
            img.loading = 'lazy';
        });
    }
});

// Atalhos de teclado
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' || (e.key === 'ArrowLeft' && e.altKey)) {
        goBack();
    }
    
    if ((e.ctrlKey || e.metaKey) && e.key === 'c' && !e.target.isContentEditable) {
        e.preventDefault();
        copyLink();
    }
});

// Pré-carregar a página inicial se o usuário estiver ocioso
setTimeout(() => {
    if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
            // Pré-carregar a página inicial em background
            const link = document.createElement('link');
            link.rel = 'prefetch';
            link.href = '/';
            document.head.appendChild(link);
        });
    }
}, 2000);

// Cache de service worker (opcional, mas melhora performance futura)
if ('serviceWorker' in navigator && location.protocol === 'https:') {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(err => {
            console.log('ServiceWorker registration failed: ', err);
        });
    });
}
</script>
</body>
</html>