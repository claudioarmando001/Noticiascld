<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Not√≠cia - Not√≠cias CLD</title>
<meta name="description" content="Leia not√≠cias completas de Mo√ßambique">
<meta name="robots" content="index, follow">
<style>
body{
    font-family:Arial,sans-serif;
    background:#f2f3f5;
    margin:0;
    color:#111;
}

/* HEADER */
header{
    background:#1a73e8;
    color:white;
    padding:18px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
    position:relative;
}

.header-btn{
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    background:white;
    color:#1a73e8;
    border:none;
    padding:7px 12px;
    border-radius:8px;
    cursor:pointer;
    font-size:18px;
    font-weight:bold;
    transition: all 0.3s;
}

.header-btn:hover {
    opacity: 0.9;
    transform: translateY(-50%) scale(1.05);
}

#back-btn{ left:15px; }

/* CONTE√öDO */
#news-container{
    max-width:800px;
    margin:30px auto;
    padding:0 20px;
}

#news-content{
    background:white;
    border-radius:15px;
    padding:30px;
    box-shadow:0 4px 20px rgba(0,0,0,.1);
}

#news-title{
    font-size:28px;
    font-weight:bold;
    color:#111;
    margin-bottom:15px;
    line-height:1.3;
}

#news-meta{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:25px;
    padding-bottom:20px;
    border-bottom:2px solid #e8f0fe;
    flex-wrap: wrap;
}

#news-image{
    width:100%;
    max-height:400px;
    object-fit:cover;
    border-radius:10px;
    margin-bottom:25px;
    background:#eee;
}

#news-body{
    font-size:18px;
    line-height:1.7;
    color:#333;
}

#news-body p{
    margin-bottom:20px;
}

#news-body img{
    max-width:100%;
    height:auto;
    border-radius:8px;
    margin:20px 0;
}

#news-body h1, #news-body h2, #news-body h3{
    color:#1a73e8;
    margin-top:30px;
    margin-bottom:15px;
}

#news-body a{
    color:#1a73e8;
    text-decoration:none;
    font-weight:500;
}

#news-body a:hover{
    text-decoration:underline;
}

#news-body blockquote{
    border-left:4px solid #1a73e8;
    padding-left:20px;
    margin:25px 0;
    font-style:italic;
    color:#555;
}

#news-body ul, #news-body ol{
    padding-left:25px;
    margin-bottom:20px;
}

#news-body li{
    margin-bottom:8px;
}

/* TAGS */
.source-tag{
    background:#e8f0fe;
    color:#1a73e8;
    padding:5px 12px;
    border-radius:20px;
    font-size:14px;
    font-weight:bold;
}

.category-tag {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
}

.sociedade-tag {
    background: rgba(76, 175, 80, 0.1);
    color: #2e7d32;
}

.politica-tag {
    background: rgba(244, 67, 54, 0.1);
    color: #c62828;
}

.economia-tag {
    background: rgba(255, 152, 0, 0.1);
    color: #ef6c00;
}

.esportes-tag {
    background: rgba(33, 150, 243, 0.1);
    color: #1565c0;
}

.cultura-tag {
    background: rgba(156, 39, 176, 0.1);
    color: #7b1fa2;
}

.saude-tag {
    background: rgba(0, 150, 136, 0.1);
    color: #00796b;
}

.tech-tag {
    background: rgba(96, 125, 139, 0.1);
    color: #37474f;
}

/* SHARE SECTION */
.share-section {
    margin: 40px 0 30px;
    padding-top: 30px;
    border-top: 2px solid #e8f0fe;
}

.share-title {
    font-size: 18px;
    color: #1a73e8;
    margin-bottom: 20px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 10px;
}

.share-buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.share-btn {
    padding: 12px 24px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
    min-width: 140px;
    justify-content: center;
}

.share-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.share-btn.facebook {
    background: #1877f2;
    color: white;
}

.share-btn.twitter {
    background: #1da1f2;
    color: white;
}

.share-btn.whatsapp {
    background: #25d366;
    color: white;
}

.share-btn.link {
    background: #6c757d;
    color: white;
}

.share-btn.link.copied {
    background: #28a745;
}

/* RELATED NEWS */
.related-news-section {
    margin-top: 50px;
    padding-top: 30px;
    border-top: 3px solid #e8f0fe;
}

.related-title {
    font-size: 22px;
    color: #1a73e8;
    margin-bottom: 25px;
    font-weight: bold;
}

.related-news-container {
    display: grid;
    gap: 20px;
    margin-top: 20px;
}

.related-news-card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    border-left: 5px solid #1a73e8;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 15px;
    text-decoration: none;
    color: inherit;
}

.related-news-card:hover {
    background: #e8f0fe;
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.related-news-img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
}

.related-news-text {
    flex: 1;
}

.related-news-title {
    font-size: 16px;
    font-weight: 600;
    color: #111;
    margin-bottom: 8px;
    line-height: 1.4;
}

.related-news-meta {
    font-size: 12px;
    color: #666;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* LOADER */
.loader {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #e8e8e8;
    border-top: 4px solid #1a73e8;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.error-message {
    text-align: center;
    padding: 50px;
    color: #666;
    font-size: 18px;
}

.error-message button {
    background: #1a73e8;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 20px;
    transition: all 0.3s;
}

.error-message button:hover {
    background: #0d62d9;
    transform: translateY(-2px);
}

/* FOOTER */
footer {
    text-align: center;
    padding: 30px 20px;
    color: #666;
    font-size: 14px;
    margin-top: 50px;
    border-top: 1px solid #ddd;
}

.back-home {
    display: inline-block;
    background: #1a73e8;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    margin-top: 15px;
    transition: all 0.3s;
}

.back-home:hover {
    background: #0d62d9;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header>
<button class="header-btn" id="back-btn" onclick="goBack()">‚Üê Voltar</button>
Not√≠cias CLD
</header>

<div id="news-container">
<div id="news-content">
    <div id="loader" class="loader">
        <div class="spinner"></div>
        <div style="margin-left: 15px; color: #666;">Carregando not√≠cia...</div>
    </div>
    
    <div id="news-error" class="error-message" style="display: none;">
        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #ff9800; margin-bottom: 20px;"></i>
        <h3>Not√≠cia n√£o encontrada</h3>
        <p>A not√≠cia que voc√™ est√° procurando n√£o est√° dispon√≠vel ou foi removida.</p>
        <button onclick="window.location.href='index.html'">Voltar para a p√°gina inicial</button>
    </div>
    
    <div id="news-display" style="display: none;">
        <h1 id="news-title"></h1>
        <div id="news-meta"></div>
        <img id="news-image" src="" alt="">
        <div id="news-body"></div>
        
        <div class="share-section">
            <div class="share-title">
                <i class="fas fa-share-alt"></i> Compartilhar esta not√≠cia:
            </div>
            <div class="share-buttons">
                <button class="share-btn facebook" onclick="shareOnFacebook()">
                    <i class="fab fa-facebook-f"></i> Facebook
                </button>
                <button class="share-btn twitter" onclick="shareOnTwitter()">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="share-btn whatsapp" onclick="shareOnWhatsApp()">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
                <button class="share-btn link" onclick="copyLink()">
                    <i class="fas fa-link"></i> Copiar Link
                </button>
            </div>
        </div>
        
        <div class="related-news-section">
            <div class="related-title">
                <i class="fas fa-newspaper"></i> Not√≠cias Relacionadas
            </div>
            <div class="related-news-container" id="related-news-container">
                <!-- Not√≠cias relacionadas ser√£o carregadas aqui -->
            </div>
        </div>
    </div>
</div>
</div>

<footer>
<p>¬© 2024 Not√≠cias CLD - Agregador de not√≠cias de Mo√ßambique</p>
<a href="index.html" class="back-home">
    <i class="fas fa-home"></i> Voltar para a p√°gina inicial
</a>
</footer>

<script>
// CATEGORIAS DISPON√çVEIS
const CATEGORIES = {
    'sociedade': { name: 'Sociedade', class: 'sociedade-tag' },
    'pol√≠tica': { name: 'Pol√≠tica', class: 'politica-tag' },
    'economia': { name: 'Economia', class: 'economia-tag' },
    'esportes': { name: 'Esportes', class: 'esportes-tag' },
    'cultura': { name: 'Cultura', class: 'cultura-tag' },
    'sa√∫de': { name: 'Sa√∫de', class: 'saude-tag' },
    'tecnologia': { name: 'Tecnologia', class: 'tech-tag' }
};

let currentArticle = null;

// Fun√ß√£o para formatar data
function formatDate(d) {
    return new Date(d).toLocaleString("pt-PT");
}

// Fun√ß√£o para voltar
function goBack() {
    if (document.referrer.includes(window.location.hostname)) {
        window.history.back();
    } else {
        window.location.href = 'index.html';
    }
}

// Fun√ß√µes de compartilhamento
function getShareUrl() {
    return window.location.href;
}

function getShareText() {
    return `üì∞ ${currentArticle.title} | Not√≠cias de Mo√ßambique`;
}

function shareOnFacebook() {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(getShareUrl())}&quote=${encodeURIComponent(getShareText())}`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareOnTwitter() {
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(getShareText())}&url=${encodeURIComponent(getShareUrl())}`;
    window.open(url, '_blank', 'width=600,height=400');
}

function shareOnWhatsApp() {
    const text = `${getShareText()} - ${getShareUrl()}`;
    const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank', 'width=600,height=600');
}

function copyLink() {
    const button = document.querySelector('.share-btn.link');
    navigator.clipboard.writeText(getShareUrl()).then(() => {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i> Link Copiado!';
        button.classList.add('copied');
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('copied');
        }, 2000);
    }).catch(err => {
        console.error('Erro ao copiar link:', err);
        alert('N√£o foi poss√≠vel copiar o link');
    });
}

// Carrega artigo pelo hash
function loadArticleByHash(hash) {
    const articles = JSON.parse(localStorage.getItem('noticias') || '[]');
    return articles.find(article => article.hash === hash);
}

// Processa conte√∫do HTML
function processContent(content) {
    // Remove scripts e estilos inline
    let processed = content.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
    processed = processed.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');
    
    // Garante que imagens n√£o excedam a largura do container
    processed = processed.replace(/<img/g, '<img style="max-width:100%;height:auto;"');
    
    return processed;
}

// Determina categoria baseada no conte√∫do
function determineCategory(title, content) {
    const text = (title + ' ' + content).toLowerCase();
    
    const keywords = {
        'sociedade': ['sociedade', 'social', 'comunidade', 'educa√ß√£o', 'escola', 'universidade', 
                     'aluno', 'professor', 'fam√≠lia', 'habita√ß√£o', 'bairro', 'comunit√°rio'],
        'pol√≠tica': ['pol√≠tica', 'pol√≠tico', 'governo', 'presidente', 'ministro', 'elei√ß√µes', 
                    'partido', 'parlamento', 'assembleia', 'diplomacia', 'embaixada', 'voto'],
        'economia': ['economia', 'econ√¥mico', 'neg√≥cio', 'empresa', 'investimento', 'banco', 
                    'finan√ßas', 'mercado', 'bolsa', 'imposto', 'crescimento', 'infla√ß√£o'],
        'esportes': ['esporte', 'futebol', 'jogo', 'atleta', 'campeonato', 'liga', 
                    'competi√ß√£o', 'gin√°sio', 'treino', 'sele√ß√£o', 'est√°dio', 'golo'],
        'cultura': ['cultura', 'cultural', 'arte', 'm√∫sica', 'teatro', 'cinema', 
                   'literatura', 'poesia', 'tradi√ß√£o', 'festival', 'exposi√ß√£o', 'artista'],
        'sa√∫de': ['sa√∫de', 'hospital', 'm√©dico', 'enfermeiro', 'doen√ßa', 'vacina', 
                 'tratamento', 'cl√≠nica', 'epidemia', 'pandemia', 'medicamento', 'cirurgia'],
        'tecnologia': ['tecnologia', 'tecnol√≥gico', 'internet', 'digital', 'aplicativo', 
                      'software', 'startup', 'inova√ß√£o', 'ci√™ncia', 'pesquisa', 'rob√¥', 'IA']
    };
    
    let scores = {};
    Object.keys(keywords).forEach(cat => {
        scores[cat] = 0;
        keywords[cat].forEach(keyword => {
            if (text.includes(keyword)) {
                scores[cat]++;
            }
        });
    });
    
    let maxScore = 0;
    let selectedCategory = 'sociedade';
    
    Object.keys(scores).forEach(cat => {
        if (scores[cat] > maxScore) {
            maxScore = scores[cat];
            selectedCategory = cat;
        }
    });
    
    if (maxScore === 0) {
        if (title.toLowerCase().includes('futebol') || title.toLowerCase().includes('desporto')) {
            return 'esportes';
        } else if (title.toLowerCase().includes('econ') || title.toLowerCase().includes('neg√≥cio')) {
            return 'economia';
        } else if (title.toLowerCase().includes('arte') || title.toLowerCase().includes('m√∫sica')) {
            return 'cultura';
        } else if (title.toLowerCase().includes('hospital') || title.toLowerCase().includes('m√©dico')) {
            return 'sa√∫de';
        } else if (title.toLowerCase().includes('tech') || title.toLowerCase().includes('digital')) {
            return 'tecnologia';
        } else {
            const categories = Object.keys(CATEGORIES);
            return categories[Math.floor(Math.random() * categories.length)];
        }
    }
    
    return selectedCategory;
}

// Carrega not√≠cias relacionadas
function loadRelatedNews() {
    const container = document.getElementById("related-news-container");
    if (!container || !currentArticle) return;
    
    const articles = JSON.parse(localStorage.getItem('noticias') || '[]');
    const category = currentArticle.category || determineCategory(currentArticle.title, currentArticle.content);
    const titleWords = currentArticle.title.toLowerCase().split(' ');
    
    // Filtra not√≠cias relacionadas
    const related = articles.filter(article => {
        if (article.hash === currentArticle.hash) return false;
        
        // Prioridade 1: mesma categoria
        const articleCategory = article.category || determineCategory(article.title, article.content);
        if (articleCategory === category) return true;
        
        // Prioridade 2: t√≠tulos com palavras similares
        const commonWords = titleWords.filter(word => 
            word.length > 3 && article.title.toLowerCase().includes(word)
        );
        
        return commonWords.length >= 2;
    }).slice(0, 3); // M√°ximo 3 not√≠cias
    
    displayRelatedArticles(related);
}

// Exibe not√≠cias relacionadas
function displayRelatedArticles(articles) {
    const container = document.getElementById("related-news-container");
    if (!container) return;
    
    if (articles.length === 0) {
        container.innerHTML = `
            <div style="text-align:center; padding:30px; color:#666; background:#f8f9fa; border-radius:8px;">
                <i class="fas fa-newspaper" style="font-size:32px; margin-bottom:15px; color:#ccc;"></i>
                <p>Nenhuma not√≠cia relacionada encontrada.</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    articles.forEach(article => {
        const category = article.category || determineCategory(article.title, article.content);
        const slug = createSlug(article.title);
        
        html += `
        <a href="leitura.html?slug=${slug}&hash=${article.hash}" class="related-news-card">
            <img src="${article.image}" class="related-news-img" alt="${article.title}" onerror="this.src='https://via.placeholder.com/80x80/1a73e8/ffffff?text=${encodeURIComponent(article.source.substring(0,2))}'">
            <div class="related-news-text">
                <div class="related-news-title">${article.title.substring(0, 80)}${article.title.length > 80 ? '...' : ''}</div>
                <div class="related-news-meta">
                    <span class="source-tag">${article.source}</span>
                    <span class="category-tag ${CATEGORIES[category].class}">${CATEGORIES[category].name}</span>
                </div>
            </div>
        </a>
        `;
    });
    
    container.innerHTML = html;
}

// Cria slug amig√°vel
function createSlug(title) {
    return title
        .toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/--+/g, '-')
        .trim()
        .substring(0, 60);
}

// Inicializa a p√°gina
function initPage() {
    const urlParams = new URLSearchParams(window.location.search);
    const hash = urlParams.get('hash');
    const slug = urlParams.get('slug');
    
    if (!hash) {
        showError();
        return;
    }
    
    // Tenta carregar do localStorage
    const article = loadArticleByHash(hash);
    
    if (!article) {
        showError();
        return;
    }
    
    // Atualiza t√≠tulo da p√°gina
    document.title = `${article.title} - Not√≠cias CLD`;
    
    // Atualiza meta description
    const metaDesc = document.querySelector('meta[name="description"]');
    if (metaDesc) {
        metaDesc.content = article.title.substring(0, 160);
    }
    
    currentArticle = article;
    displayArticle(article);
    
    // Carrega not√≠cias relacionadas
    setTimeout(loadRelatedNews, 500);
}

// Exibe o artigo na p√°gina
function displayArticle(article) {
    const category = article.category || determineCategory(article.title, article.content);
    article.category = category;
    
    // Atualiza elementos da p√°gina
    document.getElementById('news-title').textContent = article.title;
    
    const metaHTML = `
        <span class="source-tag">${article.source}</span>
        <span class="category-tag ${CATEGORIES[category].class}">${CATEGORIES[category].name}</span>
        <span style="color:#666;">${formatDate(article.date)}</span>
    `;
    document.getElementById('news-meta').innerHTML = metaHTML;
    
    const image = document.getElementById('news-image');
    image.src = article.image;
    image.alt = article.title;
    image.onerror = function() {
        this.style.display = 'none';
    };
    
    document.getElementById('news-body').innerHTML = processContent(article.content);
    
    // Esconde loader e mostra conte√∫do
    document.getElementById('loader').style.display = 'none';
    document.getElementById('news-display').style.display = 'block';
}

// Mostra mensagem de erro
function showError() {
    document.getElementById('loader').style.display = 'none';
    document.getElementById('news-error').style.display = 'block';
}

// Atalhos de teclado
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' || (e.ctrlKey && e.key === 'b')) {
        goBack();
    }
    
    if (e.key === 'c' && e.ctrlKey) {
        copyLink();
    }
});

// Inicializa quando a p√°gina carrega
window.addEventListener('DOMContentLoaded', initPage);
</script>
</body>
</html>