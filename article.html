<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta Tags Dinﾃ｢micas -->
    <title>Carregando Artigo - Notﾃｭcias CLD</title>
    <meta name="description" content="Lendo artigo no Notﾃｭcias CLD">
    
    <!-- Open Graph Dinﾃ｢mico -->
    <meta property="og:title" content="Carregando Artigo">
    <meta property="og:description" content="Lendo artigo no Notﾃｭcias CLD">
    <meta property="og:type" content="article">
    <meta property="og:image" content="">
    <meta property="og:url" content="">
    
    <!-- Twitter Card Dinﾃ｢mico -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Carregando Artigo">
    <meta name="twitter:description" content="Lendo artigo no Notﾃｭcias CLD">
    
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d62d9;
            --secondary: #5f6368;
            --background: #ffffff;
            --text: #202124;
            --text-light: #5f6368;
            --border: #dadce0;
            --shadow: 0 1px 3px rgba(0,0,0,0.12);
            --radius: 12px;
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }
        
        /* Header */
        .article-header {
            background: var(--primary);
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(-2px);
        }
        
        .header-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .header-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .header-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .header-btn.saved {
            background: rgba(251, 188, 4, 0.2);
        }
        
        /* Article Container */
        .article-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(26, 115, 232, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Article Content */
        .article-content {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .article-title {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
            color: var(--text);
        }
        
        @media (max-width: 768px) {
            .article-title {
                font-size: 2rem;
            }
        }
        
        .article-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .article-source {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .article-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .read-time {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .article-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            background: #f8f9fa;
        }
        
        .image-caption {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            font-style: italic;
        }
        
        .article-body {
            font-size: 1.125rem;
            line-height: 1.8;
            margin-bottom: 3rem;
        }
        
        .article-body p {
            margin-bottom: 1.5rem;
        }
        
        .article-body h2 {
            font-size: 1.75rem;
            margin: 2rem 0 1rem;
            color: var(--text);
        }
        
        .article-body h3 {
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem;
            color: var(--text);
        }
        
        .article-body blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            font-style: italic;
            color: var(--text-light);
        }
        
        .article-body ul, .article-body ol {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .article-body li {
            margin-bottom: 0.5rem;
        }
        
        /* Share Section */
        .share-section {
            background: #f8f9fa;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .share-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }
        
        .share-buttons {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .share-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .share-btn.facebook {
            background: #1877f2;
            color: white;
        }
        
        .share-btn.twitter {
            background: #1da1f2;
            color: white;
        }
        
        .share-btn.whatsapp {
            background: #25d366;
            color: white;
        }
        
        .share-btn.link {
            background: var(--text-light);
            color: white;
        }
        
        .share-btn.link.copied {
            background: #34a853;
        }
              /* Related Articles */
        .related-section {
            margin: 3rem 0;
            padding-top: 2rem;
            border-top: 2px solid var(--border);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 640px) {
            .related-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .related-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .related-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }
        
        .related-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
        }
        
        .related-card-content {
            padding: 1rem;
        }
        
        .related-card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .related-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        /* Footer */
        .article-footer {
            text-align: center;
            padding: 2rem 1rem;
            margin-top: 3rem;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 10000;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        
        /* Error State */
        .error-state {
            text-align: center;
            padding: 3rem 1rem;
        }
        
        .error-icon {
            font-size: 3rem;
            color: #ea4335;
            margin-bottom: 1rem;
        }
        
        /* Font Controls */
        .font-controls {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .font-btn {
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .font-btn:hover {
            background: rgba(0,0,0,0.05);
        }
        
        /* Progress Bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: var(--primary);
            z-index: 1001;
            transition: width 0.1s;
        }
        
        /* CLD Mini Aggregator */
        .cld-aggregator {
            background: linear-gradient(135deg, #1a73e8, #0d62d9);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 3rem 0;
            color: white;
        }
        
        .cld-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .cld-logo {
            background: white;
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .cld-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .cld-subtitle {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }
        
        .cld-articles {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .cld-articles {
                grid-template-columns: 1fr;
            }
        }
        
        .cld-article {
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .cld-article:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .cld-article-title {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .cld-article-meta {
            font-size: 0.8rem;
            opacity: 0.8;
        }
    </style>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar" id="progress-bar"></div>
   <!-- Header -->
    <header class="article-header">
        <div class="header-content">
            <button class="back-btn" id="back-btn">
                <i class="fas fa-arrow-left"></i>
            </button>
            
            <div class="header-actions">
                <button class="header-btn" id="save-btn">
                    <i class="fas fa-bookmark-o"></i>
                </button>
                <button class="header-btn" id="share-btn">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button class="header-btn" id="font-toggle">
                    <i class="fas fa-font"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Loading State -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Carregando artigo...</p>
    </div>
    
    <!-- Article Content -->
    <div class="article-container">
        <article class="article-content" id="article-content" style="display: none;">
            <!-- Article will be loaded here -->
        </article>
        
        <!-- CLD Mini Aggregator -->
        <div class="cld-aggregator" id="cld-aggregator" style="display: none;">
            <div class="cld-header">
                <div class="cld-logo">CLD</div>
                <div>
                    <h2 class="cld-title">Notﾃｭcias CLD</h2>
                    <p class="cld-subtitle">Mais notﾃｭcias que podem interessar</p>
                </div>
            </div>
            <div class="cld-articles" id="cld-articles">
                <!-- Related articles loaded here -->
            </div>
        </div>
        
        <!-- Error State -->
        <div class="error-state" id="error-state" style="display: none;">
            <div class="error-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Artigo nﾃ｣o encontrado</h2>
            <p id="error-message">O artigo que vocﾃｪ estﾃ｡ procurando nﾃ｣o existe ou foi removido.</p>
            <button onclick="window.location.href='index.html'" style="margin-top:1rem; padding:0.75rem 1.5rem; background:var(--primary); color:white; border:none; border-radius:var(--radius); cursor:pointer;">
                Voltar para notﾃｭcias
            </button>
        </div>
    </div>
    
    <!-- Font Controls -->
    <div class="font-controls" id="font-controls" style="display: none;">
        <button class="font-btn" id="font-decrease" title="Diminuir fonte">
            <i class="fas fa-minus"></i>
        </button>
        <button class="font-btn" id="font-reset" title="Tamanho normal">
            <i class="fas fa-text-height"></i>
        </button>
        <button class="font-btn" id="font-increase" title="Aumentar fonte">
            <i class="fas fa-plus"></i>
        </button>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message"></span>
    </div>
    
    <script>
        // ================= CONFIGURAﾃﾃグ =================
        const CONFIG = {
            APP_NAME: 'Notﾃｭcias CLD',
            RELATED_ARTICLES_COUNT: 6,
            FONT_SIZE_KEY: 'cld_font_size',
            CACHE_DURATION: 15 * 60 * 1000, // 15 minutos
            SHARE_URL_BASE: 'https://noticias-cld.com/article.html'
        };

        // ================= ESTADO GLOBAL =================
        const state = {
            article: null,
            savedArticles: new Set(),
            relatedArticles: [],
            fontSize: 1.0,
            isArticleSaved: false,
            shareData: null
        };

        // ================= ELEMENTOS DOM =================
        const elements = {
            // Containers
            loading: document.getElementById('loading'),
            articleContent: document.getElementById('article-content'),
            errorState: document.getElementById('error-state'),
            errorMessage: document.getElementById('error-message'),
            cldAggregator: document.getElementById('cld-aggregator'),
            cldArticles: document.getElementById('cld-articles'),
            
            // Buttons
            backBtn: document.getElementById('back-btn'),
            saveBtn: document.getElementById('save-btn'),
            shareBtn: document.getElementById('share-btn'),
            fontToggle: document.getElementById('font-toggle'),
            
            // Controls
            fontControls: document.getElementById('font-controls'),
            fontDecrease: document.getElementById('font-decrease'),
            fontReset: document.getElementById('font-reset'),
            fontIncrease: document.getElementById('font-increase'),
            
            // Progress
            progressBar: document.getElementById('progress-bar'),
            
            // Toast
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toast-message')
        };

        // ================= INICIALIZAﾃﾃグ =================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('当 Iniciando leitor de artigo...');
            
            // Carregar estado salvo
            loadSavedState();
            
            // Configurar event listeners
            setupEventListeners();
            
            // Processar URL e carregar artigo
            await loadArticleFromUrl();
            
            // Configurar controles de fonte
            setupFontControls();
            
            // Configurar progresso de leitura
            setupReadingProgress();
            
            console.log('笨 Artigo carregado com sucesso!');
        });
        // ================= CARREGAMENTO DE ARTIGO =================
        async function loadArticleFromUrl() {
            try {
                // Obter parﾃ｢metros da URL
                const urlParams = new URLSearchParams(window.location.search);
                const articleId = urlParams.get('id');
                const slug = urlParams.get('slug');
                
                if (!articleId) {
                    throw new Error('ID do artigo nﾃ｣o especificado');
                }
                
                // Tentar carregar do cache/sessionStorage primeiro
                const cached = getCachedArticle(articleId);
                if (cached) {
                    state.article = cached;
                    renderArticle();
                    await loadRelatedArticles();
                    return;
                }
                
                // Se nﾃ｣o encontrado no cache, carregar do mock/API
                await fetchArticle(articleId, slug);
                
                // Carregar artigos relacionados
                await loadRelatedArticles();
                
            } catch (error) {
                console.error('Erro ao carregar artigo:', error);
                showError(error.message || 'Nﾃ｣o foi possﾃｭvel carregar o artigo');
            }
        }

        async function fetchArticle(articleId, slug) {
            try {
                // Gerar artigo mock (substituir por API real)
                state.article = await generateMockArticle(articleId, slug);
                
                // Validar artigo
                if (!state.article) {
                    throw new Error('Artigo nﾃ｣o encontrado');
                }
                
                // Cachear artigo
                cacheArticle(state.article);
                
                // Renderizar
                renderArticle();
                
            } catch (error) {
                console.error('Erro na busca do artigo:', error);
                throw error;
            }
        }

        // ================= RENDERIZAﾃﾃグ =================
        function renderArticle() {
            // Esconder loading, mostrar conteﾃｺdo
            elements.loading.style.display = 'none';
            elements.articleContent.style.display = 'block';
            elements.fontControls.style.display = 'flex';
            
            // Atualizar meta tags
            updateMetaTags();
            
            // Verificar se artigo estﾃ｡ salvo
            state.isArticleSaved = state.savedArticles.has(state.article.id);
            updateSaveButton();
            
            // Gerar conteﾃｺdo do artigo
            const articleHtml = generateArticleHtml();
            elements.articleContent.innerHTML = articleHtml;
            
            // Configurar botﾃｵes de aﾃｧﾃ｣o
            setupActionButtons();
            
            // Atualizar share data
            updateShareData();
            
            // Mostrar conteﾃｺdo com animaﾃｧﾃ｣o
            setTimeout(() => {
                elements.articleContent.style.opacity = '1';
            }, 100);
        }

        function generateArticleHtml() {
            const { article } = state;
            
            return `
                <h1 class="article-title">${article.title}</h1>
                
                <div class="article-meta">
                    <span class="article-source">${article.source}</span>
                    <span class="article-date">${formatArticleDate(article.date)}</span>
                    <span class="read-time">
                        <i class="fas fa-clock"></i>
                        ${article.readTime}
                    </span>
                </div>
                
                ${article.image ? `
                    <img src="${article.image}" alt="${article.title}" class="article-image">
                    <p class="image-caption">Foto: ${article.source}</p>
                ` : ''}
                
                <div class="article-body" id="article-body">
                    ${article.content}
                </div>
                
                ${article.author ? `
                    <div class="author-info" style="background:#f8f9fa; padding:1.5rem; border-radius:var(--radius); margin:2rem 0;">
                        <p><strong>Autor:</strong> ${article.author}</p>
                    </div>
                ` : ''}
                
                <div class="share-section">
                    <h3 class="share-title">Compartilhar este artigo:</h3>
                    <div class="share-buttons">
                        <button class="share-btn facebook" id="share-facebook">
                            <i class="fab fa-facebook-f"></i> Facebook
                        </button>
                        <button class="share-btn twitter" id="share-twitter">
                            <i class="fab fa-twitter"></i> Twitter
                        </button>
                        <button class="share-btn whatsapp" id="share-whatsapp">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button class="share-btn link" id="share-link">
                            <i class="fas fa-link"></i> Copiar Link
                        </button>
                    </div>
                </div>
            `;
        }

        // ================= CLD MINI AGGREGATOR =================
        async function loadRelatedArticles() {
            try {
                // Gerar artigos relacionados mock (substituir por API)
                state.relatedArticles = await generateRelatedArticles();
                
                // Renderizar agregador CLD
                renderCLDAggregator();
                
            } catch (error) {
                console.error('Erro ao carregar artigos relacionados:', error);
                elements.cldAggregator.style.display = 'none';
            }
        }

        function renderCLDAggregator() {
            if (state.relatedArticles.length === 0) {
                elements.cldAggregator.style.display = 'none';
                return;
            }
            
            // Renderizar artigos do agregador CLD
            elements.cldArticles.innerHTML = state.relatedArticles.map(article => `
                <div class="cld-article" onclick="openRelatedArticle('${article.id}', '${encodeURIComponent(article.title)}')">
                    <h4 class="cld-article-title">${article.title}</h4>
                    <div class="cld-article-meta">
                        <span>${article.source}</span>
                        <span>窶｢</span>
                        <span>${formatRelativeDate(article.date)}</span>
                    </div>
                </div>
            `).join('');
            
            elements.cldAggregator.style.display = 'block';
        }
       // ================= COMPARTILHAMENTO =================
        function updateShareData() {
            if (!state.article) return;
            
            const canonicalUrl = `${CONFIG.SHARE_URL_BASE}?id=${state.article.id}&slug=${encodeURIComponent(state.article.title.toLowerCase().replace(/\s+/g, '-'))}`;
            const currentUrl = window.location.href;
            
            state.shareData = {
                url: canonicalUrl,
                title: `${state.article.title} | Notﾃｭcias CLD`,
                text: `${state.article.title} - ${state.article.source}`,
                canonical: canonicalUrl,
                fallbackUrl: currentUrl
            };
        }

        function setupActionButtons() {
            // Facebook
            document.getElementById('share-facebook')?.addEventListener('click', () => {
                shareOnFacebook();
            });
            
            // Twitter
            document.getElementById('share-twitter')?.addEventListener('click', () => {
                shareOnTwitter();
            });
            
            // WhatsApp
            document.getElementById('share-whatsapp')?.addEventListener('click', () => {
                shareOnWhatsApp();
            });
            
            // Copiar link
            document.getElementById('share-link')?.addEventListener('click', () => {
                copyArticleLink();
            });
        }

        function shareOnFacebook() {
            if (!state.shareData) return;
            
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(state.shareData.url)}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        function shareOnTwitter() {
            if (!state.shareData) return;
            
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(state.shareData.text)}&url=${encodeURIComponent(state.shareData.url)}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        function shareOnWhatsApp() {
            if (!state.shareData) return;
            
            const url = `https://wa.me/?text=${encodeURIComponent(state.shareData.text + ' ' + state.shareData.url)}`;
            window.open(url, '_blank', 'width=600,height=600');
        }

        function copyArticleLink() {
            if (!state.shareData) return;
            
            const link = document.getElementById('share-link');
            const originalText = link.innerHTML;
            
            navigator.clipboard.writeText(state.shareData.url)
                .then(() => {
                    link.innerHTML = '<i class="fas fa-check"></i> Copiado!';
                    link.classList.add('copied');
                    showToast('Link copiado para a ﾃ｡rea de transferﾃｪncia');
                    
                    setTimeout(() => {
                        link.innerHTML = originalText;
                        link.classList.remove('copied');
                    }, 2000);
                })
                .catch(err => {
                    console.error('Erro ao copiar:', err);
                    showToast('Erro ao copiar link');
                });
        }

        // ================= SISTEMA DE SALVAR =================
        function toggleSaveArticle() {
            if (!state.article) return;
            
            if (state.isArticleSaved) {
                // Remover dos salvos
                state.savedArticles.delete(state.article.id);
                state.isArticleSaved = false;
                showToast('Artigo removido dos salvos');
            } else {
                // Adicionar aos salvos
                state.savedArticles.add(state.article.id);
                state.isArticleSaved = true;
                showToast('Artigo salvo!');
            }
            
            // Atualizar UI
            updateSaveButton();
            saveToLocalStorage();
            
            // Atualizar contador na pﾃ｡gina principal
            updateIndexPageSaveCount();
        }

        function updateSaveButton() {
            const icon = elements.saveBtn.querySelector('i');
            if (state.isArticleSaved) {
                icon.className = 'fas fa-bookmark';
                elements.saveBtn.classList.add('saved');
            } else {
                icon.className = 'fas fa-bookmark-o';
                elements.saveBtn.classList.remove('saved');
            }
        }

        // ================= CONTROLES DE FONTE =================
        function setupFontControls() {
            // Carregar tamanho salvo
            const savedSize = localStorage.getItem(CONFIG.FONT_SIZE_KEY);
            if (savedSize) {
                state.fontSize = parseFloat(savedSize);
                applyFontSize();
            }
            
            // Event listeners
            elements.fontDecrease.addEventListener('click', decreaseFontSize);
            elements.fontReset.addEventListener('click', resetFontSize);
            elements.fontIncrease.addEventListener('click', increaseFontSize);
            elements.fontToggle.addEventListener('click', toggleFontControls);
            
            // Atalhos de teclado
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === '-') {
                    e.preventDefault();
                    decreaseFontSize();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === '0') {
                    e.preventDefault();
                    resetFontSize();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === '+') {
                    e.preventDefault();
                    increaseFontSize();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === '=') {
                    e.preventDefault();
                    increaseFontSize();
                }
            });
        }

        function decreaseFontSize() {
            if (state.fontSize > 0.8) {
                state.fontSize -= 0.1;
                applyFontSize();
                saveFontSize();
                showToast(`Tamanho da fonte: ${Math.round(state.fontSize * 100)}%`);
            }
        }

        function resetFontSize() {
            state.fontSize = 1.0;
            applyFontSize();
            saveFontSize();
            showToast('Tamanho da fonte resetado');
        }

        function increaseFontSize() {
            if (state.fontSize < 1.5) {
                state.fontSize += 0.1;
                applyFontSize();
                saveFontSize();
                showToast(`Tamanho da fonte: ${Math.round(state.fontSize * 100)}%`);
            }
        }

        function applyFontSize() {
            document.documentElement.style.fontSize = `${state.fontSize * 100}%`;
        }

        function saveFontSize() {
            localStorage.setItem(CONFIG.FONT_SIZE_KEY, state.fontSize.toString());
        }

        function toggleFontControls() {
            elements.fontControls.style.display = 
                elements.fontControls.style.display === 'none' ? 'flex' : 'none';
        }
        // ================= PROGRESSO DE LEITURA =================
        function setupReadingProgress() {
            window.addEventListener('scroll', updateProgressBar);
        }

        function updateProgressBar() {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            
            elements.progressBar.style.width = scrolled + '%';
        }

        // ================= META TAGS DINﾃMICAS =================
        function updateMetaTags() {
            if (!state.article) return;
            
            // Tﾃｭtulo
            document.title = `${state.article.title} | Notﾃｭcias CLD`;
            
            // Descriﾃｧﾃ｣o
            const description = state.article.excerpt || 
                state.article.content.substring(0, 160) + '...';
            
            updateMeta('description', description);
            
            // Open Graph
            updateMeta('og:title', state.article.title);
            updateMeta('og:description', description);
            updateMeta('og:image', state.article.image || 'https://via.placeholder.com/1200x630/1a73e8/ffffff?text=Not%C3%ADcias+CLD');
            updateMeta('og:url', state.shareData?.url || window.location.href);
            updateMeta('og:type', 'article');
            
            // Twitter Card
            updateMeta('twitter:title', state.article.title);
            updateMeta('twitter:description', description);
            updateMeta('twitter:image', state.article.image || 'https://via.placeholder.com/1200x630/1a73e8/ffffff?text=Not%C3%ADcias+CLD');
            updateMeta('twitter:card', 'summary_large_image');
            
            // Canonical URL
            updateLink('canonical', state.shareData?.url || window.location.href);
        }

        function updateMeta(name, content) {
            let meta = document.querySelector(`meta[name="${name}"]`) || 
                      document.querySelector(`meta[property="${name}"]`);
            
            if (!meta) {
                meta = document.createElement('meta');
                if (name.startsWith('og:')) {
                    meta.setAttribute('property', name);
                } else {
                    meta.setAttribute('name', name);
                }
                document.head.appendChild(meta);
            }
            
            meta.setAttribute('content', content);
        }

        function updateLink(rel, href) {
            let link = document.querySelector(`link[rel="${rel}"]`);
            
            if (!link) {
                link = document.createElement('link');
                link.setAttribute('rel', rel);
                document.head.appendChild(link);
            }
            
            link.setAttribute('href', href);
        }

        // ================= EVENT LISTENERS =================
        function setupEventListeners() {
            // Botﾃ｣o voltar
            elements.backBtn.addEventListener('click', () => {
                if (document.referrer && document.referrer.includes(window.location.hostname)) {
                    window.history.back();
                } else {
                    window.location.href = 'index.html';
                }
            });
            
            // Botﾃ｣o salvar
            elements.saveBtn.addEventListener('click', toggleSaveArticle);
            
            // Botﾃ｣o compartilhar
            elements.shareBtn.addEventListener('click', showShareOptions);
            
            // Atalhos de teclado
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    window.history.back();
                }
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    toggleSaveArticle();
                }
            });
        }

        // ================= NAVEGAﾃﾃグ =================
        function openRelatedArticle(articleId, title) {
            // Salvar no sessionStorage para prﾃｩ-carregamento
            const relatedArticle = state.relatedArticles.find(a => a.id === articleId);
            if (relatedArticle) {
                sessionStorage.setItem('currentArticle', JSON.stringify(relatedArticle));
            }
            
            // Navegar para o artigo
            window.location.href = `article.html?id=${articleId}&title=${title}`;
        }

        // ================= LOCALSTORAGE =================
        function loadSavedState() {
            try {
                // Carregar artigos salvos
                const saved = localStorage.getItem('cld_saved_articles');
                if (saved) {
                    state.savedArticles = new Set(JSON.parse(saved));
                }
                
                // Carregar artigo atual do sessionStorage (prﾃｩ-carregamento)
                const current = sessionStorage.getItem('currentArticle');
                if (current) {
                    const parsed = JSON.parse(current);
                    // Verificar se ﾃｩ o mesmo artigo que estﾃ｡ na URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const articleId = urlParams.get('id');
                    
                    if (parsed.id === articleId) {
                        state.article = parsed;
                        sessionStorage.removeItem('currentArticle');
                    }
                }
                
            } catch (error) {
                console.error('Erro ao carregar estado:', error);
            }
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('cld_saved_articles', 
                    JSON.stringify(Array.from(state.savedArticles))
                );
            } catch (error) {
                console.error('Erro ao salvar:', error);
            }
        }

        function cacheArticle(article) {
            try {
                const cacheData = {
                    article: article,
                    timestamp: Date.now()
                };
                
                localStorage.setItem(`cld_article_${article.id}`, JSON.stringify(cacheData));
                
            } catch (error) {
                console.error('Erro ao cachear artigo:', error);
            }
        }

        function getCachedArticle(articleId) {
            try {
                const cached = localStorage.getItem(`cld_article_${articleId}`);
                if (cached) {
                    const data = JSON.parse(cached);
                    if (Date.now() - data.timestamp < CONFIG.CACHE_DURATION) {
                        return data.article;
                    }
                }
            } catch (error) {
                console.error('Erro ao obter cache:', error);
            }
            return null;
        }

        // ================= UTILITﾃヽIOS =================
        function showToast(message, duration = 3000) {
            elements.toastMessage.textContent = message;
            elements.toast.classList.add('show');
            
            setTimeout(() => {
                elements.toast.classList.remove('show');
            }, duration);
        }

        function showError(message) {
            elements.loading.style.display = 'none';
            elements.errorState.style.display = 'block';
            elements.errorMessage.textContent = message;
        }

        function showShareOptions() {
            if (navigator.share && state.shareData) {
                navigator.share({
                    title: state.shareData.title,
                    text: state.shareData.text,
                    url: state.shareData.url
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        copyArticleLink();
                    }
                });
            } else {
                copyArticleLink();
            }
        }

        function formatArticleDate(date) {
            const d = new Date(date);
            return d.toLocaleDateString('pt-MZ', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatRelativeDate(date) {
            const now = new Date();
            const d = new Date(date);
            const diff = now - d;
            
            if (diff < 86400000) return 'Hoje';
            if (diff < 172800000) return 'Ontem';
            if (diff < 604800000) return `${Math.floor(diff / 86400000)} dias atrﾃ｡s`;
            
            return d.toLocaleDateString('pt-MZ', { 
                day: 'numeric', 
                month: 'short' 
            });
        }

        function updateIndexPageSaveCount() {
            // Esta funﾃｧﾃ｣o seria chamada para atualizar o contador na pﾃ｡gina principal
            // Em um sistema real, vocﾃｪ usaria eventos ou localStorage compartilhado
        }
      // ================= MOCK DATA (REMOVER EM PRODUﾃﾃグ) =================
        async function generateMockArticle(articleId, slug) {
            // Base de dados mock de artigos
            const mockArticles = {
                '12345': {
                    id: '12345',
                    title: 'Governo anuncia novas medidas econﾃｳmicas para 2024',
                    content: `
                        <p>O governo moﾃｧambicano anunciou hoje um pacote de medidas econﾃｳmicas destinadas a impulsionar o crescimento e a criaﾃｧﾃ｣o de emprego no paﾃｭs. As novas polﾃｭticas incluem incentivos fiscais para pequenas e mﾃｩdias empresas, bem como investimentos em infraestruturas crﾃｭticas.</p>
                        
                        <h2>Principais medidas anunciadas</h2>
                        <p>Entre as principais medidas destacam-se:</p>
                        <ul>
                            <li>Reduﾃｧﾃ｣o do IVA para empresas exportadoras</li>
                            <li>Programas de financiamento para startups tecnolﾃｳgicas</li>
                            <li>Investimento em energia renovﾃ｡vel</li>
                            <li>Simplificaﾃｧﾃ｣o de processos burocrﾃ｡ticos</li>
                        </ul>
                        
                        <h2>Impacto esperado</h2>
                        <p>Segundo analistas econﾃｳmicos, estas medidas poderﾃ｣o aumentar o PIB nacional em atﾃｩ 2% no prﾃｳximo ano. O ministro da Economia declarou que o objetivo ﾃｩ "criar um ambiente mais favorﾃ｡vel aos negﾃｳcios e atrair investimento estrangeiro".</p>
                        
                        <blockquote>
                            "Esta ﾃｩ uma oportunidade histﾃｳrica para transformarmos a nossa economia e criarmos empregos sustentﾃ｡veis para os moﾃｧambicanos."
                        </blockquote>
                        
                        <p>As medidas entrarﾃ｣o em vigor a partir do prﾃｳximo trimestre, apﾃｳs aprovaﾃｧﾃ｣o final do parlamento.</p>
                    `,
                    source: 'Jornal Notﾃｭcias',
                    date: new Date('2024-01-15T10:30:00'),
                    image: 'https://picsum.photos/800/400?random=1',
                    readTime: '4 min de leitura',
                    author: 'Carlos Mendes',
                    excerpt: 'Novo pacote econﾃｳmico visa impulsionar crescimento e criaﾃｧﾃ｣o de emprego'
                },
                '67890': {
                    id: '67890',
                    title: 'Seleﾃｧﾃ｣o nacional vence amigﾃ｡vel contra a Tanzﾃ｢nia',
                    content: `
                        <p>A seleﾃｧﾃ｣o moﾃｧambicana de futebol venceu hoje a Tanzﾃ｢nia por 2-1 num jogo amigﾃ｡vel preparatﾃｳrio para o prﾃｳximo campeonato africano. Os golos foram marcados pelos avanﾃｧados Mﾃ｡rio e Josﾃｩ nas etapas inicial e final do encontro.</p>
                        
                        <h2>Anﾃ｡lise do jogo</h2>
                        <p>A equipa mostrou uma evoluﾃｧﾃ｣o tﾃ｡tica significativa, com um meio-campo organizado e uma defesa sﾃｳlida. O selecionador nacional destacou o espﾃｭrito de equipa e a determinaﾃｧﾃ｣o dos jogadores.</p>
                        
                        <p>O prﾃｳximo desafio da equipa serﾃ｡ frente ao Senegal, no estﾃ｡dio nacional da Machava, dentro de duas semanas.</p>
                    `,
                    source: 'O Paﾃｭs',
                    date: new Date('2024-01-14T18:45:00'),
                    image: 'https://picsum.photos/800/400?random=2',
                    readTime: '2 min de leitura',
                    author: 'Ana Silva',
                    excerpt: 'Vitﾃｳria importante na preparaﾃｧﾃ｣o para o campeonato africano'
                }
            };
            
            // Simular delay de rede
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // Retornar artigo mock ou gerar um novo
            return mockArticles[articleId] || {
                id: articleId,
                title: decodeURIComponent(slug || 'Artigo Exemplo').replace(/-/g, ' '),
                content: `
                    <p>Este ﾃｩ um artigo de exemplo carregado dinamicamente. Em um sistema real, este conteﾃｺdo viria de uma API ou base de dados.</p>
                    <p>O sistema Notﾃｭcias CLD ﾃｩ capaz de carregar qualquer artigo com base no ID fornecido na URL.</p>
                    <h2>Como funciona:</h2>
                    <p>Quando vocﾃｪ compartilha um link, o sistema passa o ID do artigo como parﾃ｢metro na URL.</p>
                    <p>A pﾃ｡gina article.html lﾃｪ este ID, busca o artigo correspondente e exibe o conteﾃｺdo.</p>
                    <h2>Recursos disponﾃｭveis:</h2>
                    <ul>
                        <li>Compartilhamento em redes sociais</li>
                        <li>Salvar artigos para ler depois</li>
                        <li>Ajustar tamanho da fonte</li>
                        <li>Agregador CLD com notﾃｭcias relacionadas</li>
                        <li>Design responsivo para todos dispositivos</li>
                    </ul>
                `,
                source: 'Notﾃｭcias CLD',
                date: new Date(),
                image: 'https://picsum.photos/800/400?random=' + Date.now(),
                readTime: '3 min de leitura',
                excerpt: 'Artigo demonstrativo do sistema Notﾃｭcias CLD'
            };
        }

        async function generateRelatedArticles() {
      // Gerar artigos relacionados mock
            const sources = [
                'O Paﾃｭs', 'Jornal Notﾃｭcias', 'Canal de Moﾃｧambique', 
                'Carta de Moﾃｧambique', 'Club of Mozambique'
            ];
            
            const related = [];
            
            for (let i = 0; i < CONFIG.RELATED_ARTICLES_COUNT; i++) {
                related.push({
                    id: 'related_' + Date.now() + i,
                    title: `Notﾃｭcia relacionada ${i + 1} - Tema similar`,
                    source: sources[Math.floor(Math.random() * sources.length)],
                    date: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000),
                    excerpt: `Resumo da notﾃｭcia relacionada ${i + 1}...`
                });
            }
            
            // Simular delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            return related;
        }

        // ================= EXPORTAR FUNﾃﾃ髭S =================
        window.openRelatedArticle = openRelatedArticle;
    </script>
</body>
</html>