<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Notícias CLD - Agregador de Notícias de Moçambique</title>
    <meta name="description" content="Agregador de notícias de Moçambique em tempo real">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Notícias CLD - Agregador de Notícias">
    <meta property="og:description" content="Todas as notícias de Moçambique em um só lugar">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://seusite.com/">
    <meta property="og:image" content="https://seusite.com/logo.png">
    
    <!-- Styles -->
    <style>
    :root {
        --primary-color: #1a73e8;
        --primary-dark: #0d62d9;
        --secondary-color: #f8f9fa;
        --text-primary: #202124;
        --text-secondary: #5f6368;
        --border-color: #dadce0;
        --card-shadow: 0 1px 2px 0 rgba(60,64,67,.1), 0 1px 3px 1px rgba(60,64,67,.15);
        --card-hover-shadow: 0 2px 6px 2px rgba(60,64,67,.15);
        --success-color: #34a853;
        --warning-color: #fbbc04;
        --danger-color: #ea4335;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
        background: #f8f9fa;
        color: var(--text-primary);
        line-height: 1.6;
    }
    
    /* Header */
    .main-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: white;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .logo {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .logo-icon {
        font-size: 28px;
    }
    
    .header-actions {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .header-btn {
        background: none;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-secondary);
        transition: all 0.2s;
        position: relative;
    }
    
    .header-btn:hover {
        background: var(--secondary-color);
        color: var(--primary-color);
    }
    
    .save-btn.active {
        color: var(--danger-color);
    }
    
    .badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--danger-color);
        color: white;
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 18px;
        text-align: center;
    }
    
    /* Search */
    .search-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
    }
    
    .search-box {
        position: relative;
    }
    
    .search-input {
        width: 100%;
        padding: 14px 20px 14px 50px;
        border: 1px solid var(--border-color);
        border-radius: 24px;
        font-size: 16px;
        background: white;
        transition: all 0.3s;
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }
    
    .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
    }
    
    /* Categories */
    .categories-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 15px 20px;
        overflow-x: auto;
        white-space: nowrap;
        scrollbar-width: thin;
    }
    
    .categories {
        display: inline-flex;
        gap: 8px;
    }
    
    .category-btn {
        background: white;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
        white-space: nowrap;
    }
    
    .category-btn:hover {
        background: var(--secondary-color);
        border-color: var(--primary-color);
        color: var(--primary-color);
    }
    
    .category-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        font-weight: 500;
    }
    
    /* News Grid */
    .news-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
    }
    
    @media (max-width: 768px) {
        .news-container {
            grid-template-columns: 1fr;
            padding: 15px;
        }
    }
    
    .news-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        transition: all 0.3s;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .news-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--card-hover-shadow);
    }
    
    .news-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: linear-gradient(45deg, #f5f7fa, #c3cfe2);
    }
    
    .news-content {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .news-title {
        font-size: 18px;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 10px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .news-excerpt {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 15px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex-grow: 1;
    }
    
    .news-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: auto;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
    }
    
    .news-source {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .source-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--secondary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
        color: var(--primary-color);
    }
    
    .source-name {
        font-size: 12px;
        color: var(--text-secondary);
        font-weight: 500;
    }
    
    .news-info {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .news-time {
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    .news-category {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 12px;
        font-weight: 500;
    }
    
    .category-sociedade { background: #e8f5e9; color: #2e7d32; }
    .category-politica { background: #ffebee; color: #c62828; }
    .category-economia { background: #fff3e0; color: #ef6c00; }
    .category-esportes { background: #e3f2fd; color: #1565c0; }
    .category-cultura { background: #f3e5f5; color: #7b1fa2; }
    .category-saude { background: #e0f2f1; color: #00796b; }
    .category-tecnologia { background: #eceff1; color: #37474f; }
    
    /* Loading States */
    .loading-skeleton {
        animation: shimmer 1.5s infinite linear;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
    }
    
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    
    .skeleton-card {
        height: 350px;
        border-radius: 12px;
        background: white;
        overflow: hidden;
    }
    
    .skeleton-image {
        height: 200px;
        background: #f0f0f0;
    }
    
    .skeleton-content {
        padding: 20px;
    }
    
    .skeleton-title {
        height: 20px;
        background: #f0f0f0;
        margin-bottom: 10px;
        border-radius: 4px;
    }
    
    .skeleton-excerpt {
        height: 16px;
        background: #f0f0f0;
        margin-bottom: 8px;
        border-radius: 4px;
        width: 80%;
    }
    
    .skeleton-meta {
        height: 14px;
        background: #f0f0f0;
        width: 60%;
        border-radius: 4px;
    }
    
    /* Empty State */
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px 20px;
    }
    
    .empty-icon {
        font-size: 64px;
        color: var(--border-color);
        margin-bottom: 20px;
    }
    
    .empty-title {
        font-size: 20px;
        color: var(--text-secondary);
        margin-bottom: 10px;
    }
    
    .empty-text {
        color: var(--text-secondary);
        max-width: 400px;
        margin: 0 auto;
    }
    
    /* Footer */
    .main-footer {
        background: white;
        border-top: 1px solid var(--border-color);
        padding: 40px 20px;
        margin-top: 40px;
    }
    
    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
    }
    
    .footer-section h3 {
        font-size: 16px;
        margin-bottom: 15px;
        color: var(--text-primary);
    }
    
    .footer-links {
        list-style: none;
    }
    
    .footer-links li {
        margin-bottom: 10px;
    }
    
    .footer-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.2s;
    }
    
    .footer-links a:hover {
        color: var(--primary-color);
    }
    
    .copyright {
        text-align: center;
        padding: 20px;
        color: var(--text-secondary);
        font-size: 14px;
        border-top: 1px solid var(--border-color);
        margin-top: 40px;
    }
    
    /* Save Notification */
    .save-notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--success-color);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s;
        z-index: 1001;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .save-notification.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    /* Responsive */
    @media (max-width: 480px) {
        .main-header {
            padding: 10px 15px;
        }
        
        .logo {
            font-size: 18px;
        }
        
        .search-input {
            padding: 12px 15px 12px 40px;
            font-size: 14px;
        }
        
        .news-container {
            padding: 10px;
            gap: 15px;
        }
    }
    </style>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <a href="/" class="logo">
            <i class="fas fa-newspaper logo-icon"></i>
            <span>Notícias CLD</span>
        </a>
        
        <div class="header-actions">
            <button class="header-btn" onclick="toggleTheme()" title="Alternar tema">
                <i class="fas fa-moon"></i>
            </button>
            
            <button class="header-btn save-btn" onclick="openSaved()" title="Notícias guardadas">
                <i class="fas fa-bookmark"></i>
                <span class="badge" id="saved-count">0</span>
            </button>
            
            <button class="header-btn" onclick="refreshNews()" title="Atualizar notícias">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </header>
    
    <!-- Search -->
    <div class="search-container">
        <div class="search-box">
            <i class="fas fa-search search-icon"></i>
            <input type="text" 
                   class="search-input" 
                   placeholder="Buscar notícias..." 
                   id="search-input"
                   onkeyup="searchNews()">
        </div>
    </div>
    
    <!-- Categories -->
    <div class="categories-container">
        <div class="categories">
            <button class="category-btn active" onclick="filterByCategory('todos')">Todas</button>
            <button class="category-btn" onclick="filterByCategory('sociedade')">Sociedade</button>
            <button class="category-btn" onclick="filterByCategory('politica')">Política</button>
            <button class="category-btn" onclick="filterByCategory('economia')">Economia</button>
            <button class="category-btn" onclick="filterByCategory('esportes')">Esportes</button>
            <button class="category-btn" onclick="filterByCategory('cultura')">Cultura</button>
            <button class="category-btn" onclick="filterByCategory('saude')">Saúde</button>
            <button class="category-btn" onclick="filterByCategory('tecnologia')">Tecnologia</button>
        </div>
    </div>
    
    <!-- News Grid -->
    <div class="news-container" id="news-container">
        <!-- News cards will be inserted here -->
    </div>
    
    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Notícias CLD</h3>
                <p>Agregador independente de notícias de Moçambique, reunindo conteúdos de várias fontes confiáveis em tempo real.</p>
            </div>
            
            <div class="footer-section">
                <h3>Links Rápidos</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="openAbout()">Sobre</a></li>
                    <li><a href="#" onclick="openContact()">Contacto</a></li>
                    <li><a href="#" onclick="openSaved()">Notícias Guardadas</a></li>
                    <li><a href="#" onclick="openWhatsApp()">Canal WhatsApp</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Fontes</h3>
                <ul class="footer-links">
                    <li><a href="https://opais.co.mz" target="_blank">O País</a></li>
                    <li><a href="https://jornalnoticias.co.mz" target="_blank">Jornal Notícias</a></li>
                    <li><a href="https://canal.co.mz" target="_blank">Canal de Moçambique</a></li>
                    <li><a href="https://clubofmozambique.com" target="_blank">Club of Mozambique</a></li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2024 Notícias CLD. Todos os direitos reservados.
        </div>
    </footer>
    
    <!-- Save Notification -->
    <div class="save-notification" id="save-notification">
        <i class="fas fa-check-circle"></i>
        <span id="save-message">Notícia guardada!</span>
    </div>
    
    <!-- Main Script -->
    <script>
    // Configuration
    const CONFIG = {
        sources: [
            {
                name: "O País",
                url: "https://opais.co.mz/wp-json/wp/v2/posts",
                logo: "OP"
            },
            {
                name: "Jornal Notícias",
                url: "https://jornalnoticias.co.mz/wp-json/wp/v2/posts",
                logo: "JN"
            },
            {
                name: "Canal de Moçambique",
                url: "https://canal.co.mz/wp-json/wp/v2/posts",
                logo: "CM"
            },
            {
                name: "Club of Mozambique",
                url: "https://clubofmozambique.com/wp-json/wp/v2/posts",
                logo: "CO"
            },
            {
                name: "Carta de Moçambique",
                url: "https://cartamz.com/wp-json/wp/v2/posts",
                logo: "CD"
            }
        ],
        batchSize: 10,
        cacheDuration: 300000, // 5 minutes
        maxSavedArticles: 100
    };
    
    // State Management
    let state = {
        articles: [],
        filteredArticles: [],
        savedArticles: new Set(),
        currentCategory: 'todos',
        isLoading: false,
        currentPage: 1,
        hasMore: true,
        searchTerm: '',
        theme: localStorage.getItem('theme') || 'light'
    };
    
    // DOM Elements
    const newsContainer = document.getElementById('news-container');
    const searchInput = document.getElementById('search-input');
    const savedCount = document.getElementById('saved-count');
    const saveNotification = document.getElementById('save-notification');
    const saveMessage = document.getElementById('save-message');
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        loadSavedArticles();
        loadArticles();
        setupIntersectionObserver();
        checkUrlParams();
        
        // Add search debounce
        searchInput.addEventListener('input', debounce(searchNews, 300));
    });
    
    // Theme Management
    function initTheme() {
        document.documentElement.setAttribute('data-theme', state.theme);
        if (state.theme === 'dark') {
            document.documentElement.classList.add('dark-theme');
        }
    }
    
    function toggleTheme() {
        state.theme = state.theme === 'light' ? 'dark' : 'light';
        localStorage.setItem('theme', state.theme);
        document.documentElement.setAttribute('data-theme', state.theme);
        document.documentElement.classList.toggle('dark-theme');
    }
    
    // URL Parameter Handling
    function checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category');
        const search = urlParams.get('search');
        
        if (category) {
            filterByCategory(category);
            updateCategoryButtons(category);
        }
        
        if (search) {
            searchInput.value = search;
            state.searchTerm = search;
            filterArticles();
        }
    }
    
    function updateUrlParams() {
        const urlParams = new URLSearchParams();
        
        if (state.currentCategory !== 'todos') {
            urlParams.set('category', state.currentCategory);
        }
        
        if (state.searchTerm) {
            urlParams.set('search', state.searchTerm);
        }
        
        const newUrl = window.location.pathname + 
                      (urlParams.toString() ? '?' + urlParams.toString() : '');
        
        window.history.replaceState({}, '', newUrl);
    }
    
    // Category Filtering
    function filterByCategory(category) {
        state.currentCategory = category;
        updateCategoryButtons(category);
        filterArticles();
        updateUrlParams();
    }
    
      function updateCategoryButtons(activeCategory) {
        document.querySelectorAll('.category-btn').forEach(btn => {
            const category = btn.getAttribute('onclick').match(/'([^']+)'/)[1];
            btn.classList.toggle('active', category === activeCategory);
        });
    }
    
    // Search Functionality
    function searchNews() {
        state.searchTerm = searchInput.value.toLowerCase().trim();
        filterArticles();
        updateUrlParams();
    }
    
    function filterArticles() {
        let filtered = [...state.articles];
        
        // Apply category filter
        if (state.currentCategory !== 'todos') {
            filtered = filtered.filter(article => 
                article.category === state.currentCategory
            );
        }
        
        // Apply search filter
        if (state.searchTerm) {
            filtered = filtered.filter(article =>
                article.title.toLowerCase().includes(state.searchTerm) ||
                article.excerpt.toLowerCase().includes(state.searchTerm) ||
                article.source.toLowerCase().includes(state.searchTerm)
            );
        }
        
        state.filteredArticles = filtered;
        renderArticles();
    }
    
    // Article Loading
    async function loadArticles() {
        if (state.isLoading || !state.hasMore) return;
        
        state.isLoading = true;
        showLoadingSkeleton();
        
        try {
            const newArticles = await fetchArticles();
            
            if (newArticles.length === 0) {
                state.hasMore = false;
            } else {
                state.articles.push(...newArticles);
                state.filteredArticles = [...state.articles];
                filterArticles();
            }
        } catch (error) {
            console.error('Error loading articles:', error);
            showError('Erro ao carregar notícias. Tente novamente.');
        } finally {
            state.isLoading = false;
            hideLoadingSkeleton();
        }
    }
    
    async function fetchArticles() {
        const promises = CONFIG.sources.map(source =>
            fetch(`${source.url}?per_page=${CONFIG.batchSize}&page=${state.currentPage}&_embed`)
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return response.json();
                })
                .then(data => data.map(item => processArticle(item, source)))
                .catch(error => {
                    console.error(`Error fetching from ${source.name}:`, error);
                    return [];
                })
        );
        
        const results = await Promise.all(promises);
        const newArticles = results.flat();
        
        // Remove duplicates and sort by date
        const uniqueArticles = removeDuplicates(newArticles);
        uniqueArticles.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        state.currentPage++;
        
        return uniqueArticles;
    }
    
    function processArticle(item, source) {
        const hash = generateHash(item.title.rendered + item.link);
        const category = determineCategory(item.title.rendered + ' ' + item.content.rendered);
        
        return {
            id: hash,
            title: item.title.rendered,
            excerpt: stripHtml(item.excerpt.rendered || item.content.rendered).substring(0, 200) + '...',
            content: item.content.rendered,
            image: getFeaturedImage(item),
            source: source.name,
            sourceLogo: source.logo,
            date: item.date,
            link: item.link,
            category: category,
            readTime: calculateReadTime(item.content.rendered)
        };
    }
    
    function generateHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return Math.abs(hash).toString(36);
    }
    
    function determineCategory(text) {
        const categories = {
            'sociedade': ['sociedade', 'social', 'comunidade', 'educação', 'família'],
            'politica': ['política', 'governo', 'presidente', 'ministro', 'eleições'],
            'economia': ['economia', 'negócio', 'empresa', 'investimento', 'banco'],
            'esportes': ['esporte', 'futebol', 'atleta', 'campeonato', 'jogo'],
            'cultura': ['cultura', 'arte', 'música', 'teatro', 'cinema'],
            'saude': ['saúde', 'hospital', 'médico', 'doença', 'vacina'],
            'tecnologia': ['tecnologia', 'internet', 'digital', 'aplicativo', 'software']
        };
        
        text = text.toLowerCase();
        let maxScore = 0;
        let selectedCategory = 'sociedade';
        
        for (const [category, keywords] of Object.entries(categories)) {
            let score = 0;
            keywords.forEach(keyword => {
                if (text.includes(keyword)) score++;
            });
            
            if (score > maxScore) {
                maxScore = score;
                selectedCategory = category;
            }
        }
        
        return selectedCategory;
    }
    
    function removeDuplicates(articles) {
        const seen = new Set();
        return articles.filter(article => {
            const duplicate = seen.has(article.id);
            seen.add(article.id);
            return !duplicate;
        });
    }
    
    // Rendering
    function renderArticles() {
        if (state.filteredArticles.length === 0) {
            showEmptyState();
            return;
        }
        
        newsContainer.innerHTML = '';
        
        state.filteredArticles.forEach(article => {
            const card = createArticleCard(article);
            newsContainer.appendChild(card);
        });
    }
    
    function createArticleCard(article) {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.dataset.id = article.id;
        card.dataset.category = article.category;
        
        const isSaved = state.savedArticles.has(article.id);
        const saveIcon = isSaved ? 'fas' : 'far';
        
        card.innerHTML = `
            <img src="${article.image}" 
                 alt="${article.title}" 
                 class="news-image"
                 onerror="this.src='https://via.placeholder.com/400x200/1a73e8/ffffff?text=Notícias+CLD'">
            
            <div class="news-content">
                <h3 class="news-title">${article.title}</h3>
                <p class="news-excerpt">${article.excerpt}</p>
                
                <div class="news-meta">
                    <div class="news-source">
                        <span class="source-icon">${article.sourceLogo}</span>
                        <span class="source-name">${article.source}</span>
                    </div>
                    
                    <div class="news-info">
                        <span class="news-time">${formatTimeAgo(article.date)}</span>
                        <span class="news-category category-${article.category}">
                            ${getCategoryName(article.category)}
                        </span>
                        <button class="header-btn save-article-btn" 
                                onclick="toggleSaveArticle('${article.id}', event)">
                            <i class="${saveIcon} fa-bookmark"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        card.addEventListener('click', (e) => {
            if (!e.target.closest('.save-article-btn')) {
                openArticle(article);
            }
        });
        
        return card;
    }
    // Article Opening
    function openArticle(article) {
        // Generate unique article URL
        const articleUrl = `/article.html?id=${article.id}&title=${encodeURIComponent(article.title)}`;
        
        // Store article data for article.html
        sessionStorage.setItem('currentArticle', JSON.stringify(article));
        
        // Store recent articles for related news
        storeRecentArticle(article);
        
        // Open article
        window.open(articleUrl, '_blank');
    }
    
    // Save Management
    function loadSavedArticles() {
        try {
            const saved = JSON.parse(localStorage.getItem('savedArticles') || '[]');
            state.savedArticles = new Set(saved);
            updateSavedCount();
        } catch (error) {
            console.error('Error loading saved articles:', error);
            state.savedArticles = new Set();
        }
    }
    
    function toggleSaveArticle(articleId, event) {
        if (event) event.stopPropagation();
        
        const article = state.articles.find(a => a.id === articleId);
        if (!article) return;
        
        if (state.savedArticles.has(articleId)) {
            state.savedArticles.delete(articleId);
            showNotification('Notícia removida dos guardados', 'info');
        } else {
            if (state.savedArticles.size >= CONFIG.maxSavedArticles) {
                showNotification('Limite de notícias guardadas atingido', 'warning');
                return;
            }
            state.savedArticles.add(articleId);
            showNotification('Notícia guardada com sucesso!', 'success');
        }
        
        saveArticlesToStorage();
        updateSavedCount();
        updateSaveButton(articleId);
    }
    
    function saveArticlesToStorage() {
        try {
            const savedArray = Array.from(state.savedArticles);
            localStorage.setItem('savedArticles', JSON.stringify(savedArray));
        } catch (error) {
            console.error('Error saving articles:', error);
        }
    }
    
    function updateSavedCount() {
        savedCount.textContent = state.savedArticles.size;
        savedCount.style.display = state.savedArticles.size > 0 ? 'block' : 'none';
    }
    
    function updateSaveButton(articleId) {
        const button = document.querySelector(`[data-id="${articleId}"] .save-article-btn i`);
        if (button) {
            button.className = state.savedArticles.has(articleId) ? 
                'fas fa-bookmark' : 'far fa-bookmark';
        }
    }
    
    function openSaved() {
        const savedArticles = Array.from(state.savedArticles)
            .map(id => state.articles.find(a => a.id === id))
            .filter(Boolean);
        
        if (savedArticles.length === 0) {
            showNotification('Nenhuma notícia guardada', 'info');
            return;
        }
        
        // In a real implementation, you'd show a modal with saved articles
        alert(`${savedArticles.length} notícias guardadas`);
    }
    
    // Recent Articles for Related News
    function storeRecentArticle(article) {
        try {
            const recent = JSON.parse(localStorage.getItem('recentArticles') || '[]');
            
            // Remove if already exists
            const index = recent.findIndex(a => a.id === article.id);
            if (index > -1) {
                recent.splice(index, 1);
            }
            
            // Add to beginning
            recent.unshift({
                id: article.id,
                title: article.title,
                image: article.image,
                source: article.source,
                category: article.category,
                date: article.date
            });
            
            // Keep only last 50
            if (recent.length > 50) {
                recent.pop();
            }
            
            localStorage.setItem('recentArticles', JSON.stringify(recent));
        } catch (error) {
            console.error('Error storing recent article:', error);
        }
    }
    
    // UI Helpers
    function showLoadingSkeleton() {
        const skeletonCount = 6;
        newsContainer.innerHTML = '';
        
        for (let i = 0; i < skeletonCount; i++) {
            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton-card loading-skeleton';
            skeleton.innerHTML = `
                <div class="skeleton-image"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title"></div>
                    <div class="skeleton-excerpt"></div>
                    <div class="skeleton-meta"></div>
                </div>
            `;
            newsContainer.appendChild(skeleton);
        }
    }
    
    function hideLoadingSkeleton() {
        const skeletons = document.querySelectorAll('.skeleton-card');
        skeletons.forEach(skeleton => skeleton.remove());
    }
    
    function showEmptyState() {
        newsContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-newspaper empty-icon"></i>
                <h3 class="empty-title">Nenhuma notícia encontrada</h3>
                <p class="empty-text">
                    ${state.searchTerm ? 
                        `Não encontramos resultados para "${state.searchTerm}".` : 
                        'Tente mudar de categoria ou recarregar a página.'}
                </p>
            </div>
        `;
    }
    
    function showNotification(message, type = 'success') {
        saveMessage.textContent = message;
        saveNotification.style.background = type === 'success' ? 'var(--success-color)' : 
                                          type === 'warning' ? 'var(--warning-color)' : 
                                          'var(--danger-color)';
        
        saveNotification.classList.add('show');
        
        setTimeout(() => {
            saveNotification.classList.remove('show');
        }, 3000);
    }
    
    function showError(message) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'empty-state';
        errorDiv.innerHTML = `
            <i class="fas fa-exclamation-triangle empty-icon"></i>
            <h3 class="empty-title">Oops!</h3>
            <p class="empty-text">${message}</p>
            <button onclick="refreshNews()" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 6px; cursor: pointer;">
                Tentar Novamente
            </button>
        `;
        
        newsContainer.appendChild(errorDiv);
    }
        // Utility Functions
    function stripHtml(html) {
        const div = document.createElement('div');
        div.innerHTML = html;
        return div.textContent || div.innerText || '';
    }
    
    function getFeaturedImage(article) {
        if (article._embedded && article._embedded['wp:featuredmedia']) {
            return article._embedded['wp:featuredmedia'][0].source_url;
        }
        if (article.jetpack_featured_media_url) {
            return article.jetpack_featured_media_url;
        }
        return 'https://via.placeholder.com/400x200/1a73e8/ffffff?text=Notícias+CLD';
    }
    
    function calculateReadTime(content) {
        const wordsPerMinute = 200;
        const text = stripHtml(content);
        const wordCount = text.split(/\s+/).length;
        return Math.ceil(wordCount / wordsPerMinute);
    }
    
    function formatTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 60) return `${diffMins}m`;
        if (diffHours < 24) return `${diffHours}h`;
        if (diffDays < 7) return `${diffDays}d`;
        
        return date.toLocaleDateString('pt-PT', { 
            month: 'short', 
            day: 'numeric' 
        });
    }
    
    function getCategoryName(category) {
        const names = {
            'sociedade': 'Sociedade',
            'politica': 'Política',
            'economia': 'Economia',
            'esportes': 'Esportes',
            'cultura': 'Cultura',
            'saude': 'Saúde',
            'tecnologia': 'Tecnologia'
        };
        return names[category] || 'Geral';
    }
    
    // Intersection Observer for infinite scroll
    function setupIntersectionObserver() {
        const observer = new IntersectionObserver((entries) => {
            if (entries[0].isIntersecting && !state.isLoading && state.hasMore) {
                loadArticles();
            }
        }, { threshold: 0.5 });
        
        // Create sentinel element
        const sentinel = document.createElement('div');
        sentinel.id = 'scroll-sentinel';
        sentinel.style.height = '1px';
        document.body.appendChild(sentinel);
        
        observer.observe(sentinel);
    }
    
    // Debounce function
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // Refresh function
    function refreshNews() {
        state.articles = [];
        state.filteredArticles = [];
        state.currentPage = 1;
        state.hasMore = true;
        state.searchTerm = '';
        searchInput.value = '';
        state.currentCategory = 'todos';
        updateCategoryButtons('todos');
        
        loadArticles();
        showNotification('A atualizar notícias...', 'info');
    }
    
    // Modal functions (to be implemented)
    function openAbout() {
        alert('Notícias CLD - Agregador independente de notícias de Moçambique\n\nVersão 2.0');
    }
    
    function openContact() {
        alert('Contacto: claudioarmando001@gmail.com\nWhatsApp: +258 869 667 677');
    }
    
    function openWhatsApp() {
        window.open('https://whatsapp.com/channel/0029Vb7BeBI7T8bRTbjcsN0t', '_blank');
    }
    </script>
</body>
</html>