<!doctype html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Not√≠cias CLD - Agregador Mo√ßambicano</title>
    <meta name="description" content="Agregador de not√≠cias de Mo√ßambique em tempo real">
    <meta name="robots" content="index, follow">
    
    <!-- Estilos -->
    <style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f3f5;
        margin: 0;
        color: #111;
    }

    header {
        background: #1a73e8;
        color: white;
        padding: 18px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        position: relative;
    }

    .header-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: white;
        color: #1a73e8;
        border: none;
        padding: 7px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        transition: all 0.3s;
    }

    .header-btn:hover {
        opacity: 0.9;
        transform: translateY(-50%) scale(1.05);
    }

    #menu-btn { left: 15px; }
    #admin-btn { right: 15px; }

    /* SIDEBAR */
    #sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,.5);
        display: none;
        z-index: 9998;
    }

    #sidebar {
        position: fixed;
        top: 0;
        left: -280px;
        width: 280px;
        height: 100vh;
        background: #fff;
        box-shadow: 2px 0 6px rgba(0,0,0,.2);
        padding: 20px;
        box-sizing: border-box;
        transition: .3s;
        z-index: 9999;
        overflow-y: auto;
    }

    #sidebar.open { left: 0; }

    #sidebar h2 {
        color: #1a73e8;
        margin-top: 0;
        font-size: 18px;
    }

    #close-sidebar {
        position: absolute;
        top: 15px;
        right: 15px;
        cursor: pointer;
        font-size: 18px;
        color: #333;
    }

    /* CATEGORIAS */
    .categories {
        margin: 15px 0;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }

    .category-btn {
        background: #e8f0fe;
        border: 1px solid #dce6f5;
        color: #1a73e8;
        padding: 6px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s;
        font-weight: 500;
    }

    .category-btn:hover,
    .category-btn.active {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }

    /* BUSCA */
    .search-container {
        max-width: 950px;
        margin: 12px auto;
        padding: 0 12px;
    }

    #search-input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 16px;
        background: #fff;
        color: #111;
        transition: all 0.3s;
    }

    #search-input:focus {
        outline: none;
        border-color: #1a73e8;
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    /* LISTA DE NOT√çCIAS */
    #news-container {
        max-width: 950px;
        margin: auto;
        padding: 12px;
    }

    .card {
        background: white;
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,.08);
        cursor: pointer;
        transition: .2s;
        animation: fadeIn 0.5s ease-out;
        border: 1px solid #e8e8e8;
        text-decoration: none;
        color: inherit;
    }

    .card:hover { 
        transform: scale(1.01); 
        box-shadow: 0 4px 12px rgba(0,0,0,.12);
    }

    @keyframes fadeIn {
        from { 
            opacity: 0; 
            transform: translateY(20px); 
        }
        to { 
            opacity: 1; 
            transform: translateY(0); 
        }
    }

    .card-text { width: 70%; }
    
    .card-title { 
        font-size: 16px;
        font-weight: bold;
        color: #111;
        margin-bottom: 4px;
        line-height: 1.3;
    }
    
    .card-meta {
        font-size: 12px;
        color: #777;
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .source-tag {
        background: #e8f0fe;
        color: #1a73e8;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
    }

    .card img {
        width: 120px;
        height: 85px;
        object-fit: cover;
        border-radius: 10px;
        background: #eee;
    }

    /* CATEGORY TAGS */
    .category-tag {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: bold;
    }

    .sociedade-tag { background: rgba(76, 175, 80, 0.1); color: #2e7d32; }
    .politica-tag { background: rgba(244, 67, 54, 0.1); color: #c62828; }
    .economia-tag { background: rgba(255, 152, 0, 0.1); color: #ef6c00; }
    .esportes-tag { background: rgba(33, 150, 243, 0.1); color: #1565c0; }
    .cultura-tag { background: rgba(156, 39, 176, 0.1); color: #7b1fa2; }
    .saude-tag { background: rgba(0, 150, 136, 0.1); color: #00796b; }
    .tech-tag { background: rgba(96, 125, 139, 0.1); color: #37474f; }

    /* LOADER */
    #infinite-loader {
        text-align: center;
        padding: 20px;
        color: #666;
        font-size: 14px;
        display: none;
    }

    .infinite-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #e8e8e8;
        border-top: 3px solid #1a73e8;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 10px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ADMIN BUTTON */
    .admin-btn {
        background: #d32f2f;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        margin: 10px;
        transition: all 0.3s;
    }

    .admin-btn:hover {
        background: #b71c1c;
        transform: translateY(-2px);
    }

    /* SAVED BADGE */
    .saved-badge {
        background: #4caf50;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 10px;
        margin-left: 5px;
    }
    </style>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <button class="header-btn" id="menu-btn" onclick="openSidebar()">‚ò∞</button>
        Not√≠cias CLD
        <button class="header-btn" id="admin-btn" onclick="window.location.href='adm.html'">‚öôÔ∏è</button>
    </header>

    <!-- SIDEBAR -->
    <div id="sidebar-overlay"></div>
    <div id="sidebar">
        <span id="close-sidebar" onclick="closeSidebar()">‚úñ</span>
        <h2>Categorias</h2>
        <div class="categories">
            <button class="category-btn active" onclick="filterByCategory('todos')">Todos</button>
            <button class="category-btn" onclick="filterByCategory('sociedade')">Sociedade</button>
            <button class="category-btn" onclick="filterByCategory('pol√≠tica')">Pol√≠tica</button>
            <button class="category-btn" onclick="filterByCategory('economia')">Economia</button>
            <button class="category-btn" onclick="filterByCategory('esportes')">Esportes</button>
            <button class="category-btn" onclick="filterByCategory('cultura')">Cultura</button>
            <button class="category-btn" onclick="filterByCategory('sa√∫de')">Sa√∫de</button>
            <button class="category-btn" onclick="filterByCategory('tecnologia')">Tecnologia</button>
        </div>
    </div>

    <!-- BUSCA -->
    <div class="search-container">
        <input id="search-input" placeholder="üîç Buscar not√≠cias..." onkeyup="searchNews()">
    </div>

    <!-- LISTA DE NOT√çCIAS -->
    <div id="news-container">
        <!-- Not√≠cias aparecer√£o aqui -->
    </div>

    <!-- LOADER INFINITO -->
    <div id="infinite-loader">
        <div class="infinite-spinner"></div>
        Carregando mais not√≠cias...
    </div>

    <script>
    // CONFIGURA√á√ÉO
    const SOURCES = JSON.parse(localStorage.getItem('news_sources') || `[
        {"name": "O Pa√≠s", "url": "https://www.opais.co.mz/wp-json/wp/v2/posts", "enabled": true},
        {"name": "Jornal Not√≠cias", "url": "https://www.jornalnoticias.co.mz/wp-json/wp/v2/posts", "enabled": true},
        {"name": "Canal de Mo√ßambique", "url": "https://canal.co.mz/wp-json/wp/v2/posts", "enabled": true}
    ]`);

    // VARI√ÅVEIS
    let allNews = [];
    let filteredNews = [];
    let currentCategory = 'todos';
    let isLoading = false;
    const hashes = new Set();

    // ELEMENTOS DOM
    const container = document.getElementById('news-container');
    const loader = document.getElementById('infinite-loader');

    // CATEGORIAS
    const CATEGORIES = {
        'todos': { name: 'Todos', class: '' },
        'sociedade': { name: 'Sociedade', class: 'sociedade-tag' },
        'pol√≠tica': { name: 'Pol√≠tica', class: 'politica-tag' },
        'economia': { name: 'Economia', class: 'economia-tag' },
        'esportes': { name: 'Esportes', class: 'esportes-tag' },
        'cultura': { name: 'Cultura', class: 'cultura-tag' },
        'sa√∫de': { name: 'Sa√∫de', class: 'saude-tag' },
        'tecnologia': { name: 'Tecnologia', class: 'tech-tag' }
    };

    // FUN√á√ïES SIDEBAR
    function openSidebar() {
        document.getElementById('sidebar').classList.add('open');
        document.getElementById('sidebar-overlay').style.display = 'block';
    }

    function closeSidebar() {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('sidebar-overlay').style.display = 'none';
    }

    document.getElementById('sidebar-overlay').addEventListener('click', closeSidebar);

    // FILTRAR POR CATEGORIA
    function filterByCategory(category) {
        currentCategory = category;
        document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        applyFilters();
        renderNews();
    }

    // BUSCAR NOT√çCIAS
    function searchNews() {
        applyFilters();
        renderNews();
    }

    function applyFilters() {
        const searchText = document.getElementById('search-input').value.toLowerCase();
        
        filteredNews = allNews.filter(news => {
            // Filtro por categoria
            if (currentCategory !== 'todos' && news.category !== currentCategory) {
                return false;
            }
            
            // Filtro por busca
            if (searchText && !news.title.toLowerCase().includes(searchText) && 
                !news.source.toLowerCase().includes(searchText)) {
                return false;
            }
            
            return true;
        });
    }

    // DETERMINAR CATEGORIA
    function determineCategory(title, content) {
        const text = (title + ' ' + content).toLowerCase();
        const keywords = {
            'sociedade': ['sociedade', 'social', 'comunidade', 'educa√ß√£o'],
            'pol√≠tica': ['pol√≠tica', 'governo', 'presidente', 'elei√ß√µes'],
            'economia': ['economia', 'neg√≥cio', 'empresa', 'investimento'],
            'esportes': ['esporte', 'futebol', 'jogo', 'atleta'],
            'cultura': ['cultura', 'arte', 'm√∫sica', 'teatro'],
            'sa√∫de': ['sa√∫de', 'hospital', 'm√©dico', 'doen√ßa'],
            'tecnologia': ['tecnologia', 'internet', 'digital', 'software']
        };
        
        for (const [category, words] of Object.entries(keywords)) {
            if (words.some(word => text.includes(word))) {
                return category;
            }
        }
        
        return 'sociedade';
    }

    // RENDERIZAR NOT√çCIAS
    function renderNews() {
        container.innerHTML = '';
        
        filteredNews.forEach(news => {
            const card = document.createElement('a');
            card.className = 'card';
            card.href = `leitura.html?id=${news.id}`;
            
            const saved = isSaved(news.id);
            const savedBadge = saved ? '<span class="saved-badge">‚≠ê Guardada</span>' : '';
            
            card.innerHTML = `
                <div class="card-text">
                    <div class="card-title">${news.title} ${savedBadge}</div>
                    <div class="card-meta">
                        <span class="source-tag">${news.source}</span>
                        <span class="category-tag ${news.categoryClass}">${news.categoryName}</span>
                        <span>${formatDate(news.date)}</span>
                    </div>
                </div>
                <img src="${news.image}" alt="${news.title}" 
                     onerror="this.src='https://via.placeholder.com/120x85/1a73e8/ffffff?text=NEWS'">
            `;
            
            container.appendChild(card);
        });
    }

    function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('pt-PT');
    }

    // CARREGAR NOT√çCIAS
    async function loadNews() {
        if (isLoading) return;
        isLoading = true;
        loader.style.display = 'block';
        
        try {
            // Carrega not√≠cias salvas localmente primeiro
            const savedNews = JSON.parse(localStorage.getItem('saved_news') || '[]');
            savedNews.forEach(news => {
                if (!hashes.has(news.id)) {
                    allNews.push({
                        ...news,
                        categoryName: CATEGORIES[news.category]?.name || news.category,
                        categoryClass: CATEGORIES[news.category]?.class || ''
                    });
                    hashes.add(news.id);
                }
            });
            
            // Carrega de fontes externas
            for (const source of SOURCES.filter(s => s.enabled)) {
                await fetchSourceNews(source);
            }
            
            // Ordena por data
            allNews.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            applyFilters();
            renderNews();
            
        } catch (error) {
            console.error('Erro ao carregar not√≠cias:', error);
        } finally {
            isLoading = false;
            loader.style.display = 'none';
        }
    }

    async function fetchSourceNews(source) {
        try {
            const response = await fetch(`${source.url}?_embed&per_page=10&page=1&t=${Date.now()}`);
            if (!response.ok) throw new Error(`Erro ${response.status}`);
            
            const articles = await response.json();
            
            articles.forEach(article => {
                const hash = (article.title.rendered + article.link).replace(/\W/g, "");
                if (hashes.has(hash)) return;
                
                hashes.add(hash);
                
                const category = determineCategory(article.title.rendered, article.content.rendered);
                
                allNews.push({
                    id: hash,
                    title: article.title.rendered,
                    content: article.content.rendered,
                    excerpt: article.excerpt?.rendered || article.title.rendered.substring(0, 150) + '...',
                    image: article._embedded?.['wp:featuredmedia']?.[0]?.source_url || 
                           article.jetpack_featured_media_url ||
                           'https://via.placeholder.com/300x200/1a73e8/ffffff?text=' + encodeURIComponent(source.name.substring(0, 2)),
                    source: source.name,
                    date: article.date || article.modified,
                    link: article.link,
                    original: true,
                    category: category,
                    categoryName: CATEGORIES[category]?.name || category,
                    categoryClass: CATEGORIES[category]?.class || ''
                });
            });
        } catch (error) {
            console.error(`Erro ao carregar ${source.name}:`, error);
        }
    }

    // VERIFICAR SE NOT√çCIA EST√Å SALVA
    function isSaved(id) {
        const saved = JSON.parse(localStorage.getItem('saved_news') || '[]');
        return saved.some(news => news.id === id);
    }

    // SCROLL INFINITO
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500 && !isLoading) {
            loadNews();
        }
    });

    // INICIALIZA√á√ÉO
    document.addEventListener('DOMContentLoaded', () => {
        loadNews();
    });
    </script>
</body>
</html>