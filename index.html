<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Not√≠cias CLD - Agregador Inteligente</title>
    <meta name="description" content="Agregador de not√≠cias de Mo√ßambique em tempo real">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Not√≠cias CLD - Agregador Inteligente">
    <meta property="og:description" content="Todas as not√≠cias de Mo√ßambique em um s√≥ lugar">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://seusite.com/">
    <meta property="og:image" content="https://seusite.com/og-image.jpg">
    
    <!-- Progressive Web App -->
    <meta name="theme-color" content="#1a73e8">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Styles -->
    <style>
    :root {
        --primary-color: #1a73e8;
        --primary-dark: #0d62d9;
        --primary-light: #e8f0fe;
        --secondary-color: #f8f9fa;
        --text-primary: #202124;
        --text-secondary: #5f6368;
        --text-tertiary: #9aa0a6;
        --border-color: #dadce0;
        --border-light: #e8eaed;
        --card-shadow: 0 1px 2px 0 rgba(60,64,67,.1), 0 1px 3px 1px rgba(60,64,67,.15);
        --card-hover-shadow: 0 2px 6px 2px rgba(60,64,67,.15);
        --elevation-1: 0 1px 2px rgba(0,0,0,0.08);
        --elevation-2: 0 2px 4px rgba(0,0,0,0.1);
        --elevation-3: 0 4px 8px rgba(0,0,0,0.12);
        --success-color: #34a853;
        --warning-color: #fbbc04;
        --danger-color: #ea4335;
        --info-color: #1a73e8;
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 20px;
        --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    html {
        scroll-behavior: smooth;
    }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #ffffff;
        color: var(--text-primary);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    /* Header */
    .main-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border-light);
        padding: 16px 20px;
    }
    
    .header-container {
        max-width: 1440px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 24px;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: var(--text-primary);
    }
    
    .logo-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #1a73e8, #0d62d9);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
    }
    
    .logo-text {
        font-size: 20px;
        font-weight: 700;
        background: linear-gradient(135deg, #1a73e8, #0d62d9);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .logo-badge {
        font-size: 10px;
        padding: 2px 6px;
        background: var(--primary-light);
        color: var(--primary-color);
        border-radius: 10px;
        font-weight: 600;
        margin-left: 4px;
    }
    
    .header-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .action-btn {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-color);
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--text-secondary);
        transition: var(--transition);
        position: relative;
    }
    
    .action-btn:hover {
        background: var(--secondary-color);
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-1px);
    }
    
    .action-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }
    
    .badge {
        position: absolute;
        top: -4px;
        right: -4px;
        background: var(--danger-color);
        color: white;
        font-size: 10px;
        font-weight: 600;
        padding: 2px 6px;
        border-radius: 10px;
        min-width: 18px;
        text-align: center;
        line-height: 1;
    }
    
    /* Search Section */
    .search-section {
        background: linear-gradient(to right, #f8f9fa, #ffffff);
        padding: 32px 20px;
        border-bottom: 1px solid var(--border-light);
    }
    
    .search-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .search-box {
        position: relative;
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--elevation-2);
        transition: var(--transition);
    }
    
    .search-box:focus-within {
        box-shadow: var(--elevation-3);
        transform: translateY(-1px);
    }
    
    .search-input {
        width: 100%;
        padding: 20px 60px 20px 56px;
        border: 2px solid transparent;
        border-radius: var(--radius-xl);
        font-size: 16px;
        background: white;
        color: var(--text-primary);
        transition: var(--transition);
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
    }
    
    .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-tertiary);
        font-size: 20px;
    }
    
    .search-actions {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .search-clear {
        background: none;
        border: none;
        color: var(--text-tertiary);
        cursor: pointer;
        padding: 4px;
        border-radius: 50%;
        transition: var(--transition);
    }
    
    .search-clear:hover {
        background: var(--secondary-color);
        color: var(--text-secondary);
    }
    
    /* Categories */
    .categories-section {
        padding: 20px;
        border-bottom: 1px solid var(--border-light);
        background: white;
        position: sticky;
        top: 73px;
        z-index: 999;
    }
    
    .categories-container {
        max-width: 1440px;
        margin: 0 auto;
        overflow-x: auto;
        scrollbar-width: thin;
    }
    
    .categories-container::-webkit-scrollbar {
        height: 4px;
    }
    
    .categories-container::-webkit-scrollbar-track {
        background: var(--border-light);
    }
    
    .categories-container::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 2px;
    }
    
    .categories {
        display: inline-flex;
        gap: 8px;
        padding: 4px;
    }
    
    .category-btn {
        background: white;
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 10px 20px;
        border-radius: var(--radius-xl);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    .category-btn:hover {
        background: var(--primary-light);
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-1px);
    }
    
    .category-btn.active {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        font-weight: 600;
        box-shadow: var(--elevation-1);
    }
    
    /* Main Content */
    .main-content {
        max-width: 1440px;
        margin: 0 auto;
        padding: 32px 20px;
        min-height: 60vh;
    }
    
    .content-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 24px;
    }
    
    .section-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-primary);
    }
    
    .section-subtitle {
        font-size: 14px;
        color: var(--text-tertiary);
        margin-top: 4px;
    }
    
    .content-actions {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .sort-select {
        padding: 10px 16px;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-md);
        background: white;
        color: var(--text-primary);
        font-size: 14px;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .sort-select:hover {
        border-color: var(--primary-color);
    }
    
    .sort-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
    }
    
    /* News Grid */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 24px;
        margin-bottom: 48px;
    }
    
    @media (max-width: 768px) {
        .news-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }
    }
    
    .news-card {
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--elevation-1);
        transition: var(--transition);
        cursor: pointer;
        display: flex;
        flex-direction: column;
        height: 100%;
        position: relative;
    }
    
    .news-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--elevation-3);
    }
    
    .news-card.featured {
        grid-column: span 2;
    }
    
    @media (max-width: 768px) {
        .news-card.featured {
            grid-column: span 1;
        }
    }
    
    .news-image-container {
        position: relative;
        width: 100%;
        padding-top: 56.25%; /* 16:9 Aspect Ratio */
        overflow: hidden;
        background: linear-gradient(45deg, #f5f7fa, #c3cfe2);
    }
    
    .news-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .news-card:hover .news-image {
        transform: scale(1.05);
    }
    
    .news-badge {
        position: absolute;
        top: 16px;
        left: 16px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 6px 12px;
        border-radius: var(--radius-md);
        font-size: 12px;
        font-weight: 600;
        backdrop-filter: blur(4px);
    }
    
    .news-content {
        padding: 24px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }
    
    .news-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        transition: color 0.2s;
    }
    
    .news-card:hover .news-title {
        color: var(--primary-color);
    }
    
    .news-excerpt {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 16px;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex-grow: 1;
    }
    
    .news-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: auto;
        padding-top: 16px;
        border-top: 1px solid var(--border-light);
    }
    
    .news-source {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .source-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--primary-light);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .source-info {
        display: flex;
        flex-direction: column;
    }
    
    .source-name {
        font-size: 13px;
        font-weight: 500;
        color: var(--text-primary);
    }
    
    .source-time {
        font-size: 11px;
        color: var(--text-tertiary);
    }
    
    .news-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .news-category {
        padding: 4px 12px;
        border-radius: var(--radius-xl);
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .category-sociedade { background: #e8f5e9; color: #2e7d32; }
    .category-politica { background: #ffebee; color: #c62828; }
    .category-economia { background: #fff3e0; color: #ef6c00; }
    .category-esportes { background: #e3f2fd; color: #1565c0; }
    .category-cultura { background: #f3e5f5; color: #7b1fa2; }
    .category-saude { background: #e0f2f1; color: #00796b; }
    .category-tecnologia { background: #eceff1; color: #37474f; }
    .category-destaque { background: #fff8e1; color: #ff8f00; }
    
    /* Loading States */
    .skeleton {
        animation: shimmer 1.5s infinite linear;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
    }
    
    @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
    }
    
    .skeleton-card {
        height: 380px;
        border-radius: var(--radius-lg);
        overflow: hidden;
        background: white;
        box-shadow: var(--elevation-1);
    }
    
    .skeleton-image {
        height: 200px;
        background: #f0f0f0;
    }
    
    .skeleton-content {
        padding: 24px;
    }
    
    .skeleton-title {
        height: 20px;
        background: #f0f0f0;
        margin-bottom: 12px;
        border-radius: 4px;
    }
    
    .skeleton-excerpt {
        height: 16px;
        background: #f0f0f0;
        margin-bottom: 8px;
        border-radius: 4px;
        width: 80%;
    }
    
    .skeleton-meta {
        height: 14px;
        background: #f0f0f0;
        width: 60%;
        border-radius: 4px;
        margin-top: 16px;
    }
    
    /* Empty State */
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 80px 20px;
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--elevation-1);
    }
    
    .empty-icon {
        font-size: 64px;
        color: var(--border-color);
        margin-bottom: 24px;
        opacity: 0.5;
    }
    
    .empty-title {
        font-size: 24px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
    }
    
    .empty-text {
        color: var(--text-secondary);
        max-width: 400px;
        margin: 0 auto 24px;
        font-size: 16px;
    }
    
    .empty-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
    }
    
    .btn {
        padding: 12px 24px;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-primary {
        background: var(--primary-color);
        color: white;
    }
    
    .btn-primary:hover {
        background: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: var(--elevation-2);
    }
    
    .btn-secondary {
        background: var(--secondary-color);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
        background: white;
        border-color: var(--primary-color);
        color: var(--primary-color);
    }
    
    /* Load More */
    .load-more-section {
        text-align: center;
        padding: 48px 0;
    }
    
    .load-more-btn {
        padding: 14px 32px;
        background: white;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        border-radius: var(--radius-md);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .load-more-btn:hover:not(:disabled) {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--elevation-3);
    }
    
    .load-more-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .load-more-btn.loading {
        position: relative;
        color: transparent;
    }
    
    .load-more-btn.loading::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        top: 50%;
        left: 50%;
        margin: -10px 0 0 -10px;
        border: 2px solid var(--primary-color);
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Footer */
    .main-footer {
        background: linear-gradient(to bottom, #ffffff, #f8f9fa);
        border-top: 1px solid var(--border-light);
        padding: 64px 20px 32px;
    }
    
    .footer-content {
        max-width: 1440px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 48px;
        margin-bottom: 48px;
    }
    
    .footer-section h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
    }
    
    .footer-links {
        list-style: none;
    }
    
    .footer-links li {
        margin-bottom: 12px;
    }
    
    .footer-links a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .footer-links a:hover {
        color: var(--primary-color);
        transform: translateX(4px);
    }
    
    .footer-bottom {
        max-width: 1440px;
        margin: 0 auto;
        padding-top: 32px;
        border-top: 1px solid var(--border-light);
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 24px;
    }
    
    .copyright {
        color: var(--text-tertiary);
        font-size: 14px;
    }
    
    .social-links {
        display: flex;
        gap: 16px;
    }
    
    .social-link {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--secondary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        text-decoration: none;
        transition: var(--transition);
    }
    
    .social-link:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }
    
    /* Notification */
     .notification {
        position: fixed;
        bottom: 24px;
        right: 24px;
        background: white;
        border-radius: var(--radius-lg);
        box-shadow: var(--elevation-3);
        padding: 16px 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        max-width: 400px;
        transform: translateY(100px);
        opacity: 0;
        transition: var(--transition);
        z-index: 1001;
        border-left: 4px solid var(--primary-color);
    }
    
    .notification.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    .notification.success {
        border-left-color: var(--success-color);
    }
    
    .notification.error {
        border-left-color: var(--danger-color);
    }
    
    .notification.warning {
        border-left-color: var(--warning-color);
    }
    
    .notification-icon {
        font-size: 20px;
    }
    
    .notification.success .notification-icon {
        color: var(--success-color);
    }
    
    .notification.error .notification-icon {
        color: var(--danger-color);
    }
    
    .notification.warning .notification-icon {
        color: var(--warning-color);
    }
    
    .notification-content {
        flex: 1;
    }
    
    .notification-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 2px;
    }
    
    .notification-message {
        font-size: 13px;
        color: var(--text-secondary);
    }
    
    .notification-close {
        background: none;
        border: none;
        color: var(--text-tertiary);
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: var(--transition);
    }
    
    .notification-close:hover {
        background: var(--secondary-color);
        color: var(--text-secondary);
    }
    
    /* Offline Indicator */
    .offline-indicator {
        position: fixed;
        top: 16px;
        right: 16px;
        background: var(--warning-color);
        color: white;
        padding: 8px 16px;
        border-radius: var(--radius-md);
        font-size: 13px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        transform: translateY(-100px);
        opacity: 0;
        transition: var(--transition);
        z-index: 1002;
        box-shadow: var(--elevation-2);
    }
    
    .offline-indicator.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
        .news-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
    }
    
    @media (max-width: 640px) {
        .main-header {
            padding: 12px 16px;
        }
        
        .header-container {
            gap: 16px;
        }
        
        .logo-text {
            font-size: 18px;
        }
        
        .search-section {
            padding: 24px 16px;
        }
        
        .search-input {
            padding: 16px 52px 16px 48px;
        }
        
        .categories-section {
            padding: 16px;
            top: 65px;
        }
        
        .main-content {
            padding: 24px 16px;
        }
        
        .content-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }
        
        .footer-content {
            grid-template-columns: 1fr;
            gap: 32px;
        }
        
        .footer-bottom {
            flex-direction: column;
            text-align: center;
            gap: 16px;
        }
    }
    </style>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offline-indicator">
        <i class="fas fa-wifi-slash"></i>
        <span>Voc√™ est√° offline</span>
    </div>
    
    <!-- Header -->
    <header class="main-header">
        <div class="header-container">
            <a href="/" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-newspaper"></i>
                </div>
                <div>
                    <div class="logo-text">Not√≠cias CLD</div>
                    <div class="logo-badge">BETA</div>
                </div>
            </a>
            
            <div class="header-actions">
                <button class="action-btn" onclick="toggleTheme()" title="Alternar tema">
                    <i class="fas fa-moon"></i>
                </button>
                
                <button class="action-btn" onclick="openSaved()" title="Not√≠cias guardadas">
                    <i class="fas fa-bookmark"></i>
                    <span class="badge" id="saved-count">0</span>
                </button>
                
                <button class="action-btn" onclick="refreshNews()" title="Atualizar not√≠cias">
                    <i class="fas fa-sync-alt"></i>
                </button>
                
                <button class="action-btn" onclick="openSettings()" title="Configura√ß√µes">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>
    <!-- Search -->
    <section class="search-section">
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       class="search-input" 
                       placeholder="Buscar not√≠cias por palavra-chave, fonte ou categoria..." 
                       id="search-input"
                       autocomplete="off">
                <div class="search-actions">
                    <button class="search-clear" onclick="clearSearch()" title="Limpar busca">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Categories -->
    <section class="categories-section">
        <div class="categories-container">
            <div class="categories" id="categories">
                <button class="category-btn active" data-category="todos">üì∞ Todas</button>
                <button class="category-btn" data-category="destaque">‚≠ê Destaque</button>
                <button class="category-btn" data-category="politica">üèõÔ∏è Pol√≠tica</button>
                <button class="category-btn" data-category="economia">üìà Economia</button>
                <button class="category-btn" data-category="sociedade">üë• Sociedade</button>
                <button class="category-btn" data-category="esportes">‚öΩ Esportes</button>
                <button class="category-btn" data-category="cultura">üé≠ Cultura</button>
                <button class="category-btn" data-category="saude">üè• Sa√∫de</button>
                <button class="category-btn" data-category="tecnologia">üíª Tecnologia</button>
            </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="content-header">
            <div>
                <h2 class="section-title" id="section-title">√öltimas Not√≠cias</h2>
                <p class="section-subtitle" id="section-subtitle">Atualizado h√° alguns segundos</p>
            </div>
            
            <div class="content-actions">
                <select class="sort-select" id="sort-select" onchange="sortNews()">
                    <option value="newest">Mais recentes</option>
                    <option value="oldest">Mais antigas</option>
                    <option value="popular">Mais populares</option>
                </select>
            </div>
        </div>
        
        <!-- News Grid -->
        <div class="news-grid" id="news-grid">
            <!-- News cards will be inserted here -->
        </div>
        
        <!-- Load More -->
        <div class="load-more-section">
            <button class="load-more-btn" id="load-more-btn" onclick="loadMoreNews()">
                Carregar mais not√≠cias
            </button>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Not√≠cias CLD</h3>
                <p>Agregador inteligente de not√≠cias de Mo√ßambique. Reunindo conte√∫dos das principais fontes em tempo real com tecnologia avan√ßada de processamento.</p>
            </div>
            
            <div class="footer-section">
                <h3>Links R√°pidos</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="openAbout()"><i class="fas fa-info-circle"></i> Sobre</a></li>
                    <li><a href="#" onclick="openContact()"><i class="fas fa-envelope"></i> Contacto</a></li>
                    <li><a href="#" onclick="openSaved()"><i class="fas fa-bookmark"></i> Guardadas</a></li>
                    <li><a href="#" onclick="openHistory()"><i class="fas fa-history"></i> Hist√≥rico</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Fontes</h3>
                <ul class="footer-links" id="source-links">
                    <!-- Source links will be dynamically added -->
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Legal</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="openPrivacy()"><i class="fas fa-shield-alt"></i> Privacidade</a></li>
                    <li><a href="#" onclick="openTerms()"><i class="fas fa-file-contract"></i> Termos</a></li>
                    <li><a href="#" onclick="openDisclaimer()"><i class="fas fa-exclamation-triangle"></i> Aviso Legal</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="copyright">
                &copy; 2024 Not√≠cias CLD. Sistema de Agrega√ß√£o Inteligente v2.0
            </div>
            
            <div class="social-links">
                <a href="#" class="social-link" onclick="openWhatsApp()" title="WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
                <a href="#" class="social-link" onclick="openTelegram()" title="Telegram">
                    <i class="fab fa-telegram"></i>
                </a>
                <a href="#" class="social-link" onclick="openGitHub()" title="GitHub">
                    <i class="fab fa-github"></i>
                </a>
            </div>
        </div>
    </footer>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle notification-icon"></i>
        <div class="notification-content">
            <div class="notification-title" id="notification-title"></div>
            <div class="notification-message" id="notification-message"></div>
        </div>
        <button class="notification-close" onclick="closeNotification()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Main Script -->
    <script>
    // ============================================
    // CONFIGURA√á√ÉO DO SISTEMA
    // ============================================
    const CONFIG = {
        // Fontes de not√≠cias com fallback m√∫ltiplo
        sources: [
            {
                id: 'opais',
                name: 'O Pa√≠s',
                url: 'https://opais.co.mz/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://opais.co.mz/feed/',
                    'https://opais.co.mz/wp-json/wp/v2/posts'
                ],
                logo: 'OP',
                category: 'general',
                priority: 1,
                timeout: 8000
            },
            {
                id: 'jornalnoticias',
                name: 'Jornal Not√≠cias',
                url: 'https://jornalnoticias.co.mz/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://jornalnoticias.co.mz/feed/',
                    'https://api.jornalnoticias.co.mz/news'
                ],
                logo: 'JN',
                category: 'general',
                priority: 1,
                timeout: 8000
            },
            {
                id: 'canal',
                name: 'Canal de Mo√ßambique',
                url: 'https://canal.co.mz/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://canal.co.mz/feed/',
                    'https://api.canal.co.mz/news'
                ],
                logo: 'CM',
                category: 'general',
                priority: 2,
                timeout: 10000
            },
            {
                id: 'clubmoz',
                name: 'Club of Mozambique',
                url: 'https://clubofmozambique.com/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://clubofmozambique.com/feed/',
                    'https://api.clubofmozambique.com/news'
                ],
                logo: 'CO',
                category: 'business',
                priority: 2,
                timeout: 10000
            },
            {
                id: 'carta',
                name: 'Carta de Mo√ßambique',
                url: 'https://cartamz.com/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://cartamz.com/feed/',
                    'https://api.cartamz.com/posts'
                ],
                logo: 'CD',
                category: 'politics',
                priority: 3,
                timeout: 12000
            },
            {
                id: 'savana',
                name: 'Savana',
                url: 'https://savana.co.mz/wp-json/wp/v2/posts',
                fallbackUrls: [
                    'https://savana.co.mz/feed/',
                    'https://api.savana.co.mz/articles'
                ],
                logo: 'SA',
                category: 'general',
                priority: 3,
                timeout: 12000
            }
        ],
           // Configura√ß√µes de performance
        batchSize: 12,
        cacheDuration: 300000, // 5 minutos
        maxRetries: 3,
        retryDelay: 1000,
        debounceTime: 300,
        
        // Limites
        maxArticles: 500,
        maxSaved: 200,
        maxHistory: 100,
        
        // URLs
        baseUrl: window.location.origin,
        apiEndpoint: '/api/news',
        articlePath: '/article.html'
    };
    
    // ============================================
    // SISTEMA DE ESTADO GLOBAL
    // ============================================
    const State = {
        articles: new Map(), // Usando Map para melhor performance
        filteredArticles: [],
        savedArticles: new Set(),
        viewedArticles: new Set(),
        sourcesStatus: new Map(),
        categories: new Map(),
        
        // Estado atual
        currentCategory: 'todos',
        searchQuery: '',
        sortBy: 'newest',
        currentPage: 1,
        isLoading: false,
        hasMore: true,
        isOnline: navigator.onLine,
        
        // Cache
        cache: {
            articles: new Map(),
            sources: new Map(),
            images: new Map()
        },
        
        // Performance tracking
        metrics: {
            loadTime: 0,
            articlesLoaded: 0,
            cacheHits: 0,
            errors: 0
        }
    };
    
    // ============================================
    // SISTEMA DE IDENTIFICA√á√ÉO INFAL√çVEL
    // ============================================
    class ArticleIDSystem {
        constructor() {
            this.seed = Date.now();
        }
        
        // Gera ID √∫nico baseado em m√∫ltiplos fatores
        generateID(articleData) {
            const factors = [
                articleData.title,
                articleData.source,
                articleData.date,
                articleData.url || articleData.link,
                this.seed
            ];
            
            // Usa m√∫ltiplos algoritmos de hash
            const hash1 = this.hashString(factors.join('|'), 'sha1');
            const hash2 = this.hashString(factors.reverse().join('#'), 'md5');
            const hash3 = this.crc32(factors.join(''));
            
            // Combina os hashes para maior unicidade
            const combined = `${hash1}-${hash2.substring(0, 8)}-${hash3}`;
            
            // Adiciona timestamp para evitar colis√µes
            const timestamp = Date.now().toString(36);
            const random = Math.random().toString(36).substring(2, 8);
            
            return `art_${combined}_${timestamp}_${random}`.toLowerCase();
        }
        
        // Hash simples (em produ√ß√£o, usar biblioteca de hash)
        hashString(str, algorithm = 'sha1') {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // Converte para base64 e remove caracteres especiais
            const base64 = btoa(String.fromCharCode.apply(null, 
                new Uint8Array([hash >>> 24, hash >>> 16, hash >>> 8, hash & 0xFF])
            ));
            
            return base64.replace(/[+/=]/g, '').substring(0, 12);
        }
        
        // CRC32 simples
        crc32(str) {
            let crc = 0 ^ (-1);
            for (let i = 0; i < str.length; i++) {
                crc = (crc >>> 8) ^ this.crcTable[(crc ^ str.charCodeAt(i)) & 0xFF];
            }
            return (crc ^ (-1)) >>> 0;
        }
        
        // Tabela CRC32
        crcTable = (() => {
            const table = [];
            for (let i = 0; i < 256; i++) {
                let c = i;
                for (let j = 0; j < 8; j++) {
                    c = (c & 1) ? (0xEDB88320 ^ (c >>> 1)) : (c >>> 1);
                }
                table[i] = c;
            }
            return table;
        })();
        
        // Verifica se ID √© v√°lido
        isValidID(id) {
            return id && 
                   id.startsWith('art_') && 
                   id.length >= 30 && 
                   id.length <= 70 &&
                   /^[a-z0-9_-]+$/.test(id);
        }
        
        // Extrai timestamp do ID
        getTimestampFromID(id) {
            const parts = id.split('_');
            if (parts.length >= 3) {
                const timestamp = parseInt(parts[parts.length - 2], 36);
                return isNaN(timestamp) ? null : timestamp;
            }
            return null;
        }
    }
       // ============================================
    // SISTEMA DE PROCESSAMENTO OTIMIZADO
    // ============================================
    class ArticleProcessor {
        constructor() {
            this.idSystem = new ArticleIDSystem();
            this.workerPool = [];
            this.queue = [];
            this.processing = false;
        }
        
        // Processa artigo com m√∫ltiplas verifica√ß√µes
        async processArticle(rawArticle, source) {
            try {
                // Valida√ß√£o b√°sica
                if (!this.validateArticle(rawArticle, source)) {
                    return null;
                }
                
                // Gera ID √∫nico
                const id = this.idSystem.generateID({
                    title: rawArticle.title?.rendered || rawArticle.title,
                    source: source.name,
                    date: rawArticle.date,
                    url: rawArticle.link || rawArticle.url
                });
                
                // Verifica duplicatas
                if (State.articles.has(id)) {
                    State.metrics.cacheHits++;
                    return null;
                }
                
                // Processa conte√∫do
                const processed = {
                    id: id,
                    title: this.cleanText(rawArticle.title?.rendered || rawArticle.title),
                    excerpt: this.generateExcerpt(rawArticle),
                    content: this.cleanContent(rawArticle.content?.rendered || rawArticle.content),
                    image: this.getBestImage(rawArticle, source),
                    source: source.name,
                    sourceId: source.id,
                    sourceLogo: source.logo,
                    date: new Date(rawArticle.date || rawArticle.pubDate),
                    url: rawArticle.link || rawArticle.url,
                    originalUrl: rawArticle.link,
                    category: this.detectCategory(rawArticle),
                    readTime: this.calculateReadTime(rawArticle),
                    featured: this.isFeatured(rawArticle),
                    verified: true,
                    metadata: {
                        processedAt: Date.now(),
                        sourcePriority: source.priority,
                        wordCount: this.countWords(rawArticle)
                    }
                };
                
                // Valida√ß√£o final
                if (!this.finalValidation(processed)) {
                    return null;
                }
                
                // Cache da imagem
                await this.precacheImage(processed.image);
                
                return processed;
                
            } catch (error) {
                console.error('Erro ao processar artigo:', error);
                State.metrics.errors++;
                return null;
            }
        }
        
        // Valida√ß√£o rigorosa do artigo
        validateArticle(article, source) {
            const requiredFields = ['title', 'date', 'link'];
            const hasRequired = requiredFields.every(field => 
                (article[field] || (article.title && article.title.rendered))
            );
            
            if (!hasRequired) return false;
            
            // Verifica se n√£o √© muito antigo (√∫ltimos 30 dias)
            const articleDate = new Date(article.date || article.pubDate);
            const maxAge = 30 * 24 * 60 * 60 * 1000; // 30 dias
            if (Date.now() - articleDate.getTime() > maxAge) return false;
            
            // Verifica t√≠tulo v√°lido
            const title = article.title?.rendered || article.title || '';
            if (title.length < 10 || title.length > 200) return false;
            
            return true;
        }
        
        // Limpeza de texto
        cleanText(text) {
            if (!text) return '';
            return text
                .replace(/<[^>]*>/g, ' ') // Remove HTML
                .replace(/\s+/g, ' ') // Remove espa√ßos extras
                .trim()
                .substring(0, 200); // Limita tamanho
        }
        
        // Gera excerto inteligente
        generateExcerpt(article) {
            const content = article.content?.rendered || article.content || '';
            const excerpt = article.excerpt?.rendered || article.excerpt || '';
            
            // Tenta extrair as primeiras frases do conte√∫do
            const text = this.cleanText(content || excerpt);
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [text.substring(0, 150)];
            
            return (sentences.slice(0, 2).join(' ') || text.substring(0, 200)).trim() + '...';
        }
        
        // Limpeza de conte√∫do
        cleanContent(html) {
            if (!html) return '';
            
            // Remove scripts, styles, iframes
            const doc = new DOMParser().parseFromString(html, 'text/html');
            
            // Remove elementos indesejados
            const unwanted = ['script', 'style', 'iframe', 'object', 'embed'];
            unwanted.forEach(tag => {
                doc.querySelectorAll(tag).forEach(el => el.remove());
            });
            
            // Mant√©m apenas conte√∫do relevante
            const body = doc.body || doc.documentElement;
            return body.innerHTML;
        }
              // Obt√©m a melhor imagem dispon√≠vel
        getBestImage(article, source) {
            const fallbackImage = `https://via.placeholder.com/800x450/1a73e8/ffffff?text=${encodeURIComponent(source.name.substring(0, 20))}`;
            
            // Tenta m√∫ltiplas fontes de imagem
            const imageSources = [
                article._embedded?.['wp:featuredmedia']?.[0]?.source_url,
                article.jetpack_featured_media_url,
                article.thumbnail,
                article.enclosure?.url,
                article.media?.url
            ];
            
            for (const imgUrl of imageSources) {
                if (imgUrl && this.isValidImageUrl(imgUrl)) {
                    return imgUrl;
                }
            }
            
            // Tenta extrair primeira imagem do conte√∫do
            const content = article.content?.rendered || '';
            const imgMatch = content.match(/<img[^>]+src="([^">]+)"/);
            if (imgMatch && this.isValidImageUrl(imgMatch[1])) {
                return imgMatch[1];
            }
            
            return fallbackImage;
        }
        
        // Verifica URL de imagem v√°lida
        isValidImageUrl(url) {
            if (!url || typeof url !== 'string') return false;
            
            const validExtensions = ['.jpg', '.jpeg', '.png', '.webp', '.gif'];
            const validDomains = [
                'opais.co.mz',
                'jornalnoticias.co.mz',
                'canal.co.mz',
                'clubofmozambique.com',
                'cartamz.com',
                'savana.co.mz'
            ];
            
            const hasExtension = validExtensions.some(ext => 
                url.toLowerCase().includes(ext)
            );
            
            const hasValidDomain = validDomains.some(domain => 
                url.includes(domain)
            ) || url.startsWith('https://via.placeholder.com/');
            
            return hasExtension && hasValidDomain;
        }
        
        // Detecta categoria
        detectCategory(article) {
            const text = (
                (article.title?.rendered || article.title || '') + ' ' +
                (article.content?.rendered || article.content || '')
            ).toLowerCase();
            
            const categories = {
                'destaque': ['exclusivo', 'destaque', 'urgente', 'breaking'],
                'politica': ['pol√≠tica', 'governo', 'presidente', 'ministro', 'elei√ß√£o', 'parlamento'],
                'economia': ['economia', 'neg√≥cio', 'empresa', 'investimento', 'banco', 'mercado'],
                'sociedade': ['sociedade', 'social', 'educa√ß√£o', 'fam√≠lia', 'comunidade'],
                'esportes': ['esporte', 'futebol', 'jogo', 'atleta', 'campeonato'],
                'cultura': ['cultura', 'arte', 'm√∫sica', 'teatro', 'cinema'],
                'saude': ['sa√∫de', 'hospital', 'm√©dico', 'doen√ßa', 'vacina'],
                'tecnologia': ['tecnologia', 'internet', 'digital', 'app', 'software']
            };
            
            let bestMatch = 'sociedade';
            let maxScore = 0;
            
            for (const [category, keywords] of Object.entries(categories)) {
                let score = 0;
                keywords.forEach(keyword => {
                    if (text.includes(keyword)) score += 1;
                });
                
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = category;
                }
            }
            
            return bestMatch;
        }
        
        // Calcula tempo de leitura
        calculateReadTime(article) {
            const content = article.content?.rendered || article.content || '';
            const words = content.split(/\s+/).length;
            const minutes = Math.ceil(words / 200); // 200 palavras por minuto
            return Math.max(1, Math.min(minutes, 30)); // Entre 1 e 30 minutos
        }
        
        // Verifica se √© destaque
        isFeatured(article) {
            const title = (article.title?.rendered || article.title || '').toLowerCase();
            const featuredKeywords = ['exclusivo', 'destaque', 'urgente', 'breaking', 'importante'];
            return featuredKeywords.some(keyword => title.includes(keyword));
        }
        
        // Pr√©-cache de imagem
        async precacheImage(url) {
            if (!url || State.cache.images.has(url)) return;
            
            try {
                const img = new Image();
                img.src = url;
                await new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = reject;
                    setTimeout(resolve, 1000); // Timeout
                });
                State.cache.images.set(url, true);
            } catch (error) {
                console.warn('Falha ao pr√©-cache de imagem:', url);
            }
        }
        
        // Valida√ß√£o final
        finalValidation(article) {
            return article.title &&
                   article.title.length >= 10 &&
                   article.id &&
                   this.idSystem.isValidID(article.id) &&
                   article.date instanceof Date &&
                   !isNaN(article.date.getTime());
        }
        
        // Conta palavras
        countWords(article) {
            const content = article.content?.rendered || article.content || '';
            return content.split(/\s+/).length;
        }
    }
    
    // ============================================
    // SISTEMA DE LINKS FORTIFICADO
    // ============================================
    class LinkSystem {
        constructor() {
            this.linkCache = new Map();
            this.fallbackSystem = new FallbackSystem();
        }
        
        // Gera link pr√≥prio infal√≠vel
        generateArticleLink(article) {
            if (!article || !article.id) {
                return this.generateFallbackLink();
            }
            
            // Verifica cache primeiro
            if (this.linkCache.has(article.id)) {
                return this.linkCache.get(article.id);
            }
            
            // Cria URL com m√∫ltiplas redund√¢ncias
            const baseUrl = CONFIG.baseUrl + CONFIG.articlePath;
            const params = new URLSearchParams();
            
            // ID prim√°rio (infal√≠vel)
            params.set('id', article.id);
            
            // Par√¢metros de redund√¢ncia
            params.set('title', this.slugify(article.title).substring(0, 50));
            params.set('source', article.sourceId || 'unknown');
            params.set('date', article.date.getTime().toString());
            params.set('hash', this.generateContentHash(article));
            
            // Par√¢metros de verifica√ß√£o
            params.set('v', '2'); // Vers√£o do sistema de links
            params.set('ts', Date.now().toString());
            
            const url = `${baseUrl}?${params.toString()}`;
            
            // Armazena em cache
            this.linkCache.set(article.id, url);
            
            // Armazena backup no localStorage
            this.storeLinkBackup(article.id, url, article);
            
            return url;
        }
        
        // Slugify para URL amig√°vel
        slugify(text) {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }
        
        // Gera hash do conte√∫do para verifica√ß√£o
        generateContentHash(article) {
            const content = article.title + article.source + article.date.getTime();
            let hash = 0;
            for (let i = 0; i < content.length; i++) {
                hash = ((hash << 5) - hash) + content.charCodeAt(i);
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36);
        }
        
        // Armazena backup do link
        storeLinkBackup(id, url, article) {
            try {
                const backups = JSON.parse(localStorage.getItem('linkBackups') || '{}');
                backups[id] = {
                    url: url,
                    title: article.title,
                    source: article.source,
                    date: article.date.toISOString(),
                    stored: Date.now()
                };
                
                // Limita tamanho do backup
                const keys = Object.keys(backups);
                if (keys.length > 1000) {
                    const oldest = keys.sort((a, b) => 
                        backups[a].stored - backups[b].stored
                    )[0];
                    delete backups[oldest];
                }
                
                localStorage.setItem('linkBackups', JSON.stringify(backups));
            } catch (error) {
                console.warn('Erro ao armazenar backup de link:', error);
            }
        }
        
        // Recupera link do backup
        getLinkFromBackup(id) {
            try {
                const backups = JSON.parse(localStorage.getItem('linkBackups') || '{}');
                return backups[id]?.url;
            } catch (error) {
                return null;
            }
        }
        
        // Gera link de fallback
        generateFallbackLink() {
            const baseUrl = CONFIG.baseUrl + CONFIG.articlePath;
            const params = new URLSearchParams();
            params.set('fallback', 'true');
            params.set('ts', Date.now().toString());
            params.set('ref', 'link_system');
            return `${baseUrl}?${params.toString()}`;
        }
    // Verifica e repara links
        async verifyAndRepairLink(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) return url;
                
                // Tenta reparar
                return await this.fallbackSystem.getWorkingLink(url);
            } catch (error) {
                return this.fallbackSystem.getWorkingLink(url);
            }
        }
    }
    
    // ============================================
    // SISTEMA DE FALLBACK
    // ============================================
    class FallbackSystem {
        constructor() {
            this.fallbackUrls = new Map();
            this.initFallbackUrls();
        }
        
        initFallbackUrls() {
            // URLs de fallback para cada fonte
            this.fallbackUrls.set('opais', [
                'https://opais.co.mz',
                'https://m.opais.co.mz',
                'https://archive.opais.co.mz'
            ]);
            
            this.fallbackUrls.set('jornalnoticias', [
                'https://jornalnoticias.co.mz',
                'https://m.jornalnoticias.co.mz'
            ]);
            
            // ... outros fallbacks
        }
        
        async getWorkingLink(originalUrl) {
            // Tenta m√∫ltiplas estrat√©gias
            const strategies = [
                () => this.tryCachedVersion(originalUrl),
                () => this.tryArchivedVersion(originalUrl),
                () => this.tryAlternativeDomain(originalUrl),
                () => this.generateInfoPage(originalUrl)
            ];
            
            for (const strategy of strategies) {
                const result = await strategy();
                if (result) return result;
            }
            
            return this.generateErrorPage(originalUrl);
        }
        
        async tryCachedVersion(url) {
            // Verifica Google Cache
            try {
                const cachedUrl = `https://webcache.googleusercontent.com/search?q=cache:${encodeURIComponent(url)}`;
                const response = await fetch(cachedUrl, { method: 'HEAD' });
                if (response.ok) return cachedUrl;
            } catch (error) {
                // Ignora erro
            }
            
            // Verifica Wayback Machine
            try {
                const waybackUrl = `https://archive.org/wayback/available?url=${encodeURIComponent(url)}`;
                const response = await fetch(waybackUrl);
                const data = await response.json();
                if (data.archived_snapshots?.closest?.url) {
                    return data.archived_snapshots.closest.url;
                }
            } catch (error) {
                // Ignora erro
            }
            
            return null;
        }
        
        async tryArchivedVersion(url) {
            // Tenta vers√µes arquivadas
            const archives = [
                `https://archive.is/${new Date().toISOString().split('T')[0]}/${url}`,
                `https://web.archive.org/web/${url}`,
                `https://mementoweb.org/api/json/${url}`
            ];
            
            for (const archiveUrl of archives) {
                try {
                    const response = await fetch(archiveUrl, { method: 'HEAD' });
                    if (response.ok) return archiveUrl;
                } catch (error) {
                    // Continua para pr√≥ximo
                }
            }
            
            return null;
        }
        
        async tryAlternativeDomain(url) {
            // Tenta dom√≠nios alternativos
            const urlObj = new URL(url);
            const domain = urlObj.hostname;
            
            const alternatives = this.fallbackUrls.get(this.getSourceFromDomain(domain)) || [];
            for (const altDomain of alternatives) {
                const altUrl = url.replace(domain, altDomain);
                try {
                    const response = await fetch(altUrl, { method: 'HEAD' });
                    if (response.ok) return altUrl;
                } catch (error) {
                    // Continua
                }
            }
            
            return null;
        }
        
        generateInfoPage(originalUrl) {
            // P√°gina informativa quando o link original n√£o est√° dispon√≠vel
            const params = new URLSearchParams();
            params.set('original_url', originalUrl);
            params.set('type', 'unavailable');
            params.set('ts', Date.now().toString());
            return `${CONFIG.baseUrl}/unavailable.html?${params.toString()}`;
        }
        
        generateErrorPage(url) {
            // P√°gina de erro com informa√ß√µes
            return `${CONFIG.baseUrl}/error.html?url=${encodeURIComponent(url)}`;
        }
        
        getSourceFromDomain(domain) {
            // Mapeia dom√≠nio para fonte
            const domainMap = {
                'opais.co.mz': 'opais',
                'jornalnoticias.co.mz': 'jornalnoticias',
                'canal.co.mz': 'canal',
                'clubofmozambique.com': 'clubmoz',
                'cartamz.com': 'carta',
                'savana.co.mz': 'savana'
            };
            
            return domainMap[domain] || 'unknown';
        }
    }
    
    // ============================================
    // INICIALIZA√á√ÉO DO SISTEMA
    // ============================================
    const Processor = new ArticleProcessor();
    const LinkSystemInstance = new LinkSystem();
    const FallbackSystemInstance = new FallbackSystem();
    
    // Inicializa quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', () => {
        initSystem();
        loadInitialData();
        setupEventListeners();
        updateUI();
        checkOnlineStatus();
    });
    
    // ============================================
    // FUN√á√ïES PRINCIPAIS
    // ============================================
    
    async function initSystem() {
        console.log('üöÄ Inicializando Sistema Not√≠cias CLD v2.0');
        
        // Carrega estado salvo
        loadSavedState();
        
        // Atualiza contadores
        updateCounters();
        
        // Configura Service Worker
        setupServiceWorker();
        
        // Inicia monitoramento
        startMonitoring();
    }
    
    async function loadInitialData() {
        showLoading();
        
        try {
            // Tenta carregar do cache primeiro
            const cached = loadFromCache();
            if (cached && cached.length > 0) {
                await processAndDisplayArticles(cached);
                showNotification('Carregado do cache', 'success');
            }
            
            // Carrega novas not√≠cias
            await fetchAllSources();
            
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            showNotification('Erro ao carregar not√≠cias', 'error');
        } finally {
            hideLoading();
        }
    }
    
    async function fetchAllSources() {
        const promises = CONFIG.sources.map(source => fetchSource(source));
        const results = await Promise.allSettled(promises);
        
        // Processa resultados
        const allArticles = [];
        results.forEach((result, index) => {
            if (result.status === 'fulfilled' && result.value) {
                allArticles.push(...result.value);
            } else {
                console.warn(`Fonte ${CONFIG.sources[index].name} falhou:`, result.reason);
            }
        });
        
        // Processa e exibe artigos
        await processAndDisplayArticles(allArticles);
        
        // Atualiza cache
        updateCache(allArticles);
    }
    
    async function fetchSource(source) {
        State.sourcesStatus.set(source.id, 'loading');
        
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), source.timeout);
            
            // Tenta URLs principais e fallbacks
            const urls = [source.url, ...source.fallbackUrls];
            let response;
            
            for (const url of urls) {
                try {
                    response = await fetch(url, {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json',
                            'User-Agent': 'NoticiasCLD/2.0'
                        }
                    });
                    
                    if (response.ok) break;
                } catch (error) {
                    // Continua para pr√≥ximo URL
                    console.warn(`URL ${url} falhou:`, error);
                }
            }
            
            clearTimeout(timeoutId);
            
            if (!response || !response.ok) {
                throw new Error(`Todas as URLs falharam para ${source.name}`);
            }
            
            const data = await response.json();
            State.sourcesStatus.set(source.id, 'success');
            
            // Processa artigos
            const articles = [];
            for (const item of data.slice(0, CONFIG.batchSize)) {
                const article = await Processor.processArticle(item, source);
                if (article) {
                    articles.push(article);
                }
            }
            
            return articles;
            
        } catch (error) {
            State.sourcesStatus.set(source.id, 'error');
            console.error(`Erro ao buscar ${source.name}:`, error);
            return [];
        }
    }
    
    async function processAndDisplayArticles(rawArticles) {
        // Remove duplicatas
        const uniqueArticles = Array.from(
            new Map(rawArticles.map(article => [article.id, article])).values()
        );
        
        // Ordena por data
        uniqueArticles.sort((a, b) => b.date - a.date);
        
        // Adiciona ao estado
        uniqueArticles.forEach(article => {
            if (!State.articles.has(article.id)) {
                State.articles.set(article.id, article);
                State.filteredArticles.push(article);
            }
        });
        
        // Atualiza UI
        updateArticlesDisplay();
        updateMetrics();
    }
    
    function updateArticlesDisplay() {
        const grid = document.getElementById('news-grid');
        if (!grid) return;
        
        // Filtra artigos
        let articles = [...State.filteredArticles];
        
        // Aplica categoria
        if (State.currentCategory !== 'todos') {
            articles = articles.filter(article => 
                article.category === State.currentCategory ||
                (State.currentCategory === 'destaque' && article.featured)
            );
        }
        
        // Aplica busca
        if (State.searchQuery) {
            const query = State.searchQuery.toLowerCase();
            articles = articles.filter(article =>
                article.title.toLowerCase().includes(query) ||
                article.excerpt.toLowerCase().includes(query) ||
                article.source.toLowerCase().includes(query) ||
                article.category.toLowerCase().includes(query)
            );
        }
               // Aplica ordena√ß√£o
        articles = sortArticles(articles, State.sortBy);
        
        // Limita quantidade
        const displayCount = State.currentPage * CONFIG.batchSize;
        const articlesToShow = articles.slice(0, displayCount);
        
        // Renderiza
        grid.innerHTML = '';
        articlesToShow.forEach(article => {
            grid.appendChild(createArticleCard(article));
        });
        
        // Atualiza bot√£o "Carregar mais"
        const loadMoreBtn = document.getElementById('load-more-btn');
        if (loadMoreBtn) {
            loadMoreBtn.disabled = articlesToShow.length >= articles.length;
            loadMoreBtn.textContent = loadMoreBtn.disabled ? 
                'Todas as not√≠cias carregadas' : 
                'Carregar mais not√≠cias';
        }
        
        // Atualiza contadores
        updateCounters();
    }
    
    function createArticleCard(article) {
        const card = document.createElement('div');
        card.className = `news-card ${article.featured ? 'featured' : ''}`;
        card.dataset.id = article.id;
        card.dataset.category = article.category;
        
        const link = LinkSystemInstance.generateArticleLink(article);
        const isSaved = State.savedArticles.has(article.id);
        const saveIcon = isSaved ? 'fas' : 'far';
        
        card.innerHTML = `
            <div class="news-image-container">
                <img src="${article.image}" 
                     alt="${article.title}" 
                     class="news-image"
                     loading="lazy"
                     onerror="this.src='https://via.placeholder.com/800x450/1a73e8/ffffff?text=${encodeURIComponent(article.source.substring(0, 20))}'">
                ${article.featured ? '<span class="news-badge">‚≠ê Destaque</span>' : ''}
            </div>
            
            <div class="news-content">
                <h3 class="news-title">${article.title}</h3>
                <p class="news-excerpt">${article.excerpt}</p>
                
                <div class="news-meta">
                    <div class="news-source">
                        <div class="source-avatar">${article.sourceLogo}</div>
                        <div class="source-info">
                            <span class="source-name">${article.source}</span>
                            <span class="source-time">${formatTimeAgo(article.date)} ‚Ä¢ ${article.readTime} min</span>
                        </div>
                    </div>
                    
                    <div class="news-actions">
                        <span class="news-category category-${article.category}">
                            ${getCategoryName(article.category)}
                        </span>
                        <button class="action-btn save-btn" 
                                onclick="toggleSaveArticle('${article.id}', event)"
                                title="${isSaved ? 'Remover dos guardados' : 'Guardar not√≠cia'}">
                            <i class="${saveIcon} fa-bookmark"></i>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Evento de clique na card
        card.addEventListener('click', (e) => {
            if (!e.target.closest('.save-btn') && !e.target.closest('.action-btn')) {
                openArticle(article);
            }
        });
        
        return card;
    }
    
    function openArticle(article) {
        // Marca como visualizada
        State.viewedArticles.add(article.id);
        
        // Armazena no hist√≥rico
        addToHistory(article);
        
        // Gera link e abre
        const link = LinkSystemInstance.generateArticleLink(article);
        window.open(link, '_blank', 'noopener,noreferrer');
    }
    
    // ============================================
    // FUN√á√ïES DE INTERFACE
    // ============================================
    
    function setupEventListeners() {
        // Busca
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.addEventListener('input', debounce(() => {
                State.searchQuery = searchInput.value.trim();
                State.currentPage = 1;
                updateArticlesDisplay();
            }, CONFIG.debounceTime));
        }
        
        // Categorias
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const category = btn.dataset.category;
                filterByCategory(category);
            });
        });
        
        // Ordena√ß√£o
        const sortSelect = document.getElementById('sort-select');
        if (sortSelect) {
            sortSelect.addEventListener('change', () => {
                State.sortBy = sortSelect.value;
                updateArticlesDisplay();
            });
        }
        
        // Carregar mais
        const loadMoreBtn = document.getElementById('load-more-btn');
        if (loadMoreBtn) {
            loadMoreBtn.addEventListener('click', loadMoreNews);
        }
        
        // Online/Offline
        window.addEventListener('online', () => {
            State.isOnline = true;
            document.getElementById('offline-indicator').classList.remove('show');
            showNotification('Conex√£o restaurada', 'success');
        });
        
        window.addEventListener('offline', () => {
            State.isOnline = false;
            document.getElementById('offline-indicator').classList.add('show');
            showNotification('Voc√™ est√° offline', 'warning');
        });
        
        // Scroll infinito
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (scrollTimeout) clearTimeout(scrollTimeout);
            
            scrollTimeout = setTimeout(() => {
                const nearBottom = window.innerHeight + window.scrollY >= 
                                 document.body.offsetHeight - 500;
                
                if (nearBottom && !State.isLoading && State.hasMore) {
                    loadMoreNews();
                }
            }, 100);
        });
    }
    
    function filterByCategory(category) {
        State.currentCategory = category;
        State.currentPage = 1;
        
        // Atualiza bot√µes ativos
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.category === category);
        });
        
        // Atualiza t√≠tulo da se√ß√£o
        const titleElement = document.getElementById('section-title');
        const subtitleElement = document.getElementById('section-subtitle');
        
        if (titleElement) {
            titleElement.textContent = category === 'todos' ? 
                '√öltimas Not√≠cias' : 
                `Not√≠cias: ${getCategoryName(category)}`;
        }
        
        if (subtitleElement) {
            subtitleElement.textContent = getCategoryDescription(category);
        }
        
        updateArticlesDisplay();
    }
    
    async function loadMoreNews() {
        if (State.isLoading || !State.hasMore) return;
        
        State.isLoading = true;
        const loadMoreBtn = document.getElementById('load-more-btn');
        
        if (loadMoreBtn) {
            loadMoreBtn.classList.add('loading');
            loadMoreBtn.disabled = true;
        }
        
        try {
            State.currentPage++;
            await fetchAllSources();
        } catch (error) {
            console.error('Erro ao carregar mais not√≠cias:', error);
            showNotification('Erro ao carregar mais not√≠cias', 'error');
        } finally {
            State.isLoading = false;
            
            if (loadMoreBtn) {
                loadMoreBtn.classList.remove('loading');
                loadMoreBtn.disabled = false;
            }
        }
    }
    
    function toggleSaveArticle(articleId, event) {
        if (event) event.stopPropagation();
        
        const article = State.articles.get(articleId);
        if (!article) return;
        
        if (State.savedArticles.has(articleId)) {
            State.savedArticles.delete(articleId);
            showNotification('Removido dos guardados', 'info');
        } else {
            if (State.savedArticles.size >= CONFIG.maxSaved) {
                showNotification('Limite de not√≠cias guardadas atingido', 'warning');
                return;
            }
            State.savedArticles.add(articleId);
            showNotification('Not√≠cia guardada com sucesso', 'success');
        }
        
        updateSaveButton(articleId);
        saveToLocalStorage();
        updateCounters();
    }
    
    function updateSaveButton(articleId) {
        const button = document.querySelector(`[data-id="${articleId}"] .save-btn i`);
        if (button) {
            const isSaved = State.savedArticles.has(articleId);
            button.className = isSaved ? 'fas fa-bookmark' : 'far fa-bookmark';
        }
    }
    
    function refreshNews() {
        State.articles.clear();
        State.filteredArticles = [];
        State.currentPage = 1;
        State.hasMore = true;
        State.searchQuery = '';
        
        const searchInput = document.getElementById('search-input');
        if (searchInput) searchInput.value = '';
        
        showLoading();
        fetchAllSources().finally(hideLoading);
        showNotification('Atualizando not√≠cias...', 'info');
    }
    
    // ============================================
    // FUN√á√ïES UTILIT√ÅRIAS
    // ============================================
    
    function showLoading() {
        const grid = document.getElementById('news-grid');
        if (!grid) return;
        
        grid.innerHTML = '';
        for (let i = 0; i < 6; i++) {
            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton-card skeleton';
            skeleton.innerHTML = `
                <div class="skeleton-image"></div>
                <div class="skeleton-content">
                    <div class="skeleton-title"></div>
                    <div class="skeleton-excerpt"></div>
                    <div class="skeleton-meta"></div>
                </div>
            `;
            grid.appendChild(skeleton);
        }
    }
    
    function hideLoading() {
        // Remove skeletons
        document.querySelectorAll('.skeleton').forEach(el => el.remove());
    }
    
    function showNotification(message, type = 'info') {
        const notification = document.getElementById('notification');
        const title = document.getElementById('notification-title');
        const msg = document.getElementById('notification-message');
        
        if (!notification || !title || !msg) return;
        
        notification.className = `notification ${type}`;
        title.textContent = type.charAt(0).toUpperCase() + type.slice(1);
        msg.textContent = message;
        
        notification.classList.add('show');
        
        // Auto-remove
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }
    
    function closeNotification() {
        document.getElementById('notification').classList.remove('show');
    }
    
    function formatTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);
        
        if (diffMins < 1) return 'Agora mesmo';
        if (diffMins < 60) return `${diffMins}m`;
        if (diffHours < 24) return `${diffHours}h`;
        if (diffDays < 7) return `${diffDays}d`;
        
        return date.toLocaleDateString('pt-PT', { 
            month: 'short', 
            day: 'numeric' 
        });
    }
    
    function getCategoryName(category) {
        const names = {
            'todos': 'Todas',
            'destaque': 'Destaque',
            'politica': 'Pol√≠tica',
            'economia': 'Economia',
            'sociedade': 'Sociedade',
            'esportes': 'Esportes',
            'cultura': 'Cultura',
            'saude': 'Sa√∫de',
            'tecnologia': 'Tecnologia'
        };
        return names[category] || 'Geral';
    }
    
    function getCategoryDescription(category) {
        const descriptions = {
            'todos': 'Todas as not√≠cias das principais fontes',
            'destaque': 'Not√≠cias em destaque e exclusivas',
            'politica': 'Pol√≠tica, governo e elei√ß√µes',
            'economia': 'Economia, neg√≥cios e investimentos',
            'sociedade': 'Sociedade, educa√ß√£o e comunidade',
            'esportes': 'Esportes e competi√ß√µes',
            'cultura': 'Cultura, arte e entretenimento',
            'saude': 'Sa√∫de e bem-estar',
            'tecnologia': 'Tecnologia e inova√ß√£o'
        };
        return descriptions[category] || '√öltimas not√≠cias';
    }
    
    function sortArticles(articles, method) {
        switch (method) {
            case 'newest':
                return [...articles].sort((a, b) => b.date - a.date);
            case 'oldest':
                return [...articles].sort((a, b) => a.date - b.date);
            case 'popular':
                return [...articles].sort((a, b) => {
                    // Simula popularidade baseada em visualiza√ß√µes e data
                    const scoreA = (State.viewedArticles.has(a.id) ? 10 : 0) + 
                                 (a.featured ? 5 : 0) + 
                                 (new Date() - a.date) / 1000000;
                    const scoreB = (State.viewedArticles.has(b.id) ? 10 : 0) + 
                                 (b.featured ? 5 : 0) + 
                                 (new Date() - b.date) / 1000000;
                    return scoreB - scoreA;
                });
            default:
                return articles;
        }
    }
    
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    // ============================================
    // GERENCIAMENTO DE ESTADO LOCAL
    // ============================================
    
    function loadSavedState() {
        try {
            // Artigos guardados
            const saved = JSON.parse(localStorage.getItem('savedArticles') || '[]');
            State.savedArticles = new Set(saved);
            
            // Hist√≥rico de visualiza√ß√£o
            const viewed = JSON.parse(localStorage.getItem('viewedArticles') || '[]');
            State.viewedArticles = new Set(viewed);
            
            // Configura√ß√µes
            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
            if (settings.theme) {
                document.documentElement.setAttribute('data-theme', settings.theme);
            }
            if (settings.sortBy) {
                State.sortBy = settings.sortBy;
                const sortSelect = document.getElementById('sort-select');
                if (sortSelect) sortSelect.value = settings.sortBy;
            }
            
        } catch (error) {
            console.error('Erro ao carregar estado:', error);
        }
    }
    
    function saveToLocalStorage() {
        try {
            localStorage.setItem('savedArticles', JSON.stringify([...State.savedArticles]));
            localStorage.setItem('viewedArticles', JSON.stringify([...State.viewedArticles]));
            
            const settings = {
                theme: document.documentElement.getAttribute('data-theme') || 'light',
                sortBy: State.sortBy
            };
            localStorage.setItem('settings', JSON.stringify(settings));
            
        } catch (error) {
            console.error('Erro ao salvar estado:', error);
        }
    }
    
    function loadFromCache() {
        try {
            const cached = localStorage.getItem('articlesCache');
            if (!cached) return null;
            
            const data = JSON.parse(cached);
            
            // Verifica se o cache √© recente
            if (Date.now() - data.timestamp > CONFIG.cacheDuration) {
                localStorage.removeItem('articlesCache');
                return null;
            }
            
            return data.articles.map(article => ({
                ...article,
                date: new Date(article.date)
            }));
            
        } catch (error) {
            console.error('Erro ao carregar cache:', error);
            return null;
        }
    }
    
    function updateCache(articles) {
        try {
            const cacheData = {
                timestamp: Date.now(),
                articles: articles.map(article => ({
                    ...article,
                    date: article.date.toISOString()
                }))
            };
            
            localStorage.setItem('articlesCache', JSON.stringify(cacheData));
        } catch (error) {
            console.error('Erro ao atualizar cache:', error);
        }
    }
    
    function addToHistory(article) {
        try {
            const history = JSON.parse(localStorage.getItem('readingHistory') || '[]');
            
            // Remove se j√° existir
            const index = history.findIndex(item => item.id === article.id);
            if (index > -1) {
                history.splice(index, 1);
            }
            
            // Adiciona no in√≠cio
            history.unshift({
                id: article.id,
                title: article.title,
                source: article.source,
                date: new Date().toISOString(),
                url: LinkSystemInstance.generateArticleLink(article)
            });
            
            // Limita tamanho
            if (history.length > CONFIG.maxHistory) {
                history.pop();
            }
            
            localStorage.setItem('readingHistory', JSON.stringify(history));
        } catch (error) {
            console.error('Erro ao adicionar ao hist√≥rico:', error);
        }
    }
    
    // ============================================
    // FUN√á√ïES DE INTERFACE ADICIONAIS
    // ============================================
    
    function updateCounters() {
        const savedCount = document.getElementById('saved-count');
        if (savedCount) {
            savedCount.textContent = State.savedArticles.size;
            savedCount.style.display = State.savedArticles.size > 0 ? 'block' : 'none';
        }
        
        // Atualiza contagem de categorias
        updateCategoryCounts();
    }
    
    function updateCategoryCounts() {
        const counts = {
            todos: State.filteredArticles.length,
            destaque: State.filteredArticles.filter(a => a.featured).length,
            politica: State.filteredArticles.filter(a => a.category === 'politica').length,
            economia: State.filteredArticles.filter(a => a.category === 'economia').length,
            sociedade: State.filteredArticles.filter(a => a.category === 'sociedade').length,
            esportes: State.filteredArticles.filter(a => a.category === 'esportes').length,
            cultura: State.filteredArticles.filter(a => a.category === 'cultura').length,
            saude: State.filteredArticles.filter(a => a.category === 'saude').length,
            tecnologia: State.filteredArticles.filter(a => a.category === 'tecnologia').length
        };
        
        document.querySelectorAll('.category-btn').forEach(btn => {
            const category = btn.dataset.category;
            const count = counts[category] || 0;
            
            // Remove contador anterior
            const existingCount = btn.querySelector('.category-count');
            if (existingCount) existingCount.remove();
            
            // Adiciona novo contador se houver itens
            if (count > 0) {
                const countSpan = document.createElement('span');
                countSpan.className = 'category-count';
                countSpan.textContent = count;
                btn.appendChild(countSpan);
            }
        });
    }
    
    function updateMetrics() {
        State.metrics.articlesLoaded = State.articles.size;
        
        // Atualiza subt√≠tulo
        const subtitle = document.getElementById('section-subtitle');
        if (subtitle) {
            subtitle.textContent = 
                `${State.articles.size} not√≠cias ‚Ä¢ ` +
                `${State.metrics.cacheHits} do cache ‚Ä¢ ` +
                `Atualizado agora`;
        }
    }
    
    function updateUI() {
      // Atualiza links de fontes
        const sourceLinks = document.getElementById('source-links');
        if (sourceLinks) {
            sourceLinks.innerHTML = CONFIG.sources.map(source => `
                <li>
                    <a href="${source.url.replace('/wp-json/wp/v2/posts', '')}" 
                       target="_blank" 
                       rel="noopener noreferrer">
                        <i class="fas fa-external-link-alt"></i> ${source.name}
                    </a>
                </li>
            `).join('');
        }
    }
    
    function checkOnlineStatus() {
        State.isOnline = navigator.onLine;
        const indicator = document.getElementById('offline-indicator');
        
        if (!State.isOnline) {
            indicator.classList.add('show');
            showNotification('Modo offline ativado', 'warning');
        }
    }
    
    function setupServiceWorker() {
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(error => {
                    console.log('Service Worker falhou:', error);
                });
            });
        }
    }
    
    function startMonitoring() {
        // Monitora performance
        setInterval(() => {
            if (State.isOnline) {
                // Atualiza subt√≠tulo periodicamente
                const subtitle = document.getElementById('section-subtitle');
                if (subtitle && subtitle.textContent.includes('Atualizado')) {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('pt-PT', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    subtitle.textContent = subtitle.textContent.replace(
                        /Atualizado.*$/,
                        `Atualizado ${timeStr}`
                    );
                }
            }
        }, 60000); // A cada minuto
    }
    
    function clearSearch() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.value = '';
            State.searchQuery = '';
            State.currentPage = 1;
            updateArticlesDisplay();
        }
    }
    
    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        showNotification(`Tema ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado`, 'info');
        saveToLocalStorage();
    }
    
    // ============================================
    // FUN√á√ïES DE MODAL/DI√ÅLOGO
    // ============================================
    
    function openSaved() {
        if (State.savedArticles.size === 0) {
            showNotification('Nenhuma not√≠cia guardada', 'info');
            return;
        }
        
        // Em produ√ß√£o, abriria uma modal
        const savedArticles = Array.from(State.savedArticles)
            .map(id => State.articles.get(id))
            .filter(Boolean);
        
        alert(`${savedArticles.length} not√≠cias guardadas`);
        // Aqui voc√™ implementaria uma modal bonita
    }
    
    function openHistory() {
        try {
            const history = JSON.parse(localStorage.getItem('readingHistory') || '[]');
            if (history.length === 0) {
                showNotification('Nenhum hist√≥rico de leitura', 'info');
                return;
            }
            
            alert(`${history.length} not√≠cias no hist√≥rico`);
            // Implementar modal de hist√≥rico
        } catch (error) {
            showNotification('Erro ao carregar hist√≥rico', 'error');
        }
    }
    
    function openSettings() {
        // Implementar modal de configura√ß√µes
        showNotification('Configura√ß√µes em desenvolvimento', 'info');
    }
    
    function openAbout() {
        alert(`Not√≠cias CLD v2.0\n\nSistema avan√ßado de agrega√ß√£o de not√≠cias\n‚Ä¢ Processamento inteligente\n‚Ä¢ IDs infal√≠veis\n‚Ä¢ Links fortificados\n‚Ä¢ Cache otimizado`);
    }
    
    function openContact() {
        alert('Contacto:\nclaudioarmando001@gmail.com\n+258 869 667 677\n\nSuporte 24/7');
    }
    
    function openWhatsApp() {
        window.open('https://whatsapp.com/channel/0029Vb7BeBI7T8bRTbjcsN0t', '_blank');
    }
    
    function openTelegram() {
        window.open('https://t.me/noticiascld', '_blank');
    }
    
    function openGitHub() {
        window.open('https://github.com/noticiascld', '_blank');
    }
    
    function openPrivacy() {
        showNotification('Pol√≠tica de privacidade em desenvolvimento', 'info');
    }
    
    function openTerms() {
        showNotification('Termos de uso em desenvolvimento', 'info');
    }
    
    function openDisclaimer() {
        showNotification('Aviso legal em desenvolvimento', 'info');
    }
    
    // ============================================
    // EXPORTA FUN√á√ïES PARA USO GLOBAL
    // ============================================
    window.filterByCategory = filterByCategory;
    window.loadMoreNews = loadMoreNews;
    window.toggleSaveArticle = toggleSaveArticle;
    window.refreshNews = refreshNews;
    window.toggleTheme = toggleTheme;
    window.openSaved = openSaved;
    window.openAbout = openAbout;
    window.openContact = openContact;
    window.openWhatsApp = openWhatsApp;
    window.openTelegram = openTelegram;
    window.openGitHub = openGitHub;
    window.openHistory = openHistory;
    window.openSettings = openSettings;
    window.openPrivacy = openPrivacy;
    window.openTerms = openTerms;
    window.openDisclaimer = openDisclaimer;
    window.clearSearch = clearSearch;
    window.closeNotification = closeNotification;
    window.sortNews = () => {
        const sortSelect = document.getElementById('sort-select');
        if (sortSelect) {
            State.sortBy = sortSelect.value;
            updateArticlesDisplay();
        }
    };
    
    console.log('‚úÖ Sistema Not√≠cias CLD inicializado com sucesso!');
    </script>
</body>
</html>