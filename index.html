<!doctype html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notícias CLD - Agregador Moçambicano</title>
    <meta name="description" content="Todas as notícias de Moçambique em tempo real">
    <meta name="theme-color" content="#1a73e8">
    
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
    :root {
        --primary: #1a73e8;
        --primary-dark: #0d47a1;
        --secondary: #4CAF50;
        --accent: #FF9800;
        --danger: #f44336;
        --dark: #202124;
        --gray: #5f6368;
        --light-gray: #dadce0;
        --bg: #f8f9fa;
        --white: #ffffff;
        --card-shadow: 0 2px 8px rgba(32, 33, 36, 0.1);
        --card-shadow-hover: 0 6px 20px rgba(32, 33, 36, 0.15);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Roboto', 'Segoe UI', sans-serif;
        background: var(--bg);
        color: var(--dark);
        line-height: 1.6;
        overflow-x: hidden;
    }

    /* HEADER */
    .main-header {
        background: var(--white);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
        padding: 15px 0;
    }

    .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 15px;
        text-decoration: none;
    }

    .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 20px;
        font-weight: 700;
    }

    .logo-text {
        font-family: 'Inter', sans-serif;
        font-size: 24px;
        font-weight: 800;
        color: var(--dark);
    }

    .logo-text span {
        color: var(--primary);
    }

    .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .header-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        background: var(--primary);
        color: var(--white);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }

    .header-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
    }

    .header-btn.secondary {
        background: var(--secondary);
    }

    /* NAV */
    .main-nav {
        background: var(--white);
        border-bottom: 1px solid var(--light-gray);
        position: sticky;
        top: 70px;
        z-index: 999;
    }

    .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        overflow-x: auto;
        display: flex;
        gap: 5px;
        padding-bottom: 10px;
    }

    .nav-item {
        padding: 12px 20px;
        white-space: nowrap;
        color: var(--gray);
        text-decoration: none;
        font-weight: 500;
        border-radius: 20px;
        transition: all 0.3s;
        border: 2px solid transparent;
    }

    .nav-item:hover {
        background: var(--bg);
        color: var(--primary);
    }

    .nav-item.active {
        background: var(--primary);
        color: var(--white);
        border-color: var(--primary);
    }

    /* BUSCA */
    .search-container {
        max-width: 800px;
        margin: 30px auto;
        padding: 0 20px;
    }

    .search-box {
        position: relative;
        background: var(--white);
        border-radius: 25px;
        box-shadow: var(--card-shadow);
        border: 2px solid transparent;
        transition: all 0.3s;
    }

    .search-box:focus-within {
        border-color: var(--primary);
        box-shadow: 0 4px 20px rgba(26, 115, 232, 0.15);
    }

    .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
    }

    .search-input {
        width: 100%;
        padding: 18px 20px 18px 50px;
        border: none;
        background: transparent;
        font-size: 16px;
        color: var(--dark);
        outline: none;
    }

    /* CONTEÚDO */
    .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    /* NOTÍCIAS */
    .news-section {
        margin-bottom: 40px;
    }

    .section-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 20px;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-title i {
        color: var(--primary);
    }

    /* CARDS */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 30px;
    }

    .news-card {
        background: var(--white);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        transition: all 0.3s;
        border: 2px solid transparent;
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.5s forwards;
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .news-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--card-shadow-hover);
        border-color: var(--primary);
    }

    .card-image {
        position: relative;
        height: 200px;
        overflow: hidden;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }

    .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s;
    }

    .news-card:hover .card-image img {
        transform: scale(1.05);
    }

    .category-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: rgba(255, 255, 255, 0.95);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--dark);
    }

    .save-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 36px;
        height: 36px;
        background: rgba(255, 255, 255, 0.95);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        color: var(--gray);
        transition: all 0.3s;
    }

    .save-btn:hover {
        background: var(--white);
        color: var(--primary);
        transform: scale(1.1);
    }

    .save-btn.saved {
        background: var(--secondary);
        color: var(--white);
    }

    .card-content {
        padding: 20px;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        line-height: 1.4;
        margin-bottom: 10px;
        color: var(--dark);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-excerpt {
        color: var(--gray);
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 15px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 15px;
        border-top: 1px solid var(--light-gray);
    }

    .source-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .source-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--primary);
        color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
    }

    .source-name {
        font-size: 13px;
        color: var(--gray);
        font-weight: 500;
    }

    .card-time {
        font-size: 12px;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 5px;
    }

    /* LOADER */
    .loader-container {
        text-align: center;
        padding: 40px;
    }

    .loader {
        display: inline-block;
        width: 50px;
        height: 50px;
        border: 3px solid var(--light-gray);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* EMPTY STATE */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--white);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
    }

    .empty-icon {
        font-size: 60px;
        color: var(--light-gray);
        margin-bottom: 20px;
    }

    .empty-title {
        color: var(--dark);
        margin-bottom: 10px;
    }

    /* REAL-TIME INDICATOR */
    .realtime-indicator {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--white);
        padding: 10px 15px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: var(--gray);
        z-index: 100;
        display: none;
    }

    .pulse {
        width: 8px;
        height: 8px;
        background: var(--secondary);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* FOOTER */
    .main-footer {
        background: var(--dark);
        color: var(--white);
        padding: 40px 20px 20px;
        margin-top: 60px;
    }

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
    }

    .footer-section h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--light-gray);
    }

    .footer-links {
        list-style: none;
    }

    .footer-links li {
        margin-bottom: 8px;
    }

    .footer-links a {
        color: #9aa0a6;
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s;
    }

    .footer-links a:hover {
        color: var(--white);
    }

    .copyright {
        text-align: center;
        padding-top: 20px;
        margin-top: 30px;
        border-top: 1px solid rgba(255,255,255,0.1);
        color: #9aa0a6;
        font-size: 13px;
    }

    /* RESPONSIVIDADE */
    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            gap: 15px;
        }
        
        .news-grid {
            grid-template-columns: 1fr;
        }
        
        .nav-container {
            padding-bottom: 15px;
        }
        
        .nav-item {
            padding: 10px 15px;
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        .logo-text {
            font-size: 20px;
        }
        
        .header-btn span {
            display: none;
        }
        
        .header-btn {
            padding: 10px;
        }
    }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="main-header">
        <div class="header-content">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-newspaper"></i>
                </div>
                <div class="logo-text">Notícias <span>CLD</span></div>
            </a>
            
            <div class="header-actions">
                <button class="header-btn" onclick="refreshNews()">
                    <i class="fas fa-sync-alt"></i>
                    <span>Atualizar</span>
                </button>
                <button class="header-btn secondary" onclick="openAdminPanel()">
                    <i class="fas fa-cog"></i>
                    <span>Admin</span>
                </button>
            </div>
        </div>
    </header>

    <!-- NAV -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="#" class="nav-item active" onclick="filterNews('all')">
                <i class="fas fa-globe"></i> Todas
            </a>
            <a href="#" class="nav-item" onclick="filterNews('politics')">
                <i class="fas fa-landmark"></i> Política
            </a>
            <a href="#" class="nav-item" onclick="filterNews('economy')">
                <i class="fas fa-chart-line"></i> Economia
            </a>
            <a href="#" class="nav-item" onclick="filterNews('sports')">
                <i class="fas fa-futbol"></i> Esportes
            </a>
            <a href="#" class="nav-item" onclick="filterNews('society')">
                <i class="fas fa-users"></i> Sociedade
            </a>
            <a href="#" class="nav-item" onclick="filterNews('health')">
                <i class="fas fa-heartbeat"></i> Saúde
            </a>
            <a href="#" class="nav-item" onclick="filterNews('tech')">
                <i class="fas fa-microchip"></i> Tecnologia
            </a>
            <a href="#" class="nav-item" onclick="showSaved()">
                <i class="fas fa-star"></i> Guardadas
            </a>
        </div>
    </nav>

    <!-- BUSCA -->
    <div class="search-container">
        <div class="search-box">
            <div class="search-icon">
                <i class="fas fa-search"></i>
            </div>
            <input type="text" 
                   class="search-input" 
                   placeholder="Buscar notícias..."
                   oninput="searchNews(this.value)">
        </div>
    </div>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
        <!-- DESTAQUES -->
        <section class="news-section">
            <h2 class="section-title">
                <i class="fas fa-fire"></i> Destaques
            </h2>
            <div class="news-grid" id="featured-news">
                <!-- Notícias em destaque serão carregadas aqui -->
            </div>
        </section>

        <!-- TODAS NOTÍCIAS -->
        <section class="news-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="section-title">
                    <i class="fas fa-newspaper"></i> Últimas Notícias
                </h2>
                <div style="display: flex; gap: 10px;">
                    <select onchange="sortNews(this.value)" style="padding: 8px 15px; border-radius: 20px; border: 1px solid var(--light-gray); background: var(--white);">
                        <option value="newest">Mais Recentes</option>
                        <option value="oldest">Mais Antigas</option>
                    </select>
                </div>
            </div>
            <div class="news-grid" id="all-news">
                <!-- Todas as notícias serão carregadas aqui -->
            </div>
        </section>

        <!-- LOADER -->
        <div class="loader-container" id="loader">
            <div class="loader"></div>
            <p style="margin-top: 15px; color: var(--gray);">Carregando notícias...</p>
        </div>

        <!-- SEM NOTÍCIAS -->
        <div class="empty-state" id="empty-state" style="display: none;">
            <div class="empty-icon">
                <i class="fas fa-newspaper"></i>
            </div>
            <h3 class="empty-title">Nenhuma notícia encontrada</h3>
            <p>Tente alterar os filtros ou atualizar a página</p>
            <button class="header-btn" onclick="refreshNews()" style="margin-top: 20px;">
                <i class="fas fa-sync-alt"></i> Atualizar
            </button>
        </div>
    </main>

    <!-- INDICADOR EM TEMPO REAL -->
    <div class="realtime-indicator" id="realtime-indicator">
        <div class="pulse"></div>
        <span>Atualizando notícias...</span>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Notícias CLD</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="showAbout()">Sobre</a></li>
                    <li><a href="#" onclick="showContact()">Contato</a></li>
                    <li><a href="#" onclick="showPrivacy()">Privacidade</a></li>
                    <li><a href="#" onclick="showTerms()">Termos</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Categorias</h3>
                <ul class="footer-links">
                    <li><a href="#" onclick="filterNews('politics')">Política</a></li>
                    <li><a href="#" onclick="filterNews('economy')">Economia</a></li>
                    <li><a href="#" onclick="filterNews('sports')">Esportes</a></li>
                    <li><a href="#" onclick="filterNews('society')">Sociedade</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Fontes</h3>
                <ul class="footer-links">
                    <li><a href="https://opais.co.mz" target="_blank">O País</a></li>
                    <li><a href="https://jornalnoticias.co.mz" target="_blank">Notícias</a></li>
                    <li><a href="https://canal.co.mz" target="_blank">Canal Moz</a></li>
                    <li><a href="https://savana.co.mz" target="_blank">Savana</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Contato</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-envelope"></i> claudioarmando001@gmail.com</li>
                    <li><i class="fas fa-phone"></i> +258 869 667 677</li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            <p>&copy; 2024 Notícias CLD - Agregador de Notícias Moçambicanas</p>
            <p>Todos os direitos reservados</p>
        </div>
    </footer>

    <script>
    // CONFIGURAÇÃO
    const CONFIG = {
        appName: 'Notícias CLD',
        adminPassword: '0800',
        newsLifetime: 60 * 24 * 60 * 60 * 1000, // 60 dias em milissegundos
        updateInterval: 30000, // 30 segundos
        sources: [
            {
                id: 'opais',
                name: 'O País Moçambique',
                api: 'https://www.opais.co.mz/wp-json/wp/v2/posts',
                color: '#1a73e8',
                enabled: true
            },
            {
                id: 'noticias',
                name: 'Jornal Notícias',
                api: 'https://www.jornalnoticias.co.mz/wp-json/wp/v2/posts',
                color: '#4CAF50',
                enabled: true
            },
            {
                id: 'canal',
                name: 'Canal de Moçambique',
                api: 'https://canal.co.mz/wp-json/wp/v2/posts',
                color: '#FF9800',
                enabled: true
            },
               {
                id: 'savana',
                name: 'Savana Digital',
                api: 'https://savana.co.mz/wp-json/wp/v2/posts',
                color: '#9C27B0',
                enabled: true
            },
            {
                id: 'miramar',
                name: 'Miramar',
                api: 'https://miramar.co.mz/wp-json/wp/v2/posts',
                color: '#f44336',
                enabled: true
            }
        ]
    };

    // VARIÁVEIS GLOBAIS
    let allNews = [];
    let displayedNews = [];
    let currentFilter = 'all';
    let currentSearch = '';
    let isProcessing = false;
    let processedCount = 0;

    // ELEMENTOS DOM
    const featuredContainer = document.getElementById('featured-news');
    const allNewsContainer = document.getElementById('all-news');
    const loader = document.getElementById('loader');
    const emptyState = document.getElementById('empty-state');
    const realtimeIndicator = document.getElementById('realtime-indicator');

    // INICIALIZAÇÃO
    document.addEventListener('DOMContentLoaded', async () => {
        // Limpa notícias antigas (mais de 60 dias)
        cleanupOldNews();
        
        // Carrega notícias salvas
        await loadSavedNews();
        
        // Carrega notícias em tempo real
        await loadRealTimeNews();
        
        // Configura atualização automática
        setupAutoRefresh();
        
        // Inicializa processamento sequencial
        startSequentialProcessing();
    });

    // FUNÇÕES DE ARMAZENAMENTO
    function saveToStorage(key, data) {
        try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (e) {
            console.error('Erro ao salvar:', e);
            return false;
        }
    }

    function loadFromStorage(key) {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        } catch (e) {
            console.error('Erro ao carregar:', e);
            return null;
        }
    }

    function cleanupOldNews() {
        const now = Date.now();
        const news = loadFromStorage('cld_news') || [];
        const freshNews = news.filter(item => {
            const age = now - new Date(item.addedAt).getTime();
            return age < CONFIG.newsLifetime;
        });
        
        if (freshNews.length < news.length) {
            saveToStorage('cld_news', freshNews);
        }
    }

    // PROCESSAMENTO SEQUENCIAL
    async function startSequentialProcessing() {
        if (isProcessing) return;
        
        isProcessing = true;
        processedCount = 0;
        
        // Processa uma fonte por vez
        for (const source of CONFIG.sources.filter(s => s.enabled)) {
            if (processedCount >= 50) break; // Limite de notícias
            
            try {
                await processSource(source);
            } catch (error) {
                console.error(`Erro processando ${source.name}:`, error);
            }
            
            // Pequena pausa entre fontes
            await new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        isProcessing = false;
        updateDisplay();
    }

    async function processSource(source) {
        try {
            const cacheKey = `cache_${source.id}_${new Date().toISOString().split('T')[0]}`;
            const cached = loadFromStorage(cacheKey);
            
            if (cached) {
                displayNewsBatch(cached, source);
                return;
            }
            
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), 10000);
            
            const response = await fetch(`${source.api}?per_page=10&_embed`, {
                signal: controller.signal
            });
            
            clearTimeout(timeout);
            
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            
            const data = await response.json();
            const processed = processNewsData(data, source);
            
            // Salva no cache
            saveToStorage(cacheKey, processed);
            
            // Mostra imediatamente
            displayNewsBatch(processed, source);
            
        } catch (error) {
            console.error(`Erro na fonte ${source.name}:`, error);
        }
    }

    function displayNewsBatch(newsBatch, source) {
        newsBatch.forEach((news, index) => {
            setTimeout(() => {
                createNewsCard(news);
                processedCount++;
            }, index * 100); // Intervalo de 100ms entre cards
        });
    }

    function processNewsData(data, source) {
        return data.map(item => {
            const content = item.content?.rendered || '';
            const category = detectCategory(item.title?.rendered, content);
            
            return {
                id: `${source.id}_${item.id}`,
                title: cleanText(item.title?.rendered || 'Sem título'),
                excerpt: cleanText(item.excerpt?.rendered || content).substring(0, 150) + '...',
                content: content,
                image: getFeaturedImage(item),
                source: source.name,
                sourceId: source.id,
                date: item.date || new Date().toISOString(),
                link: item.link || '#',
                category: category,
                addedAt: new Date().toISOString(),
                isSaved: false,
                views: 0
            };
        });
    }

    function getFeaturedImage(article) {
        if (article._embedded?.['wp:featuredmedia']?.[0]?.source_url) {
            return article._embedded['wp:featuredmedia'][0].source_url;
        }
        if (article.jetpack_featured_media_url) {
            return article.jetpack_featured_media_url;
        }
        
        const colors = {
            politics: '3f51b5',
            economy: '4caf50',
            sports: 'ff9800',
            society: '2196f3',
            health: 'e91e63',
            tech: '607d8b',
            default: '1a73e8'
        };
        
        const category = detectCategory(article.title?.rendered, article.content?.rendered);
        const color = colors[category] || colors.default;
        
        return `https://via.placeholder.com/600x400/${color}/ffffff?text=${category.substring(0,2).toUpperCase()}`;
    }

    function detectCategory(title, content) {
        const text = (title + ' ' + content).toLowerCase();
        
        const categories = {
            politics: ['política', 'governo', 'presidente', 'ministro', 'eleições'],
            economy: ['economia', 'negócios', 'empresa', 'investimento', 'mercado'],
            sports: ['esporte', 'futebol', 'jogo', 'atleta', 'competição'],
            society: ['sociedade', 'social', 'comunidade', 'educação', 'família'],
            health: ['saúde', 'médico', 'hospital', 'doença', 'vacina'],
            tech: ['tecnologia', 'digital', 'internet', 'aplicativo', 'software']
        };
           for (const [category, keywords] of Object.entries(categories)) {
            if (keywords.some(keyword => text.includes(keyword))) {
                return category;
            }
        }
        
        return 'society';
    }

    function cleanText(html) {
        return html
            .replace(/<[^>]*>/g, '')
            .replace(/&nbsp;/g, ' ')
            .replace(/&#[0-9]+;/g, '')
            .trim();
    }

    // CRIA CARD DE NOTÍCIA
    function createNewsCard(news) {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.style.animationDelay = `${processedCount * 0.1}s`;
        
        const timeAgo = getTimeAgo(news.date);
        const isSaved = checkIfSaved(news.id);
        
        card.innerHTML = `
            <div class="card-image">
                <img src="${news.image}" alt="${news.title}" 
                     onerror="this.src='https://via.placeholder.com/600x400/1a73e8/ffffff?text=${news.source.substring(0,2)}'">
                <span class="category-badge">${getCategoryName(news.category)}</span>
                <button class="save-btn ${isSaved ? 'saved' : ''}" 
                        onclick="toggleSave('${news.id}', this)">
                    <i class="fas fa-${isSaved ? 'bookmark' : 'bookmark'}"></i>
                </button>
            </div>
            <div class="card-content">
                <h3 class="card-title">
                    <a href="article.html?id=${news.id}" 
                       style="color: inherit; text-decoration: none;" 
                       onclick="openArticle('${news.id}')">
                        ${news.title}
                    </a>
                </h3>
                <p class="card-excerpt">${news.excerpt}</p>
                <div class="card-meta">
                    <div class="source-info">
                        <div class="source-icon" style="background: ${getSourceColor(news.sourceId)}">
                            ${news.source.substring(0,2)}
                        </div>
                        <span class="source-name">${news.source}</span>
                    </div>
                    <div class="card-time">
                        <i class="far fa-clock"></i>
                        <span>${timeAgo}</span>
                    </div>
                </div>
            </div>
        `;
        
        // Adiciona ao container apropriado
        if (processedCount < 3) {
            featuredContainer.appendChild(card);
        } else {
            allNewsContainer.appendChild(card);
        }
        
        // Adiciona à lista global
        allNews.push(news);
        displayedNews.push(news);
        
        // Esconde loader se tiver notícias
        if (displayedNews.length > 0) {
            loader.style.display = 'none';
            emptyState.style.display = 'none';
        }
    }

    function getTimeAgo(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 1) return 'Agora mesmo';
        if (minutes < 60) return `${minutes} min atrás`;
        if (hours < 24) return `${hours} h atrás`;
        if (days < 7) return `${days} dias atrás`;
        
        return date.toLocaleDateString('pt-PT');
    }

    function getCategoryName(category) {
        const names = {
            politics: 'Política',
            economy: 'Economia',
            sports: 'Esportes',
            society: 'Sociedade',
            health: 'Saúde',
            tech: 'Tecnologia'
        };
        return names[category] || 'Notícia';
    }

    function getSourceColor(sourceId) {
        const source = CONFIG.sources.find(s => s.id === sourceId);
        return source ? source.color : '#1a73e8';
    }

    // FUNÇÕES DE INTERAÇÃO
    function openArticle(id) {
        // Salva automaticamente quando abre a notícia
        autoSaveArticle(id);
        
        // Abre em nova aba
        window.open(`article.html?id=${id}`, '_blank');
    }

    function autoSaveArticle(id) {
        const news = allNews.find(n => n.id === id);
        if (!news) return;
        
        // Marca como vista
        news.views = (news.views || 0) + 1;
        
        // Salva no histórico
        const savedArticles = loadFromStorage('cld_saved') || [];
        
        // Remove se já existir
        const existingIndex = savedArticles.findIndex(n => n.id === id);
        if (existingIndex !== -1) {
            savedArticles.splice(existingIndex, 1);
        }
        
        // Adiciona no início
        news.lastViewed = new Date().toISOString();
        savedArticles.unshift(news);
        
        // Mantém apenas 100 notícias no histórico
        saveToStorage('cld_saved', savedArticles.slice(0, 100));
    }

    function toggleSave(id, button) {
        const savedArticles = loadFromStorage('cld_saved') || [];
        const news = allNews.find(n => n.id === id);
        
        if (!news) return;
        
        const isSaved = savedArticles.some(n => n.id === id);
        
        if (isSaved) {
            // Remove
            const index = savedArticles.findIndex(n => n.id === id);
            savedArticles.splice(index, 1);
            button.classList.remove('saved');
            button.innerHTML = '<i class="far fa-bookmark"></i>';
            showNotification('Notícia removida das guardadas');
        } else {
            // Adiciona
            news.savedAt = new Date().toISOString();
            savedArticles.unshift(news);
            button.classList.add('saved');
            button.innerHTML = '<i class="fas fa-bookmark"></i>';
            showNotification('Notícia guardada');
        }
        
        saveToStorage('cld_saved', savedArticles);
    }

    function checkIfSaved(id) {
        const savedArticles = loadFromStorage('cld_saved') || [];
        return savedArticles.some(n => n.id === id);
    }

    // FILTROS E BUSCA
    function filterNews(category) {
        currentFilter = category;
        
        // Atualiza navegação
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // Filtra notícias
        let filtered = allNews;
        
        if (category !== 'all') {
            filtered = allNews.filter(n => n.category === category);
        }
        
        if (currentSearch) {
            filtered = filtered.filter(n => 
                n.title.toLowerCase().includes(currentSearch) ||
                n.excerpt.toLowerCase().includes(currentSearch) ||
                n.source.toLowerCase().includes(currentSearch)
            );
        }
        
        updateDisplay(filtered);
    }

    function searchNews(query) {
        currentSearch = query.toLowerCase().trim();
        
        if (!query) {
            filterNews(currentFilter);
            return;
        }
        
        const filtered = allNews.filter(n => 
            n.title.toLowerCase().includes(currentSearch) ||
            n.excerpt.toLowerCase().includes(currentSearch) ||
            n.source.toLowerCase().includes(currentSearch)
        );
        
        updateDisplay(filtered);
    }

    function sortNews(order) {
        const sorted = [...displayedNews].sort((a, b) => {
            const dateA = new Date(a.date);
            const dateB = new Date(b.date);
            return order === 'newest' ? dateB - dateA : dateA - dateB;
        });
        
        updateDisplay(sorted);
    }

    function updateDisplay(newsList = displayedNews) {
        displayedNews = newsList;
        
        // Limpa containers
        featuredContainer.innerHTML = '';
        allNewsContainer.innerHTML = '';
        
        if (newsList.length === 0) {
            emptyState.style.display = 'block';
            return;
        }
        
        // Mostra até 3 destaques
        const featured = newsList.slice(0, 3);
        featured.forEach((news, index) => {
            const card = createNewsElement(news);
            card.style.animationDelay = `${index * 0.1}s`;
            featuredContainer.appendChild(card);
        });
        
        // Mostra o resto
        const remaining = newsList.slice(3);
        remaining.forEach((news, index) => {
            const card = createNewsElement(news);
            card.style.animationDelay = `${index * 0.1}s`;
            allNewsContainer.appendChild(card);
        });
    }

    function createNewsElement(news) {
        const card = document.createElement('div');
        card.className = 'news-card';
        
        const timeAgo = getTimeAgo(news.date);
        const isSaved = checkIfSaved(news.id);
        
        card.innerHTML = `
            <div class="card-image">
                <img src="${news.image}" alt="${news.title}">
                <span class="category-badge">${getCategoryName(news.category)}</span>
                <button class="save-btn ${isSaved ? 'saved' : ''}" 
                        onclick="toggleSave('${news.id}', this)">
                    <i class="fas fa-${isSaved ? 'bookmark' : 'bookmark'}"></i>
                </button>
            </div>
            <div class="card-content">
                <h3 class="card-title">
                    <a href="article.html?id=${news.id}" 
                       onclick="openArticle('${news.id}')">
                        ${news.title}
                    </a>
                </h3>
                <p class="card-excerpt">${news.excerpt}</p>
                <div class="card-meta">
                    <div class="source-info">
                        <div class="source-icon" style="background: ${getSourceColor(news.sourceId)}">
                            ${news.source.substring(0,2)}
                        </div>
                        <span class="source-name">${news.source}</span>
                    </div>
                    <div class="card-time">
                        <i class="far fa-clock"></i>
                        <span>${timeAgo}</span>
                    </div>
                </div>
            </div>
        `;
        
        return card;
    }
    function showSaved() {
        const savedArticles = loadFromStorage('cld_saved') || [];
        
        if (savedArticles.length === 0) {
            showNotification('Nenhuma notícia guardada');
            return;
        }
        
        updateDisplay(savedArticles);
        
        // Atualiza navegação
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        showNotification(`Mostrando ${savedArticles.length} notícias guardadas`);
    }

    // NOTIFICAÇÕES
    function showNotification(message, type = 'info') {
        // Implementação simples de notificação
        console.log(`[${type.toUpperCase()}] ${message}`);
        
        // Pode ser expandido para mostrar toast na tela
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: slideUp 0.3s ease;
        `;
        
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideDown 0.3s ease';
            setTimeout(() => document.body.removeChild(notification), 300);
        }, 3000);
    }

    // ATUALIZAÇÃO EM TEMPO REAL
    async function loadRealTimeNews() {
        showRealtimeIndicator();
        
        try {
            // Processa uma fonte de cada vez
            for (const source of CONFIG.sources.filter(s => s.enabled)) {
                await fetchNewNews(source);
                await new Promise(resolve => setTimeout(resolve, 2000)); // Aguarda 2s entre fontes
            }
        } catch (error) {
            console.error('Erro ao atualizar notícias:', error);
        } finally {
            hideRealtimeIndicator();
        }
    }

    async function fetchNewNews(source) {
        try {
            const response = await fetch(`${source.api}?per_page=5&_embed`);
            const data = await response.json();
            
            const processed = processNewsData(data, source);
            
            // Adiciona novas notícias
            processed.forEach(news => {
                if (!allNews.some(n => n.id === news.id)) {
                    createNewsCard(news);
                }
            });
            
        } catch (error) {
            console.error(`Erro ao buscar de ${source.name}:`, error);
        }
    }

    function showRealtimeIndicator() {
        realtimeIndicator.style.display = 'flex';
    }

    function hideRealtimeIndicator() {
        realtimeIndicator.style.display = 'none';
    }

    function setupAutoRefresh() {
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                loadRealTimeNews();
            }
        }, CONFIG.updateInterval);
    }

    async function loadSavedNews() {
        const saved = loadFromStorage('cld_news') || [];
        
        if (saved.length > 0) {
            saved.forEach((news, index) => {
                setTimeout(() => {
                    createNewsCard(news);
                }, index * 100);
            });
        }
    }

    function refreshNews() {
        // Limpa notícias antigas
        allNews = [];
        displayedNews = [];
        featuredContainer.innerHTML = '';
        allNewsContainer.innerHTML = '';
        
        // Mostra loader
        loader.style.display = 'block';
        emptyState.style.display = 'none';
        
        // Recarrega notícias
        startSequentialProcessing();
        
        showNotification('Atualizando notícias...');
    }

    // PAINEL ADMIN
    function openAdminPanel() {
        const password = prompt('Digite a senha de administrador:');
        
        if (password === CONFIG.adminPassword) {
            window.location.href = 'admin.html';
        } else if (password) {
            showNotification('Senha incorreta!', 'error');
        }
    }

    // FUNÇÕES DO FOOTER
    function showAbout() {
        alert('Notícias CLD\n\nAgregador de notícias moçambicanas.\nVersão 2.0');
    }

    function showContact() {
        alert('Contato:\n\nEmail: claudioarmando001@gmail.com\nTelefone: +258 869 667 677');
    }

    function showPrivacy() {
        alert('Política de Privacidade\n\nRespeitamos sua privacidade. Não coletamos dados pessoais.');
    }

    function showTerms() {
        alert('Termos de Uso\n\nAs notícias são agregadas de fontes públicas. Consulte as fontes originais para mais informações.');
    }

    // ANIMAÇÕES
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(0); opacity: 1; }
            to { transform: translateX(-50%) translateY(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>